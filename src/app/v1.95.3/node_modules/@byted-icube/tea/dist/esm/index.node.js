import e from"assert";import t from"util";import r from"url";import s from"events";import o from"stream";import n from"fs";import i from"http";import a from"https";import c from"dns";import u from"os";import l from"buffer";import h from"zlib";import d from"http2";import f from"tls";import p from"net";import m from"path";import{g as y}from"./constant-YOsm3yhe.js";var g,v={},b={},_={name:"@dp/tea-sdk-node",version:"3.0.9",description:"",main:"lib/index.js",keywords:[],author:"",license:"ISC",engines:{node:">=10.0.0"},types:"./lib/index.d.ts",dependencies:{"@types/node":"^12.12.50","@logsdk/node-utils":"^3.0.7"},scripts:{build:"npm run clean && tsc --build tsconfig.build.json",clean:"rm -rf ./lib",watch:"npm run build -- --watch",test:"jest"}};var w,E,S,x,O={},P={},k={};function T(){if(w)return k;w=1,Object.defineProperty(k,"__esModule",{value:!0}),k.format=void 0;const e=/%[sdjo%]/g;return k.format=function(r,...s){var o;return"object"==typeof process&&"string"==typeof(null===(o=null===process||void 0===process?void 0:process.versions)||void 0===o?void 0:o.node)?t.format(r,...s):function(t){let r=1,s=arguments,o=s.length,n=String(t).replace(e,(e=>{if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(s[r++]);case"%d":return Number(s[r++]).toString();case"%j":try{return JSON.stringify(s[r++])}catch(e){return"[Circular]"}default:return e}}));for(var i=s[r];r<o;i=s[++r])null===i||"object"!=typeof(a=i)||null===a?n+=" "+i:n+=" "+JSON.stringify(i);var a;return n}(r,...s)},k}function C(){return S||(S=1,e=O,t=O.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,o)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),r=O.__exportStar||function(e,r){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(r,s)||t(r,e,s)},Object.defineProperty(e,"__esModule",{value:!0}),r(function(){if(E)return P;E=1,Object.defineProperty(P,"__esModule",{value:!0}),P.Logger=void 0;const e=T(),t={silent:0,error:1,warn:2,verbose:3},r={write(e,t){switch(e){case"error":console.error(t);break;case"warn":console.warn(t);break;default:console.log(t)}}};class s{constructor(e){this.product=e,this.levelIndex=1,this.consumer=r,this.getLevelIndex=()=>this.levelIndex,this.getConsumer=()=>this.consumer}propagate(e){const t=new s(`${this.product}.${e}`);return t.getLevelIndex=()=>this.levelIndex,t.getConsumer=()=>this.consumer,t}setLevel(e){this.levelIndex=t[e]||1}log(t,r,...s){const o=(0,e.format)(r,...s);this.getConsumer().write(t,`[${this.product}] [${t}] ${o}`)}error(e,...t){this.getLevelIndex()>=1&&this.log("error",e,...t)}warn(e,...t){this.getLevelIndex()>=2&&this.log("warn",e,...t)}trace(e,...t){this.getLevelIndex()>=3&&this.log("trace",e,...t)}}return P.Logger=s,P}(),e)),O;var e,t,r}var j,R=function(){if(x)return v;x=1;var t=v.__rest||function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(r[s[o]]=e[s[o]])}return r},r=v.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0}),v.TeaSDK=void 0;const s=r(e),o=r(function(){if(g)return b;g=1;var e=b.__rest||function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(r[s[o]]=e[s[o]])}return r};Object.defineProperty(b,"__esModule",{value:!0});const t=_,r=60*(new Date).getTimezoneOffset(),s=new Proxy({darwin:"mac",win32:"windows"},{get:(e,t)=>e[t]||t});return b.default=class{constructor(e){this.options=e,this.userFields={},this.customField={},this.partialHeaderFields={app_id:e.app_id},Object.assign(this.partialHeaderFields,{platform:"Node.js",os_name:s[process.platform],tz_offset:r,sdk_version:t.version})}get headerFields(){return Object.assign(Object.assign({},this.partialHeaderFields),{custom:JSON.stringify(this.customField)})}get logger(){return this.options.logger}get caller(){return this.options.caller}get appId(){return this.options.app_id}configure(t){var r;this.logger.trace("Re-configure with %o",t),(null===(r=t.header)||void 0===r?void 0:r.custom)&&this.logger.warn("Set custom params inside header is deprecated, use `config` instead. which looks like:","\nteaSDK.config({\n  header: { ... },\n  user: { ... },\n  custom: {/** custom content */},\n})");const s=t.header||{},{custom:o}=s,n=e(s,["custom"]);this.customField=JSON.parse(o||"{}"),Object.assign(this.partialHeaderFields,n),Object.assign(this.userFields,t.user),Object.assign(this.customField,t.custom)}compose(e,t){const r=Object.assign({},this.userFields,e.user);r.user_unique_id||(r.user_unique_id="anonymous",this.logger.warn("Composing events without specifying `user_unique_id` is strongly deprecated, use `sdk.config()` to add a global fallback value for anonymous users"));const s=Object.assign({},this.customField,e.customOfHeader);return{id:(null==t?void 0:t.id)||Math.random().toString(32).slice(2),originatedBy:(null==t?void 0:t.originatedBy)||"logsdk",createdAt:(null==t?void 0:t.createdAt)||Date.now(),event:{server_time:Math.ceil(Date.now()/1e3),caller:e.caller||this.caller||"",user:r,header:Object.assign({custom:JSON.stringify(s)},this.partialHeaderFields,e.header),events:e.events.map((e=>Object.assign(Object.assign({},e),{_staging_flag:this.options.isolated})))}}}},b}()),n=C(),i=_;return v.TeaSDK=class{constructor(e){this.plugins=[],this.instanceID=Math.random().toString(32).slice(2),this.config=e=>{this.plugins.map((t=>{var r;null===(r=t.beforeConfig)||void 0===r||r.call(t,e)})),this.configManager.configure(e),this.plugins.map((t=>{var r;null===(r=t.afterConfig)||void 0===r||r.call(t,e)}))},this.logger=new n.Logger("Logsdk"),this.logger.setLevel(e.logLevel||"silent"),e.isolated&&this.logger.warn("Global isolation is enabled"),(0,s.default)("number"==typeof(null==e?void 0:e.app_id)),this.configManager=new o.default(Object.assign(Object.assign({},e),{logger:this.logger})),this.logger.trace("initialized success with options %o",e)}get meta(){return{caller:this.configManager.caller,user:this.configManager.userFields,header:this.configManager.headerFields,appId:this.configManager.appId,version:i.version,instanceID:this.instanceID,installedPlugins:[]}}composeHookContext(e){const t=this;return{get metaInfo(){return t.meta},logger:this.logger.propagate(e.name),collect:(t,r)=>{this.trigger(Object.assign({events:t.map((e=>Object.assign(Object.assign({},e.extra),{event:e.name,params:JSON.stringify(e.params),time:Math.ceil(Date.now()/1e3)})))},r),{originatedBy:e.name})}}}trigger(...e){const[t,r]=e,s=this.configManager.compose(t,r);this.logger.trace("Composed event %o",s),this.plugins.map((e=>{var t,r;null===(t=e.beforeSendEvent)||void 0===t||t.call(e,s),null===(r=e.onSendEvent)||void 0===r||r.call(e,s)}))}use(...e){this.plugins.push(...e),e.map((e=>{var t;null===(t=e.install)||void 0===t||t.call(e,this.composeHookContext(e)),this.logger.trace("Plugin %s installed",e.name)}))}collectEvents(e,t,r,s){this.trigger({events:r,user:e,header:t,caller:s||this.configManager.caller})}collect(e,r,s){const o=Array.isArray(e)?e.map((({name:e,params:t})=>({event:e,params:JSON.stringify(t)}))):[{event:e,params:JSON.stringify(r)}],n=(Array.isArray(e)?r:s)||{},{custom:i}=n,a=t(n,["custom"]);this.plugins.length||this.logger.warn("Dry run since no plugin applied"),this.trigger(Object.assign({events:o.map((e=>Object.assign(Object.assign({},e),{time:Math.ceil(Date.now()/1e3)}))),customOfHeader:i},a))}},v}(),A={},H={exports:{}},q={},I={exports:{}};function L(){return j||(j=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const r=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];const s=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Blob","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","FormData","URLSearchParams","HTMLElement",...r];const o=["null","undefined","string","number","bigint","boolean","symbol"];function n(e){return t=>typeof t===e}const{toString:i}=Object.prototype,a=e=>{const t=i.call(e).slice(8,-1);return/HTML\w+Element/.test(t)&&u.domElement(e)?"HTMLElement":function(e){return s.includes(e)}(t)?t:void 0},c=e=>t=>a(t)===e;function u(e){if(null===e)return"null";switch(typeof e){case"undefined":return"undefined";case"string":return"string";case"number":return"number";case"boolean":return"boolean";case"function":return"Function";case"bigint":return"bigint";case"symbol":return"symbol"}if(u.observable(e))return"Observable";if(u.array(e))return"Array";if(u.buffer(e))return"Buffer";const t=a(e);if(t)return t;if(e instanceof String||e instanceof Boolean||e instanceof Number)throw new TypeError("Please don't use object wrappers for primitive types");return"Object"}u.undefined=n("undefined"),u.string=n("string");const l=n("number");u.number=e=>l(e)&&!u.nan(e),u.bigint=n("bigint"),u.function_=n("function"),u.null_=e=>null===e,u.class_=e=>u.function_(e)&&e.toString().startsWith("class "),u.boolean=e=>!0===e||!1===e,u.symbol=n("symbol"),u.numericString=e=>u.string(e)&&!u.emptyStringOrWhitespace(e)&&!Number.isNaN(Number(e)),u.array=(e,t)=>!!Array.isArray(e)&&(!u.function_(t)||e.every(t)),u.buffer=e=>{var t,r,s,o;return null!==(o=null===(s=null===(r=null===(t=e)||void 0===t?void 0:t.constructor)||void 0===r?void 0:r.isBuffer)||void 0===s?void 0:s.call(r,e))&&void 0!==o&&o},u.blob=e=>c("Blob")(e),u.nullOrUndefined=e=>u.null_(e)||u.undefined(e),u.object=e=>!u.null_(e)&&("object"==typeof e||u.function_(e)),u.iterable=e=>{var t;return u.function_(null===(t=e)||void 0===t?void 0:t[Symbol.iterator])},u.asyncIterable=e=>{var t;return u.function_(null===(t=e)||void 0===t?void 0:t[Symbol.asyncIterator])},u.generator=e=>{var t,r;return u.iterable(e)&&u.function_(null===(t=e)||void 0===t?void 0:t.next)&&u.function_(null===(r=e)||void 0===r?void 0:r.throw)},u.asyncGenerator=e=>u.asyncIterable(e)&&u.function_(e.next)&&u.function_(e.throw),u.nativePromise=e=>c("Promise")(e);u.promise=e=>u.nativePromise(e)||(e=>{var t,r;return u.function_(null===(t=e)||void 0===t?void 0:t.then)&&u.function_(null===(r=e)||void 0===r?void 0:r.catch)})(e),u.generatorFunction=c("GeneratorFunction"),u.asyncGeneratorFunction=e=>"AsyncGeneratorFunction"===a(e),u.asyncFunction=e=>"AsyncFunction"===a(e),u.boundFunction=e=>u.function_(e)&&!e.hasOwnProperty("prototype"),u.regExp=c("RegExp"),u.date=c("Date"),u.error=c("Error"),u.map=e=>c("Map")(e),u.set=e=>c("Set")(e),u.weakMap=e=>c("WeakMap")(e),u.weakSet=e=>c("WeakSet")(e),u.int8Array=c("Int8Array"),u.uint8Array=c("Uint8Array"),u.uint8ClampedArray=c("Uint8ClampedArray"),u.int16Array=c("Int16Array"),u.uint16Array=c("Uint16Array"),u.int32Array=c("Int32Array"),u.uint32Array=c("Uint32Array"),u.float32Array=c("Float32Array"),u.float64Array=c("Float64Array"),u.bigInt64Array=c("BigInt64Array"),u.bigUint64Array=c("BigUint64Array"),u.arrayBuffer=c("ArrayBuffer"),u.sharedArrayBuffer=c("SharedArrayBuffer"),u.dataView=c("DataView"),u.enumCase=(e,t)=>Object.values(t).includes(e),u.directInstanceOf=(e,t)=>Object.getPrototypeOf(e)===t.prototype,u.urlInstance=e=>c("URL")(e),u.urlString=e=>{if(!u.string(e))return!1;try{return new URL(e),!0}catch(e){return!1}},u.truthy=e=>Boolean(e),u.falsy=e=>!e,u.nan=e=>Number.isNaN(e),u.primitive=e=>u.null_(e)||function(e){return o.includes(e)}(typeof e),u.integer=e=>Number.isInteger(e),u.safeInteger=e=>Number.isSafeInteger(e),u.plainObject=e=>{if("[object Object]"!==i.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.getPrototypeOf({})},u.typedArray=e=>function(e){return r.includes(e)}(a(e));u.arrayLike=e=>!u.nullOrUndefined(e)&&!u.function_(e)&&(e=>u.safeInteger(e)&&e>=0)(e.length),u.inRange=(e,t)=>{if(u.number(t))return e>=Math.min(0,t)&&e<=Math.max(t,0);if(u.array(t)&&2===t.length)return e>=Math.min(...t)&&e<=Math.max(...t);throw new TypeError(`Invalid range: ${JSON.stringify(t)}`)};const h=["innerHTML","ownerDocument","style","attributes","nodeValue"];u.domElement=e=>u.object(e)&&1===e.nodeType&&u.string(e.nodeName)&&!u.plainObject(e)&&h.every((t=>t in e)),u.observable=e=>{var t,r,s,o;return!!e&&(e===(null===(r=(t=e)[Symbol.observable])||void 0===r?void 0:r.call(t))||e===(null===(o=(s=e)["@@observable"])||void 0===o?void 0:o.call(s)))},u.nodeStream=e=>u.object(e)&&u.function_(e.pipe)&&!u.observable(e),u.infinite=e=>e===1/0||e===-1/0;const d=e=>t=>u.integer(t)&&Math.abs(t%2)===e;u.evenInteger=d(0),u.oddInteger=d(1),u.emptyArray=e=>u.array(e)&&0===e.length,u.nonEmptyArray=e=>u.array(e)&&e.length>0,u.emptyString=e=>u.string(e)&&0===e.length;u.emptyStringOrWhitespace=e=>u.emptyString(e)||(e=>u.string(e)&&!/\S/.test(e))(e),u.nonEmptyString=e=>u.string(e)&&e.length>0,u.nonEmptyStringAndNotWhitespace=e=>u.string(e)&&!u.emptyStringOrWhitespace(e),u.emptyObject=e=>u.object(e)&&!u.map(e)&&!u.set(e)&&0===Object.keys(e).length,u.nonEmptyObject=e=>u.object(e)&&!u.map(e)&&!u.set(e)&&Object.keys(e).length>0,u.emptySet=e=>u.set(e)&&0===e.size,u.nonEmptySet=e=>u.set(e)&&e.size>0,u.emptyMap=e=>u.map(e)&&0===e.size,u.nonEmptyMap=e=>u.map(e)&&e.size>0,u.propertyKey=e=>u.any([u.string,u.number,u.symbol],e),u.formData=e=>c("FormData")(e),u.urlSearchParams=e=>c("URLSearchParams")(e);const f=(e,t,r)=>{if(!u.function_(t))throw new TypeError(`Invalid predicate: ${JSON.stringify(t)}`);if(0===r.length)throw new TypeError("Invalid number of values");return e.call(r,t)};u.any=(e,...t)=>(u.array(e)?e:[e]).some((e=>f(Array.prototype.some,e,t))),u.all=(e,...t)=>f(Array.prototype.every,e,t);const p=(e,t,r,s={})=>{if(!e){const{multipleValues:e}=s,o=e?`received values of types ${[...new Set(r.map((e=>`\`${u(e)}\``)))].join(", ")}`:`received value of type \`${u(r)}\``;throw new TypeError(`Expected value which is \`${t}\`, ${o}.`)}};t.assert={undefined:e=>p(u.undefined(e),"undefined",e),string:e=>p(u.string(e),"string",e),number:e=>p(u.number(e),"number",e),bigint:e=>p(u.bigint(e),"bigint",e),function_:e=>p(u.function_(e),"Function",e),null_:e=>p(u.null_(e),"null",e),class_:e=>p(u.class_(e),"Class",e),boolean:e=>p(u.boolean(e),"boolean",e),symbol:e=>p(u.symbol(e),"symbol",e),numericString:e=>p(u.numericString(e),"string with a number",e),array:(e,t)=>{p(u.array(e),"Array",e),t&&e.forEach(t)},buffer:e=>p(u.buffer(e),"Buffer",e),blob:e=>p(u.blob(e),"Blob",e),nullOrUndefined:e=>p(u.nullOrUndefined(e),"null or undefined",e),object:e=>p(u.object(e),"Object",e),iterable:e=>p(u.iterable(e),"Iterable",e),asyncIterable:e=>p(u.asyncIterable(e),"AsyncIterable",e),generator:e=>p(u.generator(e),"Generator",e),asyncGenerator:e=>p(u.asyncGenerator(e),"AsyncGenerator",e),nativePromise:e=>p(u.nativePromise(e),"native Promise",e),promise:e=>p(u.promise(e),"Promise",e),generatorFunction:e=>p(u.generatorFunction(e),"GeneratorFunction",e),asyncGeneratorFunction:e=>p(u.asyncGeneratorFunction(e),"AsyncGeneratorFunction",e),asyncFunction:e=>p(u.asyncFunction(e),"AsyncFunction",e),boundFunction:e=>p(u.boundFunction(e),"Function",e),regExp:e=>p(u.regExp(e),"RegExp",e),date:e=>p(u.date(e),"Date",e),error:e=>p(u.error(e),"Error",e),map:e=>p(u.map(e),"Map",e),set:e=>p(u.set(e),"Set",e),weakMap:e=>p(u.weakMap(e),"WeakMap",e),weakSet:e=>p(u.weakSet(e),"WeakSet",e),int8Array:e=>p(u.int8Array(e),"Int8Array",e),uint8Array:e=>p(u.uint8Array(e),"Uint8Array",e),uint8ClampedArray:e=>p(u.uint8ClampedArray(e),"Uint8ClampedArray",e),int16Array:e=>p(u.int16Array(e),"Int16Array",e),uint16Array:e=>p(u.uint16Array(e),"Uint16Array",e),int32Array:e=>p(u.int32Array(e),"Int32Array",e),uint32Array:e=>p(u.uint32Array(e),"Uint32Array",e),float32Array:e=>p(u.float32Array(e),"Float32Array",e),float64Array:e=>p(u.float64Array(e),"Float64Array",e),bigInt64Array:e=>p(u.bigInt64Array(e),"BigInt64Array",e),bigUint64Array:e=>p(u.bigUint64Array(e),"BigUint64Array",e),arrayBuffer:e=>p(u.arrayBuffer(e),"ArrayBuffer",e),sharedArrayBuffer:e=>p(u.sharedArrayBuffer(e),"SharedArrayBuffer",e),dataView:e=>p(u.dataView(e),"DataView",e),enumCase:(e,t)=>p(u.enumCase(e,t),"EnumCase",e),urlInstance:e=>p(u.urlInstance(e),"URL",e),urlString:e=>p(u.urlString(e),"string with a URL",e),truthy:e=>p(u.truthy(e),"truthy",e),falsy:e=>p(u.falsy(e),"falsy",e),nan:e=>p(u.nan(e),"NaN",e),primitive:e=>p(u.primitive(e),"primitive",e),integer:e=>p(u.integer(e),"integer",e),safeInteger:e=>p(u.safeInteger(e),"integer",e),plainObject:e=>p(u.plainObject(e),"plain object",e),typedArray:e=>p(u.typedArray(e),"TypedArray",e),arrayLike:e=>p(u.arrayLike(e),"array-like",e),domElement:e=>p(u.domElement(e),"HTMLElement",e),observable:e=>p(u.observable(e),"Observable",e),nodeStream:e=>p(u.nodeStream(e),"Node.js Stream",e),infinite:e=>p(u.infinite(e),"infinite number",e),emptyArray:e=>p(u.emptyArray(e),"empty array",e),nonEmptyArray:e=>p(u.nonEmptyArray(e),"non-empty array",e),emptyString:e=>p(u.emptyString(e),"empty string",e),emptyStringOrWhitespace:e=>p(u.emptyStringOrWhitespace(e),"empty string or whitespace",e),nonEmptyString:e=>p(u.nonEmptyString(e),"non-empty string",e),nonEmptyStringAndNotWhitespace:e=>p(u.nonEmptyStringAndNotWhitespace(e),"non-empty string and not whitespace",e),emptyObject:e=>p(u.emptyObject(e),"empty object",e),nonEmptyObject:e=>p(u.nonEmptyObject(e),"non-empty object",e),emptySet:e=>p(u.emptySet(e),"empty set",e),nonEmptySet:e=>p(u.nonEmptySet(e),"non-empty set",e),emptyMap:e=>p(u.emptyMap(e),"empty map",e),nonEmptyMap:e=>p(u.nonEmptyMap(e),"non-empty map",e),propertyKey:e=>p(u.propertyKey(e),"PropertyKey",e),formData:e=>p(u.formData(e),"FormData",e),urlSearchParams:e=>p(u.urlSearchParams(e),"URLSearchParams",e),evenInteger:e=>p(u.evenInteger(e),"even integer",e),oddInteger:e=>p(u.oddInteger(e),"odd integer",e),directInstanceOf:(e,t)=>p(u.directInstanceOf(e,t),"T",e),inRange:(e,t)=>p(u.inRange(e,t),"in range",e),any:(e,...t)=>p(u.any(e,...t),"predicate returns truthy for any value",t,{multipleValues:!0}),all:(e,...t)=>p(u.all(e,...t),"predicate returns truthy for all values",t,{multipleValues:!0})},Object.defineProperties(u,{class:{value:u.class_},function:{value:u.function_},null:{value:u.null_}}),Object.defineProperties(t.assert,{class:{value:t.assert.class_},function:{value:t.assert.function_},null:{value:t.assert.null_}}),t.default=u,e.exports=u,e.exports.default=u,e.exports.assert=t.assert}(I,I.exports)),I.exports}var M,D={},U={exports:{}};var N,$,z={},B={},F={exports:{}},V={exports:{}};function W(){return $||($=1,function(e,r){Object.defineProperty(r,"__esModule",{value:!0});const s=(N||(N=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const r=(e,t)=>{let r;r="function"==typeof t?{connect:t}:t;const s="function"==typeof r.connect,o="function"==typeof r.secureConnect,n="function"==typeof r.close,i=()=>{s&&r.connect(),function(e){return e.encrypted}(e)&&o&&(e.authorized?r.secureConnect():e.authorizationError||e.once("secureConnect",r.secureConnect)),n&&e.once("close",r.close)};e.writable&&!e.connecting?i():e.connecting?e.once("connect",i):e.destroyed&&n&&r.close(e._hadError)};t.default=r,e.exports=r,e.exports.default=r}(V,V.exports)),V.exports),o=t,n=Number(process.versions.node.split(".")[0]),i=e=>{if(e.timings)return e.timings;const t={start:Date.now(),socket:void 0,lookup:void 0,connect:void 0,secureConnect:void 0,upload:void 0,response:void 0,end:void 0,error:void 0,abort:void 0,phases:{wait:void 0,dns:void 0,tcp:void 0,tls:void 0,request:void 0,firstByte:void 0,download:void 0,total:void 0}};e.timings=t;const r=e=>{const r=e.emit.bind(e);e.emit=(s,...o)=>("error"===s&&(t.error=Date.now(),t.phases.total=t.error-t.start,e.emit=r),r(s,...o))};r(e);const i=()=>{t.abort=Date.now(),(!t.response||n>=13)&&(t.phases.total=Date.now()-t.start)};e.prependOnceListener("abort",i);const a=e=>{if(t.socket=Date.now(),t.phases.wait=t.socket-t.start,o.types.isProxy(e))return;const r=()=>{t.lookup=Date.now(),t.phases.dns=t.lookup-t.socket};e.prependOnceListener("lookup",r),s.default(e,{connect:()=>{t.connect=Date.now(),void 0===t.lookup&&(e.removeListener("lookup",r),t.lookup=t.connect,t.phases.dns=t.lookup-t.socket),t.phases.tcp=t.connect-t.lookup},secureConnect:()=>{t.secureConnect=Date.now(),t.phases.tls=t.secureConnect-t.connect}})};e.socket?a(e.socket):e.prependOnceListener("socket",a);const c=()=>{var e;t.upload=Date.now(),t.phases.request=t.upload-(null!==(e=t.secureConnect)&&void 0!==e?e:t.connect)};return("boolean"==typeof e.writableFinished?!e.writableFinished:!e.finished||0!==e.outputSize||e.socket&&0!==e.socket.writableLength)?e.prependOnceListener("finish",c):c(),e.prependOnceListener("response",(e=>{t.response=Date.now(),t.phases.firstByte=t.response-t.upload,e.timings=t,r(e),e.prependOnceListener("end",(()=>{t.end=Date.now(),t.phases.download=t.end-t.response,t.phases.total=t.end-t.start})),e.prependOnceListener("aborted",i)})),t};r.default=i,e.exports=i,e.exports.default=i}(F,F.exports)),F.exports}var G,J,K,Q={exports:{}};function X(){if(G)return Q.exports;G=1;const{V4MAPPED:e,ADDRCONFIG:r,ALL:s,promises:{Resolver:o},lookup:n}=c,{promisify:i}=t,a=u,l=Symbol("cacheableLookupCreateConnection"),h=Symbol("cacheableLookupInstance"),d=Symbol("expires"),f="number"==typeof s,p=e=>{if(!e||"function"!=typeof e.createConnection)throw new Error("Expected an Agent instance as the first argument")},m=()=>{let e=!1,t=!1;for(const r of Object.values(a.networkInterfaces()))for(const s of r)if(!s.internal&&("IPv6"===s.family?t=!0:e=!0,e&&t))return{has4:e,has6:t};return{has4:e,has6:t}},y={ttl:!0},g={all:!0};class v{constructor({cache:e=new Map,maxTtl:t=1/0,fallbackDuration:r=3600,errorTtl:s=.15,resolver:a=new o,lookup:c=n}={}){if(this.maxTtl=t,this.errorTtl=s,this._cache=e,this._resolver=a,this._dnsLookup=i(c),this._resolver instanceof o?(this._resolve4=this._resolver.resolve4.bind(this._resolver),this._resolve6=this._resolver.resolve6.bind(this._resolver)):(this._resolve4=i(this._resolver.resolve4.bind(this._resolver)),this._resolve6=i(this._resolver.resolve6.bind(this._resolver))),this._iface=m(),this._pending={},this._nextRemovalTime=!1,this._hostnamesToFallback=new Set,r<1)this._fallback=!1;else{this._fallback=!0;const e=setInterval((()=>{this._hostnamesToFallback.clear()}),1e3*r);e.unref&&e.unref()}this.lookup=this.lookup.bind(this),this.lookupAsync=this.lookupAsync.bind(this)}set servers(e){this.clear(),this._resolver.setServers(e)}get servers(){return this._resolver.getServers()}lookup(e,t,r){if("function"==typeof t?(r=t,t={}):"number"==typeof t&&(t={family:t}),!r)throw new Error("Callback must be a function.");this.lookupAsync(e,t).then((e=>{t.all?r(null,e):r(null,e.address,e.family,e.expires,e.ttl)}),r)}async lookupAsync(t,o={}){"number"==typeof o&&(o={family:o});let n=await this.query(t);if(6===o.family){const t=n.filter((e=>6===e.family));o.hints&e&&(f&&o.hints&s||0===t.length)?(e=>{for(const t of e)6!==t.family&&(t.address=`::ffff:${t.address}`,t.family=6)})(n):n=t}else 4===o.family&&(n=n.filter((e=>4===e.family)));if(o.hints&r){const{_iface:e}=this;n=n.filter((t=>6===t.family?e.has6:e.has4))}if(0===n.length){const e=new Error(`cacheableLookup ENOTFOUND ${t}`);throw e.code="ENOTFOUND",e.hostname=t,e}return o.all?n:n[0]}async query(e){let t=await this._cache.get(e);if(!t){const r=this._pending[e];if(r)t=await r;else{const r=this.queryAndCache(e);this._pending[e]=r;try{t=await r}finally{delete this._pending[e]}}}return t=t.map((e=>({...e}))),t}async _resolve(e){const[t,r]=await Promise.all([this._resolve4(e,y),this._resolve6(e,y)].map((e=>(async e=>{try{return await e}catch(e){if("ENODATA"===e.code||"ENOTFOUND"===e.code)return[];throw e}})(e))));let s=0,o=0,n=0;const i=Date.now();for(const e of t)e.family=4,e.expires=i+1e3*e.ttl,s=Math.max(s,e.ttl);for(const e of r)e.family=6,e.expires=i+1e3*e.ttl,o=Math.max(o,e.ttl);return n=t.length>0?r.length>0?Math.min(s,o):s:o,{entries:[...t,...r],cacheTtl:n}}async _lookup(e){try{return{entries:await this._dnsLookup(e,{all:!0}),cacheTtl:0}}catch(e){return{entries:[],cacheTtl:0}}}async _set(e,t,r){if(this.maxTtl>0&&r>0){r=1e3*Math.min(r,this.maxTtl),t[d]=Date.now()+r;try{await this._cache.set(e,t,r)}catch(e){this.lookupAsync=async()=>{const t=new Error("Cache Error. Please recreate the CacheableLookup instance.");throw t.cause=e,t}}s=this._cache,Symbol.iterator in s&&this._tick(r)}var s}async queryAndCache(e){if(this._hostnamesToFallback.has(e))return this._dnsLookup(e,g);let t=await this._resolve(e);0===t.entries.length&&this._fallback&&(t=await this._lookup(e),0!==t.entries.length&&this._hostnamesToFallback.add(e));const r=0===t.entries.length?this.errorTtl:t.cacheTtl;return await this._set(e,t.entries,r),t.entries}_tick(e){const t=this._nextRemovalTime;(!t||e<t)&&(clearTimeout(this._removalTimeout),this._nextRemovalTime=e,this._removalTimeout=setTimeout((()=>{this._nextRemovalTime=!1;let e=1/0;const t=Date.now();for(const[r,s]of this._cache){const o=s[d];t>=o?this._cache.delete(r):o<e&&(e=o)}e!==1/0&&this._tick(e-t)}),e),this._removalTimeout.unref&&this._removalTimeout.unref())}install(e){if(p(e),l in e)throw new Error("CacheableLookup has been already installed");e[l]=e.createConnection,e[h]=this,e.createConnection=(t,r)=>("lookup"in t||(t.lookup=this.lookup),e[l](t,r))}uninstall(e){if(p(e),e[l]){if(e[h]!==this)throw new Error("The agent is not owned by this CacheableLookup instance");e.createConnection=e[l],delete e[l],delete e[h]}}updateInterfaceInfo(){const{_iface:e}=this;this._iface=m(),(e.has4&&!this._iface.has4||e.has6&&!this._iface.has6)&&this._cache.clear()}clear(e){e?this._cache.delete(e):this._cache.clear()}}return Q.exports=v,Q.exports.default=v,Q.exports}function Y(){if(K)return J;K=1;const e=(e,t)=>t.some((t=>t instanceof RegExp?t.test(e):t===e));return J=(t,r)=>{if(r={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...r},t=t.trim(),/^data:/i.test(t))return((e,{stripHash:t})=>{const r=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!r)throw new Error(`Invalid URL: ${e}`);let{type:s,data:o,hash:n}=r.groups;const i=s.split(";");n=t?"":n;let a=!1;"base64"===i[i.length-1]&&(i.pop(),a=!0);const c=(i.shift()||"").toLowerCase(),u=[...i.map((e=>{let[t,r=""]=e.split("=").map((e=>e.trim()));return"charset"===t&&(r=r.toLowerCase(),"us-ascii"===r)?"":`${t}${r?`=${r}`:""}`})).filter(Boolean)];return a&&u.push("base64"),(0!==u.length||c&&"text/plain"!==c)&&u.unshift(c),`data:${u.join(";")},${a?o.trim():o}${n?`#${n}`:""}`})(t,r);if(/^view-source:/i.test(t))throw new Error("`view-source:` is not supported as it is a non-standard protocol");const s=t.startsWith("//");!s&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,r.defaultProtocol));const o=new URL(t);if(r.forceHttp&&r.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(r.forceHttp&&"https:"===o.protocol&&(o.protocol="http:"),r.forceHttps&&"http:"===o.protocol&&(o.protocol="https:"),r.stripAuthentication&&(o.username="",o.password=""),r.stripHash?o.hash="":r.stripTextFragment&&(o.hash=o.hash.replace(/#?:~:text.*?$/i,"")),o.pathname&&(o.pathname=o.pathname.replace(/(?<!\b(?:[a-z][a-z\d+\-.]{1,50}:))\/{2,}/g,"/")),o.pathname)try{o.pathname=decodeURI(o.pathname)}catch(e){}if(!0===r.removeDirectoryIndex&&(r.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(r.removeDirectoryIndex)&&r.removeDirectoryIndex.length>0){let t=o.pathname.split("/");const s=t[t.length-1];e(s,r.removeDirectoryIndex)&&(t=t.slice(0,t.length-1),o.pathname=t.slice(1).join("/")+"/")}if(o.hostname&&(o.hostname=o.hostname.replace(/\.$/,""),r.stripWWW&&/^www\.(?!www\.)(?:[a-z\-\d]{1,63})\.(?:[a-z.\-\d]{2,63})$/.test(o.hostname)&&(o.hostname=o.hostname.replace(/^www\./,""))),Array.isArray(r.removeQueryParameters))for(const t of[...o.searchParams.keys()])e(t,r.removeQueryParameters)&&o.searchParams.delete(t);!0===r.removeQueryParameters&&(o.search=""),r.sortQueryParameters&&o.searchParams.sort(),r.removeTrailingSlash&&(o.pathname=o.pathname.replace(/\/$/,""));const n=t;return t=o.toString(),r.removeSingleSlash||"/"!==o.pathname||n.endsWith("/")||""!==o.hash||(t=t.replace(/\/$/,"")),(r.removeTrailingSlash||"/"===o.pathname)&&""===o.hash&&r.removeSingleSlash&&(t=t.replace(/\/$/,"")),s&&!r.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),r.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}}var Z,ee,te,re,se,oe,ne,ie,ae,ce,ue,le,he,de,fe,pe,me,ye,ge,ve,be={exports:{}},_e={exports:{}};function we(){if(te)return _e.exports;te=1;var e=(ee||(ee=1,Z=function e(t,r){if(t&&r)return e(t)(r);if("function"!=typeof t)throw new TypeError("need wrapper function");return Object.keys(t).forEach((function(e){s[e]=t[e]})),s;function s(){for(var e=new Array(arguments.length),r=0;r<e.length;r++)e[r]=arguments[r];var s=t.apply(this,e),o=e[e.length-1];return"function"==typeof s&&s!==o&&Object.keys(o).forEach((function(e){s[e]=o[e]})),s}}),Z);function t(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function r(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}return _e.exports=e(t),_e.exports.strict=e(r),t.proto=t((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return t(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return r(this)},configurable:!0})})),_e.exports}function Ee(){if(se)return re;se=1;var e=we(),t=function(){},r=function(s,o,n){if("function"==typeof o)return r(s,null,o);o||(o={}),n=e(n||t);var i=s._writableState,a=s._readableState,c=o.readable||!1!==o.readable&&s.readable,u=o.writable||!1!==o.writable&&s.writable,l=!1,h=function(){s.writable||d()},d=function(){u=!1,c||n.call(s)},f=function(){c=!1,u||n.call(s)},p=function(e){n.call(s,e?new Error("exited with error code: "+e):null)},m=function(e){n.call(s,e)},y=function(){process.nextTick(g)},g=function(){if(!l)return(!c||a&&a.ended&&!a.destroyed)&&(!u||i&&i.ended&&!i.destroyed)?void 0:n.call(s,new Error("premature close"))},v=function(){s.req.on("finish",d)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(s)?u&&!i&&(s.on("end",h),s.on("close",h)):(s.on("complete",d),s.on("abort",y),s.req?v():s.on("request",v)),function(e){return e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length}(s)&&s.on("exit",p),s.on("end",f),s.on("finish",d),!1!==o.error&&s.on("error",m),s.on("close",y),function(){l=!0,s.removeListener("complete",d),s.removeListener("abort",y),s.removeListener("request",v),s.req&&s.req.removeListener("finish",d),s.removeListener("end",h),s.removeListener("close",h),s.removeListener("finish",d),s.removeListener("exit",p),s.removeListener("end",f),s.removeListener("error",m),s.removeListener("close",y)}};return re=r}function Se(){if(ne)return oe;ne=1;var e,t=we(),r=Ee();try{e=require("fs")}catch(e){}var s=function(){},o=/^v?\.0/.test(process.version),n=function(e){return"function"==typeof e},i=function(i,a,c,u){u=t(u);var l=!1;i.on("close",(function(){l=!0})),r(i,{readable:a,writable:c},(function(e){if(e)return u(e);l=!0,u()}));var h=!1;return function(t){if(!l&&!h)return h=!0,function(t){return!!o&&!!e&&(t instanceof(e.ReadStream||s)||t instanceof(e.WriteStream||s))&&n(t.close)}(i)?i.close(s):function(e){return e.setHeader&&n(e.abort)}(i)?i.abort():n(i.destroy)?i.destroy():void u(t||new Error("stream was destroyed"))}},a=function(e){e()},c=function(e,t){return e.pipe(t)};return oe=function(){var e,t=Array.prototype.slice.call(arguments),r=n(t[t.length-1]||s)&&t.pop()||s;if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new Error("pump requires two streams per minimum");var o=t.map((function(s,n){var c=n<t.length-1;return i(s,c,n>0,(function(t){e||(e=t),t&&o.forEach(a),c||(o.forEach(a),r(e))}))}));return t.reduce(c)},oe}function xe(){if(ae)return ie;ae=1;const{PassThrough:e}=o;return ie=t=>{t={...t};const{array:r}=t;let{encoding:s}=t;const o="buffer"===s;let n=!1;r?n=!(s||o):s=s||"utf8",o&&(s=null);const i=new e({objectMode:n});s&&i.setEncoding(s);let a=0;const c=[];return i.on("data",(e=>{c.push(e),n?a=c.length:a+=e.length})),i.getBufferedValue=()=>r?c:o?Buffer.concat(c,a):c.join(""),i.getBufferedLength=()=>a,i}}function Oe(){if(ce)return be.exports;ce=1;const{constants:e}=l,t=Se(),r=xe();class s extends Error{constructor(){super("maxBuffer exceeded"),this.name="MaxBufferError"}}async function o(o,n){if(!o)return Promise.reject(new Error("Expected a stream"));n={maxBuffer:1/0,...n};const{maxBuffer:i}=n;let a;return await new Promise(((c,u)=>{const l=t=>{t&&a.getBufferedLength()<=e.MAX_LENGTH&&(t.bufferedData=a.getBufferedValue()),u(t)};a=t(o,r(n),(e=>{e?l(e):c()})),a.on("data",(()=>{a.getBufferedLength()>i&&l(new s)}))})),a.getBufferedValue()}return be.exports=o,be.exports.default=o,be.exports.buffer=(e,t)=>o(e,{...t,encoding:"buffer"}),be.exports.array=(e,t)=>o(e,{...t,array:!0}),be.exports.MaxBufferError=s,be.exports}function Pe(){if(le)return ue;le=1;const e=new Set([200,203,204,206,300,301,308,404,405,410,414,501]),t=new Set([200,203,204,300,301,302,303,307,308,404,405,410,414,501]),r=new Set([500,502,503,504]),s={date:!0,connection:!0,"keep-alive":!0,"proxy-authenticate":!0,"proxy-authorization":!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0},o={"content-length":!0,"content-encoding":!0,"transfer-encoding":!0,"content-range":!0};function n(e){const t=parseInt(e,10);return isFinite(t)?t:0}function i(e){const t={};if(!e)return t;const r=e.trim().split(/,/);for(const e of r){const[r,s]=e.split(/=/,2);t[r.trim()]=void 0===s||s.trim().replace(/^"|"$/g,"")}return t}function a(e){let t=[];for(const r in e){const s=e[r];t.push(!0===s?r:r+"="+s)}if(t.length)return t.join(", ")}return ue=class{constructor(e,t,{shared:r,cacheHeuristic:s,immutableMinTimeToLive:o,ignoreCargoCult:n,_fromObject:c}={}){if(c)this._fromObject(c);else{if(!t||!t.headers)throw Error("Response headers missing");this._assertRequestHasHeaders(e),this._responseTime=this.now(),this._isShared=!1!==r,this._cacheHeuristic=void 0!==s?s:.1,this._immutableMinTtl=void 0!==o?o:864e5,this._status="status"in t?t.status:200,this._resHeaders=t.headers,this._rescc=i(t.headers["cache-control"]),this._method="method"in e?e.method:"GET",this._url=e.url,this._host=e.headers.host,this._noAuthorization=!e.headers.authorization,this._reqHeaders=t.headers.vary?e.headers:null,this._reqcc=i(e.headers["cache-control"]),n&&"pre-check"in this._rescc&&"post-check"in this._rescc&&(delete this._rescc["pre-check"],delete this._rescc["post-check"],delete this._rescc["no-cache"],delete this._rescc["no-store"],delete this._rescc["must-revalidate"],this._resHeaders=Object.assign({},this._resHeaders,{"cache-control":a(this._rescc)}),delete this._resHeaders.expires,delete this._resHeaders.pragma),null==t.headers["cache-control"]&&/no-cache/.test(t.headers.pragma)&&(this._rescc["no-cache"]=!0)}}now(){return Date.now()}storable(){return!(this._reqcc["no-store"]||!("GET"===this._method||"HEAD"===this._method||"POST"===this._method&&this._hasExplicitExpiration())||!t.has(this._status)||this._rescc["no-store"]||this._isShared&&this._rescc.private||this._isShared&&!this._noAuthorization&&!this._allowsStoringAuthenticated()||!(this._resHeaders.expires||this._rescc["max-age"]||this._isShared&&this._rescc["s-maxage"]||this._rescc.public||e.has(this._status)))}_hasExplicitExpiration(){return this._isShared&&this._rescc["s-maxage"]||this._rescc["max-age"]||this._resHeaders.expires}_assertRequestHasHeaders(e){if(!e||!e.headers)throw Error("Request headers missing")}satisfiesWithoutRevalidation(e){this._assertRequestHasHeaders(e);const t=i(e.headers["cache-control"]);if(t["no-cache"]||/no-cache/.test(e.headers.pragma))return!1;if(t["max-age"]&&this.age()>t["max-age"])return!1;if(t["min-fresh"]&&this.timeToLive()<1e3*t["min-fresh"])return!1;if(this.stale()){if(!(t["max-stale"]&&!this._rescc["must-revalidate"]&&(!0===t["max-stale"]||t["max-stale"]>this.age()-this.maxAge())))return!1}return this._requestMatches(e,!1)}_requestMatches(e,t){return(!this._url||this._url===e.url)&&this._host===e.headers.host&&(!e.method||this._method===e.method||t&&"HEAD"===e.method)&&this._varyMatches(e)}_allowsStoringAuthenticated(){return this._rescc["must-revalidate"]||this._rescc.public||this._rescc["s-maxage"]}_varyMatches(e){if(!this._resHeaders.vary)return!0;if("*"===this._resHeaders.vary)return!1;const t=this._resHeaders.vary.trim().toLowerCase().split(/\s*,\s*/);for(const r of t)if(e.headers[r]!==this._reqHeaders[r])return!1;return!0}_copyWithoutHopByHopHeaders(e){const t={};for(const r in e)s[r]||(t[r]=e[r]);if(e.connection){const r=e.connection.trim().split(/\s*,\s*/);for(const e of r)delete t[e]}if(t.warning){const e=t.warning.split(/,/).filter((e=>!/^\s*1[0-9][0-9]/.test(e)));e.length?t.warning=e.join(",").trim():delete t.warning}return t}responseHeaders(){const e=this._copyWithoutHopByHopHeaders(this._resHeaders),t=this.age();return t>86400&&!this._hasExplicitExpiration()&&this.maxAge()>86400&&(e.warning=(e.warning?`${e.warning}, `:"")+'113 - "rfc7234 5.5.4"'),e.age=`${Math.round(t)}`,e.date=new Date(this.now()).toUTCString(),e}date(){const e=Date.parse(this._resHeaders.date);return isFinite(e)?e:this._responseTime}age(){return this._ageValue()+(this.now()-this._responseTime)/1e3}_ageValue(){return n(this._resHeaders.age)}maxAge(){if(!this.storable()||this._rescc["no-cache"])return 0;if(this._isShared&&this._resHeaders["set-cookie"]&&!this._rescc.public&&!this._rescc.immutable)return 0;if("*"===this._resHeaders.vary)return 0;if(this._isShared){if(this._rescc["proxy-revalidate"])return 0;if(this._rescc["s-maxage"])return n(this._rescc["s-maxage"])}if(this._rescc["max-age"])return n(this._rescc["max-age"]);const e=this._rescc.immutable?this._immutableMinTtl:0,t=this.date();if(this._resHeaders.expires){const r=Date.parse(this._resHeaders.expires);return Number.isNaN(r)||r<t?0:Math.max(e,(r-t)/1e3)}if(this._resHeaders["last-modified"]){const r=Date.parse(this._resHeaders["last-modified"]);if(isFinite(r)&&t>r)return Math.max(e,(t-r)/1e3*this._cacheHeuristic)}return e}timeToLive(){const e=this.maxAge()-this.age(),t=e+n(this._rescc["stale-if-error"]),r=e+n(this._rescc["stale-while-revalidate"]);return 1e3*Math.max(0,e,t,r)}stale(){return this.maxAge()<=this.age()}_useStaleIfError(){return this.maxAge()+n(this._rescc["stale-if-error"])>this.age()}useStaleWhileRevalidate(){return this.maxAge()+n(this._rescc["stale-while-revalidate"])>this.age()}static fromObject(e){return new this(void 0,void 0,{_fromObject:e})}_fromObject(e){if(this._responseTime)throw Error("Reinitialized");if(!e||1!==e.v)throw Error("Invalid serialization");this._responseTime=e.t,this._isShared=e.sh,this._cacheHeuristic=e.ch,this._immutableMinTtl=void 0!==e.imm?e.imm:864e5,this._status=e.st,this._resHeaders=e.resh,this._rescc=e.rescc,this._method=e.m,this._url=e.u,this._host=e.h,this._noAuthorization=e.a,this._reqHeaders=e.reqh,this._reqcc=e.reqcc}toObject(){return{v:1,t:this._responseTime,sh:this._isShared,ch:this._cacheHeuristic,imm:this._immutableMinTtl,st:this._status,resh:this._resHeaders,rescc:this._rescc,m:this._method,u:this._url,h:this._host,a:this._noAuthorization,reqh:this._reqHeaders,reqcc:this._reqcc}}revalidationHeaders(e){this._assertRequestHasHeaders(e);const t=this._copyWithoutHopByHopHeaders(e.headers);if(delete t["if-range"],!this._requestMatches(e,!0)||!this.storable())return delete t["if-none-match"],delete t["if-modified-since"],t;this._resHeaders.etag&&(t["if-none-match"]=t["if-none-match"]?`${t["if-none-match"]}, ${this._resHeaders.etag}`:this._resHeaders.etag);if(t["accept-ranges"]||t["if-match"]||t["if-unmodified-since"]||this._method&&"GET"!=this._method){if(delete t["if-modified-since"],t["if-none-match"]){const e=t["if-none-match"].split(/,/).filter((e=>!/^\s*W\//.test(e)));e.length?t["if-none-match"]=e.join(",").trim():delete t["if-none-match"]}}else this._resHeaders["last-modified"]&&!t["if-modified-since"]&&(t["if-modified-since"]=this._resHeaders["last-modified"]);return t}revalidatedPolicy(e,t){if(this._assertRequestHasHeaders(e),this._useStaleIfError()&&function(e){return!e||r.has(e.status)}(t))return{modified:!1,matches:!1,policy:this};if(!t||!t.headers)throw Error("Response headers missing");let s=!1;if(void 0!==t.status&&304!=t.status?s=!1:t.headers.etag&&!/^\s*W\//.test(t.headers.etag)?s=this._resHeaders.etag&&this._resHeaders.etag.replace(/^\s*W\//,"")===t.headers.etag:this._resHeaders.etag&&t.headers.etag?s=this._resHeaders.etag.replace(/^\s*W\//,"")===t.headers.etag.replace(/^\s*W\//,""):this._resHeaders["last-modified"]?s=this._resHeaders["last-modified"]===t.headers["last-modified"]:this._resHeaders.etag||this._resHeaders["last-modified"]||t.headers.etag||t.headers["last-modified"]||(s=!0),!s)return{policy:new this.constructor(e,t),modified:304!=t.status,matches:!1};const n={};for(const e in this._resHeaders)n[e]=e in t.headers&&!o[e]?t.headers[e]:this._resHeaders[e];const i=Object.assign({},t,{status:this._status,method:this._method,headers:n});return{policy:new this.constructor(e,i,{shared:this._isShared,cacheHeuristic:this._cacheHeuristic,immutableMinTimeToLive:this._immutableMinTtl}),modified:!1,matches:!0}}},ue}function ke(){return de?he:(de=1,he=e=>{const t={};for(const[r,s]of Object.entries(e))t[r.toLowerCase()]=s;return t})}function Te(){if(ve)return ge;ve=1;const e=o.PassThrough,t=function(){if(ye)return me;ye=1;const e=["destroy","setTimeout","socket","headers","trailers","rawHeaders","statusCode","httpVersion","httpVersionMinor","httpVersionMajor","rawTrailers","statusMessage"];return me=(t,r)=>{const s=new Set(Object.keys(t).concat(e));for(const e of s)e in r||(r[e]="function"==typeof t[e]?t[e].bind(t):t[e])}}();return ge=r=>{if(!r||!r.pipe)throw new TypeError("Parameter `response` must be a response stream.");const s=new e;return t(r,s),r.pipe(s)}}var Ce,je,Re,Ae,He,qe,Ie,Le,Me,De,Ue,Ne,$e,ze,Be,Fe,Ve,We,Ge,Je,Ke,Qe={};function Xe(){if(Re)return je;Re=1;const e=s,t=(Ce||(Ce=1,Qe.stringify=function e(t){if(void 0===t)return t;if(t&&Buffer.isBuffer(t))return JSON.stringify(":base64:"+t.toString("base64"));if(t&&t.toJSON&&(t=t.toJSON()),t&&"object"==typeof t){var r="",s=Array.isArray(t);r=s?"[":"{";var o=!0;for(var n in t){var i="function"==typeof t[n]||!s&&void 0===t[n];Object.hasOwnProperty.call(t,n)&&!i&&(o||(r+=","),o=!1,s?null==t[n]?r+="null":r+=e(t[n]):void 0!==t[n]&&(r+=e(n)+":"+e(t[n])))}return r+(s?"]":"}")}return"string"==typeof t?JSON.stringify(/^:/.test(t)?":"+t:t):void 0===t?"null":JSON.stringify(t)},Qe.parse=function(e){return JSON.parse(e,(function(e,t){return"string"==typeof t?/^:base64:/.test(t)?Buffer.from(t.substring(8),"base64"):/^:/.test(t)?t.substring(1):t:t}))}),Qe),r=e=>{const t={redis:"@keyv/redis",rediss:"@keyv/redis",mongodb:"@keyv/mongo",mongo:"@keyv/mongo",sqlite:"@keyv/sqlite",postgresql:"@keyv/postgres",postgres:"@keyv/postgres",mysql:"@keyv/mysql",etcd:"@keyv/etcd",offline:"@keyv/offline",tiered:"@keyv/tiered"};if(e.adapter||e.uri){return new(function(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}(t[e.adapter||/^[^:+]*/.exec(e.uri)[0]]))(e)}return new Map},o=["sqlite","postgres","mysql","mongo","redis","tiered"];return je=class extends e{constructor(e,{emitErrors:s=!0,...o}={}){if(super(),this.opts={namespace:"keyv",serialize:t.stringify,deserialize:t.parse,..."string"==typeof e?{uri:e}:e,...o},!this.opts.store){const e={...this.opts};this.opts.store=r(e)}if(this.opts.compression){const e=this.opts.compression;this.opts.serialize=e.serialize.bind(e),this.opts.deserialize=e.deserialize.bind(e)}"function"==typeof this.opts.store.on&&s&&this.opts.store.on("error",(e=>this.emit("error",e))),this.opts.store.namespace=this.opts.namespace;const n=e=>async function*(){for await(const[t,r]of"function"==typeof e?e(this.opts.store.namespace):e){const e=await this.opts.deserialize(r);this.opts.store.namespace&&!t.includes(this.opts.store.namespace)||("number"==typeof e.expires&&Date.now()>e.expires?this.delete(t):yield[this._getKeyUnprefix(t),e.value])}};"function"==typeof this.opts.store[Symbol.iterator]&&this.opts.store instanceof Map?this.iterator=n(this.opts.store):"function"==typeof this.opts.store.iterator&&this.opts.store.opts&&this._checkIterableAdaptar()&&(this.iterator=n(this.opts.store.iterator.bind(this.opts.store)))}_checkIterableAdaptar(){return o.includes(this.opts.store.opts.dialect)||o.findIndex((e=>this.opts.store.opts.url.includes(e)))>=0}_getKeyPrefix(e){return`${this.opts.namespace}:${e}`}_getKeyPrefixArray(e){return e.map((e=>`${this.opts.namespace}:${e}`))}_getKeyUnprefix(e){return e.split(":").splice(1).join(":")}get(e,t){const{store:r}=this.opts,s=Array.isArray(e),o=s?this._getKeyPrefixArray(e):this._getKeyPrefix(e);if(s&&void 0===r.getMany){const e=[];for(const s of o)e.push(Promise.resolve().then((()=>r.get(s))).then((e=>"string"==typeof e||this.opts.compression?this.opts.deserialize(e):e)).then((e=>{if(null!=e)return"number"==typeof e.expires&&Date.now()>e.expires?this.delete(s).then((()=>{})):t&&t.raw?e:e.value})));return Promise.allSettled(e).then((e=>{const t=[];for(const r of e)t.push(r.value);return t}))}return Promise.resolve().then((()=>s?r.getMany(o):r.get(o))).then((e=>"string"==typeof e||this.opts.compression?this.opts.deserialize(e):e)).then((r=>{if(null!=r)return s?r.map(((r,s)=>{if("string"==typeof r&&(r=this.opts.deserialize(r)),null!=r){if(!("number"==typeof r.expires&&Date.now()>r.expires))return t&&t.raw?r:r.value;this.delete(e[s]).then((()=>{}))}})):"number"==typeof r.expires&&Date.now()>r.expires?this.delete(e).then((()=>{})):t&&t.raw?r:r.value}))}set(e,t,r){const s=this._getKeyPrefix(e);void 0===r&&(r=this.opts.ttl),0===r&&(r=void 0);const{store:o}=this.opts;return Promise.resolve().then((()=>{const e="number"==typeof r?Date.now()+r:null;return"symbol"==typeof t&&this.emit("error","symbol cannot be serialized"),t={value:t,expires:e},this.opts.serialize(t)})).then((e=>o.set(s,e,r))).then((()=>!0))}delete(e){const{store:t}=this.opts;if(Array.isArray(e)){const r=this._getKeyPrefixArray(e);if(void 0===t.deleteMany){const e=[];for(const s of r)e.push(t.delete(s));return Promise.allSettled(e).then((e=>e.every((e=>!0===e.value))))}return Promise.resolve().then((()=>t.deleteMany(r)))}const r=this._getKeyPrefix(e);return Promise.resolve().then((()=>t.delete(r)))}clear(){const{store:e}=this.opts;return Promise.resolve().then((()=>e.clear()))}has(e){const t=this._getKeyPrefix(e),{store:r}=this.opts;return Promise.resolve().then((async()=>{if("function"==typeof r.has)return r.has(t);return void 0!==await r.get(t)}))}disconnect(){const{store:e}=this.opts;if("function"==typeof e.disconnect)return e.disconnect()}}}function Ye(){if(He)return Ae;He=1;const e=s,t=r,n=Y(),i=Oe(),a=Pe(),c=function(){if(pe)return fe;pe=1;const e=o.Readable,t=ke();return fe=class extends e{constructor(e,r,s,o){if("number"!=typeof e)throw new TypeError("Argument `statusCode` should be a number");if("object"!=typeof r)throw new TypeError("Argument `headers` should be an object");if(!(s instanceof Buffer))throw new TypeError("Argument `body` should be a buffer");if("string"!=typeof o)throw new TypeError("Argument `url` should be a string");super(),this.statusCode=e,this.headers=t(r),this.body=s,this.url=o}_read(){this.push(this.body),this.push(null)}}}(),u=ke(),l=Te(),h=Xe();class d{constructor(e,t){if("function"!=typeof e)throw new TypeError("Parameter `request` must be a function");return this.cache=new h({uri:"string"==typeof t&&t,store:"string"!=typeof t&&t,namespace:"cacheable-request"}),this.createCacheableRequest(e)}createCacheableRequest(r){return(s,o)=>{let h;if("string"==typeof s)h=p(t.parse(s)),s={};else if(s instanceof t.URL)h=p(t.parse(s.toString())),s={};else{const[e,...t]=(s.path||"").split("?"),r=t.length>0?`?${t.join("?")}`:"";h=p({...s,pathname:e,search:r})}(s={headers:{},method:"GET",cache:!0,strictTtl:!1,automaticFailover:!1,...s,...f(h)}).headers=u(s.headers);const m=new e,y=n(t.format(h),{stripWWW:!1,removeTrailingSlash:!1,stripAuthentication:!1}),g=`${s.method}:${y}`;let v=!1,b=!1;const _=e=>{b=!0;let t,s=!1;const n=new Promise((e=>{t=()=>{s||(s=!0,e())}})),u=t=>{if(v&&!e.forceRefresh){t.status=t.statusCode;const r=a.fromObject(v.cachePolicy).revalidatedPolicy(e,t);if(!r.modified){const e=r.policy.responseHeaders();(t=new c(v.statusCode,e,v.body,v.url)).cachePolicy=r.policy,t.fromCache=!0}}let r;t.fromCache||(t.cachePolicy=new a(e,t,e),t.fromCache=!1),e.cache&&t.cachePolicy.storable()?(r=l(t),(async()=>{try{const r=i.buffer(t);if(await Promise.race([n,new Promise((e=>t.once("end",e)))]),s)return;const o=await r,a={cachePolicy:t.cachePolicy.toObject(),url:t.url,statusCode:t.fromCache?v.statusCode:t.statusCode,body:o};let c=e.strictTtl?t.cachePolicy.timeToLive():void 0;e.maxTtl&&(c=c?Math.min(c,e.maxTtl):e.maxTtl),await this.cache.set(g,a,c)}catch(e){m.emit("error",new d.CacheError(e))}})()):e.cache&&v&&(async()=>{try{await this.cache.delete(g)}catch(e){m.emit("error",new d.CacheError(e))}})(),m.emit("response",r||t),"function"==typeof o&&o(r||t)};try{const s=r(e,u);s.once("error",t),s.once("abort",t),m.emit("request",s)}catch(e){m.emit("error",new d.RequestError(e))}};return(async()=>{const e=async e=>{await Promise.resolve();const t=e.cache?await this.cache.get(g):void 0;if(void 0===t)return _(e);const r=a.fromObject(t.cachePolicy);if(r.satisfiesWithoutRevalidation(e)&&!e.forceRefresh){const e=r.responseHeaders(),s=new c(t.statusCode,e,t.body,t.url);s.cachePolicy=r,s.fromCache=!0,m.emit("response",s),"function"==typeof o&&o(s)}else v=t,e.headers=r.revalidationHeaders(e),_(e)},t=e=>m.emit("error",new d.CacheError(e));this.cache.once("error",t),m.on("response",(()=>this.cache.removeListener("error",t)));try{await e(s)}catch(e){s.automaticFailover&&!b&&_(s),m.emit("error",new d.CacheError(e))}})(),m}}}function f(e){const t={...e};return t.path=`${e.pathname||"/"}${e.search||""}`,delete t.pathname,delete t.search,t}function p(e){return{protocol:e.protocol,auth:e.auth,hostname:e.hostname||e.host||"localhost",port:e.port,pathname:e.pathname,search:e.search}}return d.RequestError=class extends Error{constructor(e){super(e.message),this.name="RequestError",Object.assign(this,e)}},d.CacheError=class extends Error{constructor(e){super(e.message),this.name="CacheError",Object.assign(this,e)}},Ae=d}function Ze(){if(Ie)return qe;Ie=1;const e=["aborted","complete","headers","httpVersion","httpVersionMinor","httpVersionMajor","method","rawHeaders","rawTrailers","setTimeout","socket","statusCode","statusMessage","trailers","url"];return qe=(t,r)=>{if(r._readableState.autoDestroy)throw new Error("The second stream must have the `autoDestroy` option set to `false`");const s=new Set(Object.keys(t).concat(e)),o={};for(const e of s)e in r||(o[e]={get(){const r=t[e];return"function"==typeof r?r.bind(t):r},set(r){t[e]=r},enumerable:!0,configurable:!1});return Object.defineProperties(r,o),t.once("aborted",(()=>{r.destroy(),r.emit("aborted")})),t.once("close",(()=>{t.complete&&r.readable?r.once("end",(()=>{r.emit("close")})):r.emit("close")})),r}}function et(){if(Me)return Le;Me=1;const{Transform:e,PassThrough:t}=o,r=h,s=Ze();return Le=o=>{const n=(o.headers["content-encoding"]||"").toLowerCase();if(!["gzip","deflate","br"].includes(n))return o;const i="br"===n;if(i&&"function"!=typeof r.createBrotliDecompress)return o.destroy(new Error("Brotli is not supported on Node.js < 12")),o;let a=!0;const c=new e({transform(e,t,r){a=!1,r(null,e)},flush(e){e()}}),u=new t({autoDestroy:!1,destroy(e,t){o.destroy(),t(e)}}),l=i?r.createBrotliDecompress():r.createUnzip();return l.once("error",(e=>{!a||o.readable?u.destroy(e):u.end()})),s(o,u),o.pipe(c).pipe(l).pipe(u),u}}function tt(){if(Ue)return De;Ue=1;class e{constructor(e={}){if(!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=e.maxSize,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_set(e,t){if(this.cache.set(e,t),this._size++,this._size>=this.maxSize){if(this._size=0,"function"==typeof this.onEviction)for(const[e,t]of this.oldCache.entries())this.onEviction(e,t);this.oldCache=this.cache,this.cache=new Map}}get(e){if(this.cache.has(e))return this.cache.get(e);if(this.oldCache.has(e)){const t=this.oldCache.get(e);return this.oldCache.delete(e),this._set(e,t),t}}set(e,t){return this.cache.has(e)?this.cache.set(e,t):this._set(e,t),this}has(e){return this.cache.has(e)||this.oldCache.has(e)}peek(e){return this.cache.has(e)?this.cache.get(e):this.oldCache.has(e)?this.oldCache.get(e):void 0}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache)yield e;for(const e of this.oldCache){const[t]=e;this.cache.has(t)||(yield e)}}get size(){let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}}return De=e}function rt(){if($e)return Ne;$e=1;const e=s,t=f,r=d,o=tt(),n=Symbol("currentStreamsCount"),i=Symbol("request"),a=Symbol("cachedOriginSet"),c=Symbol("gracefullyClosing"),u=["maxDeflateDynamicTableSize","maxSessionMemory","maxHeaderListPairs","maxOutstandingPings","maxReservedRemoteStreams","maxSendHeaderBlockLength","paddingStrategy","localAddress","path","rejectUnauthorized","minDHSize","ca","cert","clientCertEngine","ciphers","key","pfx","servername","minVersion","maxVersion","secureProtocol","crl","honorCipherOrder","ecdhCurve","dhparam","secureOptions","sessionIdContext"],l=(e,t)=>e.remoteSettings.maxConcurrentStreams>t.remoteSettings.maxConcurrentStreams,h=(e,t)=>{for(const r of e)r[a].length<t[a].length&&r[a].every((e=>t[a].includes(e)))&&r[n]+t[n]<=t.remoteSettings.maxConcurrentStreams&&m(r)},p=({agent:e,isFree:t})=>{const r={};for(const s in e.sessions){const o=e.sessions[s].filter((e=>{const r=e[y.kCurrentStreamsCount]<e.remoteSettings.maxConcurrentStreams;return t?r:!r}));0!==o.length&&(r[s]=o)}return r},m=e=>{e[c]=!0,0===e[n]&&e.close()};class y extends e{constructor({timeout:e=6e4,maxSessions:t=1/0,maxFreeSessions:r=10,maxCachedTlsSessions:s=100}={}){super(),this.sessions={},this.queue={},this.timeout=e,this.maxSessions=t,this.maxFreeSessions=r,this._freeSessionsCount=0,this._sessionsCount=0,this.settings={enablePush:!1},this.tlsSessionCache=new o({maxSize:s})}static normalizeOrigin(e,t){return"string"==typeof e&&(e=new URL(e)),t&&e.hostname!==t&&(e.hostname=t),e.origin}normalizeOptions(e){let t="";if(e)for(const r of u)e[r]&&(t+=`:${e[r]}`);return t}_tryToCreateNewSession(e,t){if(!(e in this.queue)||!(t in this.queue[e]))return;const r=this.queue[e][t];this._sessionsCount<this.maxSessions&&!r.completed&&(r.completed=!0,r())}getSession(e,t,s){return new Promise(((o,u)=>{Array.isArray(s)?(s=[...s],o()):s=[{resolve:o,reject:u}];const d=this.normalizeOptions(t),f=y.normalizeOrigin(e,t&&t.servername);if(void 0===f){for(const{reject:e}of s)e(new TypeError("The `origin` argument needs to be a string or an URL object"));return}if(d in this.sessions){const e=this.sessions[d];let t,r=-1,o=-1;for(const s of e){const e=s.remoteSettings.maxConcurrentStreams;if(e<r)break;if(s[a].includes(f)){const i=s[n];if(i>=e||s[c]||s.destroyed)continue;t||(r=e),i>o&&(t=s,o=i)}}if(t){if(1!==s.length){for(const{reject:e}of s){e(new Error(`Expected the length of listeners to be 1, got ${s.length}.\nPlease report this to https://github.com/szmarczak/http2-wrapper/`))}return}return void s[0].resolve(t)}}if(d in this.queue){if(f in this.queue[d])return this.queue[d][f].listeners.push(...s),void this._tryToCreateNewSession(d,f)}else this.queue[d]={};const p=()=>{d in this.queue&&this.queue[d][f]===g&&(delete this.queue[d][f],0===Object.keys(this.queue[d]).length&&delete this.queue[d])},g=()=>{const o=`${f}:${d}`;let u=!1;try{const y=r.connect(e,{createConnection:this.createConnection,settings:this.settings,session:this.tlsSessionCache.get(o),...t});y[n]=0,y[c]=!1;const v=()=>y[n]<y.remoteSettings.maxConcurrentStreams;let b=!0;y.socket.once("session",(e=>{this.tlsSessionCache.set(o,e)})),y.once("error",(e=>{for(const{reject:t}of s)t(e);this.tlsSessionCache.delete(o)})),y.setTimeout(this.timeout,(()=>{y.destroy()})),y.once("close",(()=>{if(u){b&&this._freeSessionsCount--,this._sessionsCount--;const e=this.sessions[d];e.splice(e.indexOf(y),1),0===e.length&&delete this.sessions[d]}else{const e=new Error("Session closed without receiving a SETTINGS frame");e.code="HTTP2WRAPPER_NOSETTINGS";for(const{reject:t}of s)t(e);p()}this._tryToCreateNewSession(d,f)}));const _=()=>{if(d in this.queue&&v())for(const e of y[a])if(e in this.queue[d]){const{listeners:t}=this.queue[d][e];for(;0!==t.length&&v();)t.shift().resolve(y);const r=this.queue[d];if(0===r[e].listeners.length&&(delete r[e],0===Object.keys(r).length)){delete this.queue[d];break}if(!v())break}};y.on("origin",(()=>{y[a]=y.originSet,v()&&(_(),h(this.sessions[d],y))})),y.once("remoteSettings",(()=>{if(y.ref(),y.unref(),this._sessionsCount++,g.destroyed){const e=new Error("Agent has been destroyed");for(const t of s)t.reject(e);y.destroy()}else{y[a]=y.originSet;{const e=this.sessions;if(d in e){const t=e[d];t.splice(((e,t,r)=>{let s=0,o=e.length;for(;s<o;){const n=s+o>>>1;r(e[n],t)?s=n+1:o=n}return s})(t,y,l),0,y)}else e[d]=[y]}this._freeSessionsCount+=1,u=!0,this.emit("session",y),_(),p(),0===y[n]&&this._freeSessionsCount>this.maxFreeSessions&&y.close(),0!==s.length&&(this.getSession(f,t,s),s.length=0),y.on("remoteSettings",(()=>{_(),h(this.sessions[d],y)}))}})),y[i]=y.request,y.request=(e,t)=>{if(y[c])throw new Error("The session is gracefully closing. No new streams are allowed.");const r=y[i](e,t);return y.ref(),++y[n],y[n]===y.remoteSettings.maxConcurrentStreams&&this._freeSessionsCount--,r.once("close",(()=>{if(b=v(),--y[n],!y.destroyed&&!y.closed&&(((e,t)=>{for(const r of e)t[a].length<r[a].length&&t[a].every((e=>r[a].includes(e)))&&t[n]+r[n]<=r.remoteSettings.maxConcurrentStreams&&m(t)})(this.sessions[d],y),v()&&!y.closed)){b||(this._freeSessionsCount++,b=!0);const e=0===y[n];e&&y.unref(),e&&(this._freeSessionsCount>this.maxFreeSessions||y[c])?y.close():(h(this.sessions[d],y),_())}})),r}}catch(e){for(const t of s)t.reject(e);p()}};g.listeners=s,g.completed=!1,g.destroyed=!1,this.queue[d][f]=g,this._tryToCreateNewSession(d,f)}))}request(e,t,r,s){return new Promise(((o,n)=>{this.getSession(e,t,[{reject:n,resolve:e=>{try{o(e.request(r,s))}catch(e){n(e)}}}])}))}createConnection(e,t){return y.connect(e,t)}static connect(e,r){r.ALPNProtocols=["h2"];const s=e.port||443,o=e.hostname||e.host;return void 0===r.servername&&(r.servername=o),t.connect(s,o,r)}closeFreeSessions(){for(const e of Object.values(this.sessions))for(const t of e)0===t[n]&&t.close()}destroy(e){for(const t of Object.values(this.sessions))for(const r of t)r.destroy(e);for(const e of Object.values(this.queue))for(const t of Object.values(e))t.destroyed=!0;this.queue={}}get freeSessions(){return p({agent:this,isFree:!0})}get busySessions(){return p({agent:this,isFree:!1})}}return y.kCurrentStreamsCount=n,y.kGracefullyClosing=c,Ne={Agent:y,globalAgent:new y}}function st(){if(Be)return ze;Be=1;const{Readable:e}=o;return ze=class extends e{constructor(e,t){super({highWaterMark:t,autoDestroy:!1}),this.statusCode=null,this.statusMessage="",this.httpVersion="2.0",this.httpVersionMajor=2,this.httpVersionMinor=0,this.headers={},this.trailers={},this.req=null,this.aborted=!1,this.complete=!1,this.upgrade=null,this.rawHeaders=[],this.rawTrailers=[],this.socket=e,this.connection=e,this._dumped=!1}_destroy(e){this.req._request.destroy(e)}setTimeout(e,t){return this.req.setTimeout(e,t),this}_dump(){this._dumped||(this._dumped=!0,this.removeAllListeners("data"),this.resume())}_read(){this.req&&this.req._request.resume()}}}function ot(){return Ve?Fe:(Ve=1,Fe=e=>{const t={protocol:e.protocol,hostname:"string"==typeof e.hostname&&e.hostname.startsWith("[")?e.hostname.slice(1,-1):e.hostname,host:e.host,hash:e.hash,search:e.search,pathname:e.pathname,href:e.href,path:`${e.pathname||""}${e.search||""}`};return"string"==typeof e.port&&0!==e.port.length&&(t.port=Number(e.port)),(e.username||e.password)&&(t.auth=`${e.username||""}:${e.password||""}`),t})}function nt(){return Ke?Je:(Ke=1,Je=e=>{switch(e){case":method":case":scheme":case":authority":case":path":return!0;default:return!1}})}var it,at,ct,ut={exports:{}};function lt(){if(ct)return at;ct=1;const e=d,{Writable:t}=o,{Agent:r,globalAgent:s}=rt(),n=st(),i=ot(),a=Ge?We:(Ge=1,We=(e,t,r)=>{for(const s of r)e.on(s,((...e)=>t.emit(s,...e)))}),c=nt(),{ERR_INVALID_ARG_TYPE:u,ERR_INVALID_PROTOCOL:l,ERR_HTTP_HEADERS_SENT:h,ERR_INVALID_HTTP_TOKEN:f,ERR_HTTP_INVALID_HEADER_VALUE:p,ERR_INVALID_CHAR:m}=(it||(it=1,function(e){const t=(t,r,s)=>{e.exports[r]=class extends t{constructor(...e){super("string"==typeof s?s:s(e)),this.name=`${super.name} [${r}]`,this.code=r}}};t(TypeError,"ERR_INVALID_ARG_TYPE",(e=>{const t=e[0].includes(".")?"property":"argument";let r=e[1];const s=Array.isArray(r);return s&&(r=`${r.slice(0,-1).join(", ")} or ${r.slice(-1)}`),`The "${e[0]}" ${t} must be ${s?"one of":"of"} type ${r}. Received ${typeof e[2]}`})),t(TypeError,"ERR_INVALID_PROTOCOL",(e=>`Protocol "${e[0]}" not supported. Expected "${e[1]}"`)),t(Error,"ERR_HTTP_HEADERS_SENT",(e=>`Cannot ${e[0]} headers after they are sent to the client`)),t(TypeError,"ERR_INVALID_HTTP_TOKEN",(e=>`${e[0]} must be a valid HTTP token [${e[1]}]`)),t(TypeError,"ERR_HTTP_INVALID_HEADER_VALUE",(e=>`Invalid value "${e[0]} for header "${e[1]}"`)),t(TypeError,"ERR_INVALID_CHAR",(e=>`Invalid character in ${e[0]} [${e[1]}]`))}(ut)),ut.exports),{HTTP2_HEADER_STATUS:y,HTTP2_HEADER_METHOD:g,HTTP2_HEADER_PATH:v,HTTP2_METHOD_CONNECT:b}=e.constants,_=Symbol("headers"),w=Symbol("origin"),E=Symbol("session"),S=Symbol("options"),x=Symbol("flushedHeaders"),O=Symbol("jobs"),P=/^[\^`\-\w!#$%&*+.|~]+$/,k=/[^\t\u0020-\u007E\u0080-\u00FF]/;return at=class extends t{constructor(e,t,o){super({autoDestroy:!1});const n="string"==typeof e||e instanceof URL;if(n&&(e=i(e instanceof URL?e:new URL(e))),"function"==typeof t||void 0===t?(o=t,t=n?e:{...e}):t={...e,...t},t.h2session)this[E]=t.h2session;else if(!1===t.agent)this.agent=new r({maxFreeSessions:0});else if(void 0===t.agent||null===t.agent)"function"==typeof t.createConnection?(this.agent=new r({maxFreeSessions:0}),this.agent.createConnection=t.createConnection):this.agent=s;else{if("function"!=typeof t.agent.request)throw new u("options.agent",["Agent-like Object","undefined","false"],t.agent);this.agent=t.agent}if(t.protocol&&"https:"!==t.protocol)throw new l(t.protocol,"https:");const a=t.port||t.defaultPort||this.agent&&this.agent.defaultPort||443,c=t.hostname||t.host||"localhost";delete t.hostname,delete t.host,delete t.port;const{timeout:h}=t;if(t.timeout=void 0,this[_]=Object.create(null),this[O]=[],this.socket=null,this.connection=null,this.method=t.method||"GET",this.path=t.path,this.res=null,this.aborted=!1,this.reusedSocket=!1,t.headers)for(const[e,r]of Object.entries(t.headers))this.setHeader(e,r);t.auth&&!("authorization"in this[_])&&(this[_].authorization="Basic "+Buffer.from(t.auth).toString("base64")),t.session=t.tlsSession,t.path=t.socketPath,this[S]=t,443===a?(this[w]=`https://${c}`,":authority"in this[_]||(this[_][":authority"]=c)):(this[w]=`https://${c}:${a}`,":authority"in this[_]||(this[_][":authority"]=`${c}:${a}`)),h&&this.setTimeout(h),o&&this.once("response",o),this[x]=!1}get method(){return this[_][g]}set method(e){e&&(this[_][g]=e.toUpperCase())}get path(){return this[_][v]}set path(e){e&&(this[_][v]=e)}get _mustNotHaveABody(){return"GET"===this.method||"HEAD"===this.method||"DELETE"===this.method}_write(e,t,r){if(this._mustNotHaveABody)return void r(new Error("The GET, HEAD and DELETE methods must NOT have a body"));this.flushHeaders();const s=()=>this._request.write(e,t,r);this._request?s():this[O].push(s)}_final(e){if(this.destroyed)return;this.flushHeaders();const t=()=>{this._mustNotHaveABody?e():this._request.end(e)};this._request?t():this[O].push(t)}abort(){this.res&&this.res.complete||(this.aborted||process.nextTick((()=>this.emit("abort"))),this.aborted=!0,this.destroy())}_destroy(e,t){this.res&&this.res._dump(),this._request&&this._request.destroy(),t(e)}async flushHeaders(){if(this[x]||this.destroyed)return;this[x]=!0;const e=this.method===b,t=t=>{if(this._request=t,this.destroyed)return void t.destroy();e||a(t,this,["timeout","continue","close","error"]);const r=e=>(...t)=>{this.writable||this.destroyed?this.once("finish",(()=>{e(...t)})):e(...t)};t.once("response",r(((r,s,o)=>{const i=new n(this.socket,t.readableHighWaterMark);this.res=i,i.req=this,i.statusCode=r[y],i.headers=r,i.rawHeaders=o,i.once("end",(()=>{this.aborted?(i.aborted=!0,i.emit("aborted")):(i.complete=!0,i.socket=null,i.connection=null)})),e?(i.upgrade=!0,this.emit("connect",i,t,Buffer.alloc(0))?this.emit("close"):t.destroy()):(t.on("data",(e=>{i._dumped||i.push(e)||t.pause()})),t.once("end",(()=>{i.push(null)})),this.emit("response",i)||i._dump())}))),t.once("headers",r((e=>this.emit("information",{statusCode:e[y]})))),t.once("trailers",r(((e,t,r)=>{const{res:s}=this;s.trailers=e,s.rawTrailers=r})));const{socket:s}=t.session;this.socket=s,this.connection=s;for(const e of this[O])e();this.emit("socket",this.socket)};if(this[E])try{t(this[E].request(this[_]))}catch(e){this.emit("error",e)}else{this.reusedSocket=!0;try{t(await this.agent.request(this[w],this[S],this[_]))}catch(e){this.emit("error",e)}}}getHeader(e){if("string"!=typeof e)throw new u("name","string",e);return this[_][e.toLowerCase()]}get headersSent(){return this[x]}removeHeader(e){if("string"!=typeof e)throw new u("name","string",e);if(this.headersSent)throw new h("remove");delete this[_][e.toLowerCase()]}setHeader(e,t){if(this.headersSent)throw new h("set");if("string"!=typeof e||!P.test(e)&&!c(e))throw new f("Header name",e);if(void 0===t)throw new p(t,e);if(k.test(t))throw new m("header content",e);this[_][e.toLowerCase()]=t}setNoDelay(){}setSocketKeepAlive(){}setTimeout(e,t){const r=()=>this._request.setTimeout(e,t);return this._request?r():this[O].push(r),this}get maxHeadersCount(){if(!this.destroyed&&this._request)return this._request.session.localSettings.maxHeaderListSize}set maxHeadersCount(e){}},at}var ht,dt,ft,pt,mt,yt,gt,vt={exports:{}};function bt(){if(pt)return ft;pt=1;const e=p;return ft=t=>{let r=t.host;const s=t.headers&&t.headers.host;if(s)if(s.startsWith("[")){r=-1===s.indexOf("]")?s:s.slice(1,-1)}else r=s.split(":",1)[0];return e.isIP(r)?"":r}}function _t(){if(mt)return vt.exports;mt=1;const e=i,t=a,r=function(){if(dt)return ht;dt=1;const e=f;return ht=(t={},r=e.connect)=>new Promise(((e,s)=>{let o,n=!1;const i=async()=>{await c,o.off("timeout",a),o.off("error",s),t.resolveSocket?(e({alpnProtocol:o.alpnProtocol,socket:o,timeout:n}),n&&(await Promise.resolve(),o.emit("timeout"))):(o.destroy(),e({alpnProtocol:o.alpnProtocol,timeout:n}))},a=async()=>{n=!0,i()},c=(async()=>{try{o=await r(t,i),o.on("error",s),o.once("timeout",a)}catch(e){s(e)}})()}))}(),s=tt(),o=lt(),n=bt(),c=ot(),u=new s({maxSize:100}),l=new Map,h=(e,t,r)=>{t._httpMessage={shouldKeepAlive:!0};const s=()=>{e.emit("free",t,r)};t.on("free",s);const o=()=>{e.removeSocket(t,r)};t.on("close",o);const n=()=>{e.removeSocket(t,r),t.off("close",o),t.off("free",s),t.off("agentRemove",n)};t.on("agentRemove",n),e.emit("free",t,r)};return vt.exports=async(s,i,a)=>{if(("string"==typeof s||s instanceof URL)&&(s=c(new URL(s))),"function"==typeof i&&(a=i,i=void 0),i={ALPNProtocols:["h2","http/1.1"],...s,...i,resolveSocket:!0},!Array.isArray(i.ALPNProtocols)||0===i.ALPNProtocols.length)throw new Error("The `ALPNProtocols` option must be an Array with at least one entry");i.protocol=i.protocol||"https:";const d="https:"===i.protocol;i.host=i.hostname||i.host||"localhost",i.session=i.tlsSession,i.servername=i.servername||n(i),i.port=i.port||(d?443:80),i._defaultAgent=d?t.globalAgent:e.globalAgent;const f=i.agent;if(f){if(f.addRequest)throw new Error("The `options.agent` object can contain only `http`, `https` or `http2` properties");i.agent=f[d?"https":"http"]}if(d){const e=await(async e=>{const s=`${e.host}:${e.port}:${e.ALPNProtocols.sort()}`;if(!u.has(s)){if(l.has(s))return(await l.get(s)).alpnProtocol;const{path:o,agent:n}=e;e.path=e.socketPath;const i=r(e);l.set(s,i);try{const{socket:r,alpnProtocol:a}=await i;if(u.set(s,a),e.path=o,"h2"===a)r.destroy();else{const{globalAgent:s}=t,o=t.Agent.prototype.createConnection;n?n.createConnection===o?h(n,r,e):r.destroy():s.createConnection===o?h(s,r,e):r.destroy()}return l.delete(s),a}catch(e){throw l.delete(s),e}}return u.get(s)})(i);if("h2"===e)return f&&(i.agent=f.http2),new o(i,a)}return e.request(i,a)},vt.exports.protocolCache=u,vt.exports}var wt,Et,St={},xt={};function Ot(){if(wt)return xt;wt=1,Object.defineProperty(xt,"__esModule",{value:!0});const e=L();return xt.default=t=>e.default.nodeStream(t)&&e.default.function_(t.getBoundary),xt}function Pt(){if(Et)return St;Et=1,Object.defineProperty(St,"__esModule",{value:!0});const e=n,r=t,s=L(),o=Ot(),i=r.promisify(e.stat);return St.default=async(t,n)=>{if(n&&"content-length"in n)return Number(n["content-length"]);if(!t)return 0;if(s.default.string(t))return Buffer.byteLength(t);if(s.default.buffer(t))return t.length;if(o.default(t))return r.promisify(t.getLength.bind(t))();if(t instanceof e.ReadStream){const{size:e}=await i(t.path);if(0===e)return;return e}},St}var kt,Tt={};function Ct(){if(kt)return Tt;return kt=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=function(e,t,r){const s={};for(const o of r)s[o]=(...e)=>{t.emit(o,...e)},e.on(o,s[o]);return()=>{for(const t of r)e.off(t,s[t])}},Tt}var jt,Rt,At={},Ht={};function qt(){return jt||(jt=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.default=()=>{const e=[];return{once(t,r,s){t.once(r,s),e.push({origin:t,event:r,fn:s})},unhandleAll(){for(const t of e){const{origin:e,event:r,fn:s}=t;e.removeListener(r,s)}e.length=0}}}),Ht}function It(){if(Rt)return At;Rt=1,Object.defineProperty(At,"__esModule",{value:!0}),At.TimeoutError=void 0;const e=p,t=qt(),r=Symbol("reentry"),s=()=>{};class o extends Error{constructor(e,t){super(`Timeout awaiting '${t}' for ${e}ms`),this.event=t,this.name="TimeoutError",this.code="ETIMEDOUT"}}return At.TimeoutError=o,At.default=(n,i,a)=>{if(r in n)return s;n[r]=!0;const c=[],{once:u,unhandleAll:l}=t.default(),h=(e,t,r)=>{var s;const o=setTimeout(t,e,e,r);null===(s=o.unref)||void 0===s||s.call(o);const n=()=>{clearTimeout(o)};return c.push(n),n},{host:d,hostname:f}=a,p=(e,t)=>{n.destroy(new o(e,t))},m=()=>{for(const e of c)e();l()};if(n.once("error",(e=>{if(m(),0===n.listenerCount("error"))throw e})),n.once("close",m),u(n,"response",(e=>{u(e,"end",m)})),void 0!==i.request&&h(i.request,p,"request"),void 0!==i.socket){const e=()=>{p(i.socket,"socket")};n.setTimeout(i.socket,e),c.push((()=>{n.removeListener("timeout",e)}))}return u(n,"socket",(t=>{var r;const{socketPath:s}=n;if(t.connecting){const o=Boolean(null!=s?s:0!==e.isIP(null!==(r=null!=f?f:d)&&void 0!==r?r:""));if(void 0!==i.lookup&&!o&&void 0===t.address().address){const e=h(i.lookup,p,"lookup");u(t,"lookup",e)}if(void 0!==i.connect){const e=()=>h(i.connect,p,"connect");o?u(t,"connect",e()):u(t,"lookup",(r=>{null===r&&u(t,"connect",e())}))}void 0!==i.secureConnect&&"https:"===a.protocol&&u(t,"connect",(()=>{const e=h(i.secureConnect,p,"secureConnect");u(t,"secureConnect",e)}))}if(void 0!==i.send){const e=()=>h(i.send,p,"send");t.connecting?u(t,"connect",(()=>{u(n,"upload-complete",e())})):u(n,"upload-complete",e())}})),void 0!==i.response&&u(n,"upload-complete",(()=>{const e=h(i.response,p,"response");u(n,"response",e)})),m},At}var Lt,Mt={};function Dt(){if(Lt)return Mt;Lt=1,Object.defineProperty(Mt,"__esModule",{value:!0});const e=L();return Mt.default=t=>{const r={protocol:t.protocol,hostname:e.default.string(t.hostname)&&t.hostname.startsWith("[")?t.hostname.slice(1,-1):t.hostname,host:t.host,hash:t.hash,search:t.search,pathname:t.pathname,href:t.href,path:`${t.pathname||""}${t.search||""}`};return e.default.string(t.port)&&t.port.length>0&&(r.port=Number(t.port)),(t.username||t.password)&&(r.auth=`${t.username||""}:${t.password||""}`),r},Mt}var Ut,Nt={};function $t(){if(Ut)return Nt;Ut=1,Object.defineProperty(Nt,"__esModule",{value:!0});const e=r,t=["protocol","host","hostname","port","pathname","search"];return Nt.default=(r,s)=>{var o,n;if(s.path){if(s.pathname)throw new TypeError("Parameters `path` and `pathname` are mutually exclusive.");if(s.search)throw new TypeError("Parameters `path` and `search` are mutually exclusive.");if(s.searchParams)throw new TypeError("Parameters `path` and `searchParams` are mutually exclusive.")}if(s.search&&s.searchParams)throw new TypeError("Parameters `search` and `searchParams` are mutually exclusive.");if(!r){if(!s.protocol)throw new TypeError("No URL protocol specified");r=`${s.protocol}//${null!==(n=null!==(o=s.hostname)&&void 0!==o?o:s.host)&&void 0!==n?n:""}`}const i=new e.URL(r);if(s.path){const e=s.path.indexOf("?");-1===e?s.pathname=s.path:(s.pathname=s.path.slice(0,e),s.search=s.path.slice(e+1)),delete s.path}for(const e of t)s[e]&&(i[e]=s[e].toString());return i},Nt}var zt,Bt={};function Ft(){if(zt)return Bt;zt=1,Object.defineProperty(Bt,"__esModule",{value:!0});return Bt.default=class{constructor(){this.weakMap=new WeakMap,this.map=new Map}set(e,t){"object"==typeof e?this.weakMap.set(e,t):this.map.set(e,t)}get(e){return"object"==typeof e?this.weakMap.get(e):this.map.get(e)}has(e){return"object"==typeof e?this.weakMap.has(e):this.map.has(e)}},Bt}var Vt,Wt={};function Gt(){if(Vt)return Wt;Vt=1,Object.defineProperty(Wt,"__esModule",{value:!0});return Wt.default=async e=>{const t=[];let r=0;for await(const s of e)t.push(s),r+=Buffer.byteLength(s);return Buffer.isBuffer(t[0])?Buffer.concat(t,r):Buffer.from(t.join(""))},Wt}var Jt,Kt={};function Qt(){return Jt||(Jt=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.dnsLookupIpVersionToFamily=e.isDnsLookupIpVersion=void 0;const t={auto:0,ipv4:4,ipv6:6};e.isDnsLookupIpVersion=e=>e in t,e.dnsLookupIpVersionToFamily=r=>{if(e.isDnsLookupIpVersion(r))return t[r];throw new Error("Invalid DNS lookup IP version")}}(Kt)),Kt}var Xt,Yt={};function Zt(){return Xt||(Xt=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.isResponseOk=void 0,Yt.isResponseOk=e=>{const{statusCode:t}=e,r=e.request.options.followRedirect?299:399;return t>=200&&t<=r||304===t}),Yt}var er,tr={};function rr(){if(er)return tr;er=1,Object.defineProperty(tr,"__esModule",{value:!0});const e=new Set;return tr.default=t=>{e.has(t)||(e.add(t),process.emitWarning(`Got: ${t}`,{type:"DeprecationWarning"}))},tr}var sr,or={};function nr(){if(sr)return or;sr=1,Object.defineProperty(or,"__esModule",{value:!0});const e=L();return or.default=(t,r)=>{if(e.default.null_(t.encoding))throw new TypeError("To get a Buffer, set `options.responseType` to `buffer` instead");e.assert.any([e.default.string,e.default.undefined],t.encoding),e.assert.any([e.default.boolean,e.default.undefined],t.resolveBodyOnly),e.assert.any([e.default.boolean,e.default.undefined],t.methodRewriting),e.assert.any([e.default.boolean,e.default.undefined],t.isStream),e.assert.any([e.default.string,e.default.undefined],t.responseType),void 0===t.responseType&&(t.responseType="text");const{retry:s}=t;if(t.retry=r?{...r.retry}:{calculateDelay:e=>e.computedValue,limit:0,methods:[],statusCodes:[],errorCodes:[],maxRetryAfter:void 0},e.default.object(s)?(t.retry={...t.retry,...s},t.retry.methods=[...new Set(t.retry.methods.map((e=>e.toUpperCase())))],t.retry.statusCodes=[...new Set(t.retry.statusCodes)],t.retry.errorCodes=[...new Set(t.retry.errorCodes)]):e.default.number(s)&&(t.retry.limit=s),e.default.undefined(t.retry.maxRetryAfter)&&(t.retry.maxRetryAfter=Math.min(...[t.timeout.request,t.timeout.connect].filter(e.default.number))),e.default.object(t.pagination)){r&&(t.pagination={...r.pagination,...t.pagination});const{pagination:s}=t;if(!e.default.function_(s.transform))throw new Error("`options.pagination.transform` must be implemented");if(!e.default.function_(s.shouldContinue))throw new Error("`options.pagination.shouldContinue` must be implemented");if(!e.default.function_(s.filter))throw new TypeError("`options.pagination.filter` must be implemented");if(!e.default.function_(s.paginate))throw new Error("`options.pagination.paginate` must be implemented")}return"json"===t.responseType&&void 0===t.headers.accept&&(t.headers.accept="application/json"),t},or}var ir,ar,cr,ur={};function lr(){if(ir)return ur;ir=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.retryAfterStatusCodes=void 0,ur.retryAfterStatusCodes=new Set([413,429,503]);return ur.default=({attemptCount:e,retryOptions:t,error:r,retryAfter:s})=>{if(e>t.limit)return 0;const o=t.methods.includes(r.options.method),n=t.errorCodes.includes(r.code),i=r.response&&t.statusCodes.includes(r.response.statusCode);if(!o||!n&&!i)return 0;if(r.response){if(s)return void 0===t.maxRetryAfter||s>t.maxRetryAfter?0:s;if(413===r.response.statusCode)return 0}return 2**(e-1)*1e3+100*Math.random()},ur}function hr(){return ar||(ar=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.UnsupportedProtocolError=e.ReadError=e.TimeoutError=e.UploadError=e.CacheError=e.HTTPError=e.MaxRedirectsError=e.RequestError=e.setNonEnumerableProperties=e.knownHookEvents=e.withoutBody=e.kIsNormalizedAlready=void 0;const s=t,c=o,u=n,l=r,h=i,f=i,p=a,m=W(),y=X(),g=Ye(),v=et(),b=function(){if(gt)return yt;gt=1;const e=d,t=rt(),r=lt(),s=st(),o=_t();return yt={...e,ClientRequest:r,IncomingMessage:s,...t,request:(e,t,s)=>new r(e,t,s),get:(e,t,s)=>{const o=new r(e,t,s);return o.end(),o},auto:o}}(),_=ke(),w=L(),E=Pt(),S=Ot(),x=Ct(),O=It(),P=Dt(),k=$t(),T=Ft(),C=Gt(),j=Qt(),R=Zt(),A=rr(),H=nr(),q=lr();let I;const M=Symbol("request"),D=Symbol("response"),U=Symbol("responseSize"),N=Symbol("downloadedSize"),$=Symbol("bodySize"),z=Symbol("uploadedSize"),B=Symbol("serverResponsesPiped"),F=Symbol("unproxyEvents"),V=Symbol("isFromCache"),G=Symbol("cancelTimeouts"),J=Symbol("startedReading"),K=Symbol("stopReading"),Q=Symbol("triggerRead"),Y=Symbol("body"),Z=Symbol("jobs"),ee=Symbol("originalResponse"),te=Symbol("retryTimeout");e.kIsNormalizedAlready=Symbol("isNormalizedAlready");const re=w.default.string(process.versions.brotli);e.withoutBody=new Set(["GET","HEAD"]),e.knownHookEvents=["init","beforeRequest","beforeRedirect","beforeError","beforeRetry","afterResponse"];const se=new T.default,oe=new Set([300,301,302,303,304,307,308]),ne=["context","body","json","form"];e.setNonEnumerableProperties=(e,t)=>{const r={};for(const t of e)if(t)for(const e of ne)e in t&&(r[e]={writable:!0,configurable:!0,enumerable:!1,value:t[e]});Object.defineProperties(t,r)};class ie extends Error{constructor(e,t,r){var s,o;if(super(e),Error.captureStackTrace(this,this.constructor),this.name="RequestError",this.code=null!==(s=t.code)&&void 0!==s?s:"ERR_GOT_REQUEST_ERROR",r instanceof me?(Object.defineProperty(this,"request",{enumerable:!1,value:r}),Object.defineProperty(this,"response",{enumerable:!1,value:r[D]}),Object.defineProperty(this,"options",{enumerable:!1,value:r.options})):Object.defineProperty(this,"options",{enumerable:!1,value:r}),this.timings=null===(o=this.request)||void 0===o?void 0:o.timings,w.default.string(t.stack)&&w.default.string(this.stack)){const e=this.stack.indexOf(this.message)+this.message.length,r=this.stack.slice(e).split("\n").reverse(),s=t.stack.slice(t.stack.indexOf(t.message)+t.message.length).split("\n").reverse();for(;0!==s.length&&s[0]===r[0];)r.shift();this.stack=`${this.stack.slice(0,e)}${r.reverse().join("\n")}${s.reverse().join("\n")}`}}}e.RequestError=ie;class ae extends ie{constructor(e){super(`Redirected ${e.options.maxRedirects} times. Aborting.`,{},e),this.name="MaxRedirectsError",this.code="ERR_TOO_MANY_REDIRECTS"}}e.MaxRedirectsError=ae;class ce extends ie{constructor(e){super(`Response code ${e.statusCode} (${e.statusMessage})`,{},e.request),this.name="HTTPError",this.code="ERR_NON_2XX_3XX_RESPONSE"}}e.HTTPError=ce;class ue extends ie{constructor(e,t){super(e.message,e,t),this.name="CacheError",this.code="ERR_GOT_REQUEST_ERROR"===this.code?"ERR_CACHE_ACCESS":this.code}}e.CacheError=ue;class le extends ie{constructor(e,t){super(e.message,e,t),this.name="UploadError",this.code="ERR_GOT_REQUEST_ERROR"===this.code?"ERR_UPLOAD":this.code}}e.UploadError=le;class he extends ie{constructor(e,t,r){super(e.message,e,r),this.name="TimeoutError",this.event=e.event,this.timings=t}}e.TimeoutError=he;class de extends ie{constructor(e,t){super(e.message,e,t),this.name="ReadError",this.code="ERR_GOT_REQUEST_ERROR"===this.code?"ERR_READING_RESPONSE_STREAM":this.code}}e.ReadError=de;class fe extends ie{constructor(e){super(`Unsupported protocol "${e.url.protocol}"`,{},e),this.name="UnsupportedProtocolError",this.code="ERR_UNSUPPORTED_PROTOCOL"}}e.UnsupportedProtocolError=fe;const pe=["socket","connect","continue","information","upgrade","timeout"];class me extends c.Duplex{constructor(t,r={},s){super({autoDestroy:!1,highWaterMark:0}),this[N]=0,this[z]=0,this.requestInitialized=!1,this[B]=new Set,this.redirects=[],this[K]=!1,this[Q]=!1,this[Z]=[],this.retryCount=0,this._progressCallbacks=[];const o=()=>this._unlockWrite(),n=()=>this._lockWrite();this.on("pipe",(e=>{e.prependListener("data",o),e.on("data",n),e.prependListener("end",o),e.on("end",n)})),this.on("unpipe",(e=>{e.off("data",o),e.off("data",n),e.off("end",o),e.off("end",n)})),this.on("pipe",(e=>{e instanceof f.IncomingMessage&&(this.options.headers={...e.headers,...this.options.headers})}));const{json:i,body:a,form:c}=r;if((i||a||c)&&this._lockWrite(),e.kIsNormalizedAlready in r)this.options=r;else try{this.options=this.constructor.normalizeArguments(t,r,s)}catch(e){return w.default.nodeStream(r.body)&&r.body.destroy(),void this.destroy(e)}(async()=>{var e;try{this.options.body instanceof u.ReadStream&&await(async e=>new Promise(((t,r)=>{const s=e=>{r(e)};e.pending||t(),e.once("error",s),e.once("ready",(()=>{e.off("error",s),t()}))})))(this.options.body);const{url:t}=this.options;if(!t)throw new TypeError("Missing `url` property");if(this.requestUrl=t.toString(),decodeURI(this.requestUrl),await this._finalizeBody(),await this._makeRequest(),this.destroyed)return void(null===(e=this[M])||void 0===e||e.destroy());for(const e of this[Z])e();this[Z].length=0,this.requestInitialized=!0}catch(e){if(e instanceof ie)return void this._beforeError(e);this.destroyed||this.destroy(e)}})()}static normalizeArguments(t,r,o){var n,i,a,c,u;const h=r;if(w.default.object(t)&&!w.default.urlInstance(t))r={...o,...t,...r};else{if(t&&r&&void 0!==r.url)throw new TypeError("The `url` option is mutually exclusive with the `input` argument");r={...o,...r},void 0!==t&&(r.url=t),w.default.urlInstance(r.url)&&(r.url=new l.URL(r.url.toString()))}if(!1===r.cache&&(r.cache=void 0),!1===r.dnsCache&&(r.dnsCache=void 0),w.assert.any([w.default.string,w.default.undefined],r.method),w.assert.any([w.default.object,w.default.undefined],r.headers),w.assert.any([w.default.string,w.default.urlInstance,w.default.undefined],r.prefixUrl),w.assert.any([w.default.object,w.default.undefined],r.cookieJar),w.assert.any([w.default.object,w.default.string,w.default.undefined],r.searchParams),w.assert.any([w.default.object,w.default.string,w.default.undefined],r.cache),w.assert.any([w.default.object,w.default.number,w.default.undefined],r.timeout),w.assert.any([w.default.object,w.default.undefined],r.context),w.assert.any([w.default.object,w.default.undefined],r.hooks),w.assert.any([w.default.boolean,w.default.undefined],r.decompress),w.assert.any([w.default.boolean,w.default.undefined],r.ignoreInvalidCookies),w.assert.any([w.default.boolean,w.default.undefined],r.followRedirect),w.assert.any([w.default.number,w.default.undefined],r.maxRedirects),w.assert.any([w.default.boolean,w.default.undefined],r.throwHttpErrors),w.assert.any([w.default.boolean,w.default.undefined],r.http2),w.assert.any([w.default.boolean,w.default.undefined],r.allowGetBody),w.assert.any([w.default.string,w.default.undefined],r.localAddress),w.assert.any([j.isDnsLookupIpVersion,w.default.undefined],r.dnsLookupIpVersion),w.assert.any([w.default.object,w.default.undefined],r.https),w.assert.any([w.default.boolean,w.default.undefined],r.rejectUnauthorized),r.https&&(w.assert.any([w.default.boolean,w.default.undefined],r.https.rejectUnauthorized),w.assert.any([w.default.function_,w.default.undefined],r.https.checkServerIdentity),w.assert.any([w.default.string,w.default.object,w.default.array,w.default.undefined],r.https.certificateAuthority),w.assert.any([w.default.string,w.default.object,w.default.array,w.default.undefined],r.https.key),w.assert.any([w.default.string,w.default.object,w.default.array,w.default.undefined],r.https.certificate),w.assert.any([w.default.string,w.default.undefined],r.https.passphrase),w.assert.any([w.default.string,w.default.buffer,w.default.array,w.default.undefined],r.https.pfx)),w.assert.any([w.default.object,w.default.undefined],r.cacheOptions),w.default.string(r.method)?r.method=r.method.toUpperCase():r.method="GET",r.headers===(null==o?void 0:o.headers)?r.headers={...r.headers}:r.headers=_({...null==o?void 0:o.headers,...r.headers}),"slashes"in r)throw new TypeError("The legacy `url.Url` has been deprecated. Use `URL` instead.");if("auth"in r)throw new TypeError("Parameter `auth` is deprecated. Use `username` / `password` instead.");if("searchParams"in r&&r.searchParams&&r.searchParams!==(null==o?void 0:o.searchParams)){let e;if(w.default.string(r.searchParams)||r.searchParams instanceof l.URLSearchParams)e=new l.URLSearchParams(r.searchParams);else{!function(e){for(const t in e){const r=e[t];if(!(w.default.string(r)||w.default.number(r)||w.default.boolean(r)||w.default.null_(r)||w.default.undefined(r)))throw new TypeError(`The \`searchParams\` value '${String(r)}' must be a string, number, boolean or null`)}}(r.searchParams),e=new l.URLSearchParams;for(const t in r.searchParams){const s=r.searchParams[t];null===s?e.append(t,""):void 0!==s&&e.append(t,s)}}null===(n=null==o?void 0:o.searchParams)||void 0===n||n.forEach(((t,r)=>{e.has(r)||e.append(r,t)})),r.searchParams=e}if(r.username=null!==(i=r.username)&&void 0!==i?i:"",r.password=null!==(a=r.password)&&void 0!==a?a:"",w.default.undefined(r.prefixUrl)?r.prefixUrl=null!==(c=null==o?void 0:o.prefixUrl)&&void 0!==c?c:"":(r.prefixUrl=r.prefixUrl.toString(),""===r.prefixUrl||r.prefixUrl.endsWith("/")||(r.prefixUrl+="/")),w.default.string(r.url)){if(r.url.startsWith("/"))throw new Error("`input` must not start with a slash when using `prefixUrl`");r.url=k.default(r.prefixUrl+r.url,r)}else(w.default.undefined(r.url)&&""!==r.prefixUrl||r.protocol)&&(r.url=k.default(r.prefixUrl,r));if(r.url){"port"in r&&delete r.port;let{prefixUrl:e}=r;Object.defineProperty(r,"prefixUrl",{set:t=>{const s=r.url;if(!s.href.startsWith(t))throw new Error(`Cannot change \`prefixUrl\` from ${e} to ${t}: ${s.href}`);r.url=new l.URL(t+s.href.slice(e.length)),e=t},get:()=>e});let{protocol:t}=r.url;if("unix:"===t&&(t="http:",r.url=new l.URL(`http://unix${r.url.pathname}${r.url.search}`)),r.searchParams&&(r.url.search=r.searchParams.toString()),"http:"!==t&&"https:"!==t)throw new fe(r);""===r.username?r.username=r.url.username:r.url.username=r.username,""===r.password?r.password=r.url.password:r.url.password=r.password}const{cookieJar:d}=r;if(d){let{setCookie:e,getCookieString:t}=d;w.assert.function_(e),w.assert.function_(t),4===e.length&&0===t.length&&(e=s.promisify(e.bind(r.cookieJar)),t=s.promisify(t.bind(r.cookieJar)),r.cookieJar={setCookie:e,getCookieString:t})}const{cache:f}=r;if(f&&(se.has(f)||se.set(f,new g(((e,t)=>{const r=e[M](e,t);return w.default.promise(r)&&(r.once=(e,t)=>{if("error"===e)r.catch(t);else{if("abort"!==e)throw new Error(`Unknown HTTP2 promise event: ${e}`);(async()=>{try{(await r).once("abort",t)}catch(e){}})()}return r}),r}),f))),r.cacheOptions={...r.cacheOptions},!0===r.dnsCache)I||(I=new y.default),r.dnsCache=I;else if(!w.default.undefined(r.dnsCache)&&!r.dnsCache.lookup)throw new TypeError(`Parameter \`dnsCache\` must be a CacheableLookup instance or a boolean, got ${w.default(r.dnsCache)}`);w.default.number(r.timeout)?r.timeout={request:r.timeout}:o&&r.timeout!==o.timeout?r.timeout={...o.timeout,...r.timeout}:r.timeout={...r.timeout},r.context||(r.context={});const p=r.hooks===(null==o?void 0:o.hooks);r.hooks={...r.hooks};for(const t of e.knownHookEvents)if(t in r.hooks){if(!w.default.array(r.hooks[t]))throw new TypeError(`Parameter \`${t}\` must be an Array, got ${w.default(r.hooks[t])}`);r.hooks[t]=[...r.hooks[t]]}else r.hooks[t]=[];if(o&&!p)for(const t of e.knownHookEvents){o.hooks[t].length>0&&(r.hooks[t]=[...o.hooks[t],...r.hooks[t]])}if("family"in r&&A.default('"options.family" was never documented, please use "options.dnsLookupIpVersion"'),(null==o?void 0:o.https)&&(r.https={...o.https,...r.https}),"rejectUnauthorized"in r&&A.default('"options.rejectUnauthorized" is now deprecated, please use "options.https.rejectUnauthorized"'),"checkServerIdentity"in r&&A.default('"options.checkServerIdentity" was never documented, please use "options.https.checkServerIdentity"'),"ca"in r&&A.default('"options.ca" was never documented, please use "options.https.certificateAuthority"'),"key"in r&&A.default('"options.key" was never documented, please use "options.https.key"'),"cert"in r&&A.default('"options.cert" was never documented, please use "options.https.certificate"'),"passphrase"in r&&A.default('"options.passphrase" was never documented, please use "options.https.passphrase"'),"pfx"in r&&A.default('"options.pfx" was never documented, please use "options.https.pfx"'),"followRedirects"in r)throw new TypeError("The `followRedirects` option does not exist. Use `followRedirect` instead.");if(r.agent)for(const e in r.agent)if("http"!==e&&"https"!==e&&"http2"!==e)throw new TypeError(`Expected the \`options.agent\` properties to be \`http\`, \`https\` or \`http2\`, got \`${e}\``);return r.maxRedirects=null!==(u=r.maxRedirects)&&void 0!==u?u:0,e.setNonEnumerableProperties([o,h],r),H.default(r,o)}_lockWrite(){const e=()=>{throw new TypeError("The payload has been already provided")};this.write=e,this.end=e}_unlockWrite(){this.write=super.write,this.end=super.end}async _finalizeBody(){const{options:t}=this,{headers:r}=t,s=!w.default.undefined(t.form),o=!w.default.undefined(t.json),n=!w.default.undefined(t.body),i=s||o||n,a=e.withoutBody.has(t.method)&&!("GET"===t.method&&t.allowGetBody);if(this._cannotHaveBody=a,i){if(a)throw new TypeError(`The \`${t.method}\` method cannot be used with a body`);if([n,s,o].filter((e=>e)).length>1)throw new TypeError("The `body`, `json` and `form` options are mutually exclusive");if(n&&!(t.body instanceof c.Readable)&&!w.default.string(t.body)&&!w.default.buffer(t.body)&&!S.default(t.body))throw new TypeError("The `body` option must be a stream.Readable, string or Buffer");if(s&&!w.default.object(t.form))throw new TypeError("The `form` option must be an Object");{const e=!w.default.string(r["content-type"]);n?(S.default(t.body)&&e&&(r["content-type"]=`multipart/form-data; boundary=${t.body.getBoundary()}`),this[Y]=t.body):s?(e&&(r["content-type"]="application/x-www-form-urlencoded"),this[Y]=new l.URLSearchParams(t.form).toString()):(e&&(r["content-type"]="application/json"),this[Y]=t.stringifyJson(t.json));const o=await E.default(this[Y],t.headers);w.default.undefined(r["content-length"])&&w.default.undefined(r["transfer-encoding"])&&(a||w.default.undefined(o)||(r["content-length"]=String(o)))}}else a?this._lockWrite():this._unlockWrite();this[$]=Number(r["content-length"])||void 0}async _onResponseBase(e){const{options:t}=this,{url:r}=t;this[ee]=e,t.decompress&&(e=v(e));const s=e.statusCode,o=e;o.statusMessage=o.statusMessage?o.statusMessage:h.STATUS_CODES[s],o.url=t.url.toString(),o.requestUrl=this.requestUrl,o.redirectUrls=this.redirects,o.request=this,o.isFromCache=e.fromCache||!1,o.ip=this.ip,o.retryCount=this.retryCount,this[V]=o.isFromCache,this[U]=Number(e.headers["content-length"])||void 0,this[D]=e,e.once("end",(()=>{this[U]=this[N],this.emit("downloadProgress",this.downloadProgress)})),e.once("error",(t=>{e.destroy(),this._beforeError(new de(t,this))})),e.once("aborted",(()=>{this._beforeError(new de({name:"Error",message:"The server aborted pending request",code:"ECONNRESET"},this))})),this.emit("downloadProgress",this.downloadProgress);const n=e.headers["set-cookie"];if(w.default.object(t.cookieJar)&&n){let i=n.map((async e=>t.cookieJar.setCookie(e,r.toString())));t.ignoreInvalidCookies&&(i=i.map((async e=>e.catch((()=>{})))));try{await Promise.all(i)}catch(a){return void this._beforeError(a)}}if(t.followRedirect&&e.headers.location&&oe.has(s)){e.resume(),this[M]&&(this[G](),delete this[M],this[F]());if(!(303===s&&"GET"!==t.method&&"HEAD"!==t.method)&&t.methodRewriting||(t.method="GET","body"in t&&delete t.body,"json"in t&&delete t.json,"form"in t&&delete t.form,this[Y]=void 0,delete t.headers["content-length"]),this.redirects.length>=t.maxRedirects)return void this._beforeError(new ae(this));try{const c=Buffer.from(e.headers.location,"binary").toString(),u=new l.URL(c,r),d=u.toString();function f(e){return"unix:"===e.protocol||"unix"===e.hostname}if(decodeURI(d),!f(r)&&f(u))return void this._beforeError(new ie("Cannot redirect to UNIX socket",{},this));u.hostname!==r.hostname||u.port!==r.port?("host"in t.headers&&delete t.headers.host,"cookie"in t.headers&&delete t.headers.cookie,"authorization"in t.headers&&delete t.headers.authorization,(t.username||t.password)&&(t.username="",t.password="")):(u.username=t.username,u.password=t.password),this.redirects.push(d),t.url=u;for(const p of t.hooks.beforeRedirect)await p(t,o);this.emit("redirect",o,t),await this._makeRequest()}catch(m){return void this._beforeError(m)}}else if(t.isStream&&t.throwHttpErrors&&!R.isResponseOk(o))this._beforeError(new ce(o));else{e.on("readable",(()=>{this[Q]&&this._read()})),this.on("resume",(()=>{e.resume()})),this.on("pause",(()=>{e.pause()})),e.once("end",(()=>{this.push(null)})),this.emit("response",e);for(const y of this[B])if(!y.headersSent){for(const g in e.headers){const b=!t.decompress||"content-encoding"!==g,_=e.headers[g];b&&y.setHeader(g,_)}y.statusCode=s}}}async _onResponse(e){try{await this._onResponseBase(e)}catch(e){this._beforeError(e)}}_onRequest(e){const{options:t}=this,{timeout:r,url:s}=t;m.default(e),this[G]=O.default(e,r,s);const o=t.cache?"cacheableResponse":"response";e.once(o,(e=>{this._onResponse(e)})),e.once("error",(t=>{var r;e.destroy(),null===(r=e.res)||void 0===r||r.removeAllListeners("end"),t=t instanceof O.TimeoutError?new he(t,this.timings,this):new ie(t.message,t,this),this._beforeError(t)})),this[F]=x.default(e,this,pe),this[M]=e,this.emit("uploadProgress",this.uploadProgress);const n=this[Y],i=0===this.redirects.length?this:e;w.default.nodeStream(n)?(n.pipe(i),n.once("error",(e=>{this._beforeError(new le(e,this))}))):(this._unlockWrite(),w.default.undefined(n)?(this._cannotHaveBody||this._noPipe)&&(i.end(),this._lockWrite()):(this._writeRequest(n,void 0,(()=>{})),i.end(),this._lockWrite())),this.emit("request",e)}async _createCacheableRequest(e,t){return new Promise(((r,s)=>{let o;Object.assign(t,P.default(e)),delete t.url;const n=se.get(t.cache)(t,(async e=>{e._readableState.autoDestroy=!1,o&&(await o).emit("cacheableResponse",e),r(e)}));t.url=e,n.once("error",s),n.once("request",(async e=>{o=e,r(o)}))}))}async _makeRequest(){var e,t,r,s,o;const{options:n}=this,{headers:i}=n;for(const e in i)if(w.default.undefined(i[e]))delete i[e];else if(w.default.null_(i[e]))throw new TypeError(`Use \`undefined\` instead of \`null\` to delete the \`${e}\` header`);if(n.decompress&&w.default.undefined(i["accept-encoding"])&&(i["accept-encoding"]=re?"gzip, deflate, br":"gzip, deflate"),n.cookieJar){const e=await n.cookieJar.getCookieString(n.url.toString());w.default.nonEmptyString(e)&&(n.headers.cookie=e)}for(const e of n.hooks.beforeRequest){const t=await e(n);if(!w.default.undefined(t)){n.request=()=>t;break}}n.body&&this[Y]!==n.body&&(this[Y]=n.body);const{agent:a,request:c,timeout:u,url:l}=n;if(n.dnsCache&&!("lookup"in n)&&(n.lookup=n.dnsCache.lookup),"unix"===l.hostname){const e=/(?<socketPath>.+?):(?<path>.+)/.exec(`${l.pathname}${l.search}`);if(null==e?void 0:e.groups){const{socketPath:t,path:r}=e.groups;Object.assign(n,{socketPath:t,path:r,host:""})}}const d="https:"===l.protocol;let f;f=n.http2?b.auto:d?p.request:h.request;const m=null!==(e=n.request)&&void 0!==e?e:f,y=n.cache?this._createCacheableRequest:m;a&&!n.http2&&(n.agent=a[d?"https":"http"]),n[M]=m,delete n.request,delete n.timeout;const v=n;if(v.shared=null===(t=n.cacheOptions)||void 0===t?void 0:t.shared,v.cacheHeuristic=null===(r=n.cacheOptions)||void 0===r?void 0:r.cacheHeuristic,v.immutableMinTimeToLive=null===(s=n.cacheOptions)||void 0===s?void 0:s.immutableMinTimeToLive,v.ignoreCargoCult=null===(o=n.cacheOptions)||void 0===o?void 0:o.ignoreCargoCult,void 0!==n.dnsLookupIpVersion)try{v.family=j.dnsLookupIpVersionToFamily(n.dnsLookupIpVersion)}catch(e){throw new Error("Invalid `dnsLookupIpVersion` option value")}n.https&&("rejectUnauthorized"in n.https&&(v.rejectUnauthorized=n.https.rejectUnauthorized),n.https.checkServerIdentity&&(v.checkServerIdentity=n.https.checkServerIdentity),n.https.certificateAuthority&&(v.ca=n.https.certificateAuthority),n.https.certificate&&(v.cert=n.https.certificate),n.https.key&&(v.key=n.https.key),n.https.passphrase&&(v.passphrase=n.https.passphrase),n.https.pfx&&(v.pfx=n.https.pfx));try{let e=await y(l,v);w.default.undefined(e)&&(e=f(l,v)),n.request=c,n.timeout=u,n.agent=a,n.https&&("rejectUnauthorized"in n.https&&delete v.rejectUnauthorized,n.https.checkServerIdentity&&delete v.checkServerIdentity,n.https.certificateAuthority&&delete v.ca,n.https.certificate&&delete v.cert,n.https.key&&delete v.key,n.https.passphrase&&delete v.passphrase,n.https.pfx&&delete v.pfx),!function(e){return w.default.object(e)&&!("statusCode"in e)}(e)?this.writable?(this.once("finish",(()=>{this._onResponse(e)})),this._unlockWrite(),this.end(),this._lockWrite()):this._onResponse(e):this._onRequest(e)}catch(e){if(e instanceof g.CacheError)throw new ue(e,this);throw new ie(e.message,e,this)}}async _error(e){try{for(const t of this.options.hooks.beforeError)e=await t(e)}catch(t){e=new ie(t.message,t,this)}this.destroy(e)}_beforeError(e){if(this[K])return;const{options:t}=this,r=this.retryCount+1;this[K]=!0,e instanceof ie||(e=new ie(e.message,e,this));const s=e,{response:o}=s;(async()=>{if(o&&!o.body){o.setEncoding(this._readableState.encoding);try{o.rawBody=await C.default(o),o.body=o.rawBody.toString()}catch(e){}}if(0!==this.listenerCount("retry")){let n;try{let e;o&&"retry-after"in o.headers&&(e=Number(o.headers["retry-after"]),Number.isNaN(e)?(e=Date.parse(o.headers["retry-after"])-Date.now(),e<=0&&(e=1)):e*=1e3),n=await t.retry.calculateDelay({attemptCount:r,retryOptions:t.retry,error:s,retryAfter:e,computedValue:q.default({attemptCount:r,retryOptions:t.retry,error:s,retryAfter:e,computedValue:0})})}catch(e){return void this._error(new ie(e.message,e,this))}if(n){const t=async()=>{try{for(const e of this.options.hooks.beforeRetry)await e(this.options,s,r)}catch(t){return void this._error(new ie(t.message,e,this))}this.destroyed||(this.destroy(),this.emit("retry",r,e))};return void(this[te]=setTimeout(t,n))}}this._error(s)})()}_read(){this[Q]=!0;const e=this[D];if(e&&!this[K]){let t;for(e.readableLength&&(this[Q]=!1);null!==(t=e.read());){this[N]+=t.length,this[J]=!0;const e=this.downloadProgress;e.percent<1&&this.emit("downloadProgress",e),this.push(t)}}}_write(e,t,r){const s=()=>{this._writeRequest(e,t,r)};this.requestInitialized?s():this[Z].push(s)}_writeRequest(e,t,r){this[M].destroyed||(this._progressCallbacks.push((()=>{this[z]+=Buffer.byteLength(e,t);const r=this.uploadProgress;r.percent<1&&this.emit("uploadProgress",r)})),this[M].write(e,t,(e=>{!e&&this._progressCallbacks.length>0&&this._progressCallbacks.shift()(),r(e)})))}_final(e){const t=()=>{for(;0!==this._progressCallbacks.length;)this._progressCallbacks.shift()();M in this?this[M].destroyed?e():this[M].end((t=>{t||(this[$]=this[z],this.emit("uploadProgress",this.uploadProgress),this[M].emit("upload-complete")),e(t)})):e()};this.requestInitialized?t():this[Z].push(t)}_destroy(e,t){var r;this[K]=!0,clearTimeout(this[te]),M in this&&(this[G](),(null===(r=this[D])||void 0===r?void 0:r.complete)||this[M].destroy()),null===e||w.default.undefined(e)||e instanceof ie||(e=new ie(e.message,e,this)),t(e)}get _isAboutToError(){return this[K]}get ip(){var e;return null===(e=this.socket)||void 0===e?void 0:e.remoteAddress}get aborted(){var e,t,r;return(null!==(t=null===(e=this[M])||void 0===e?void 0:e.destroyed)&&void 0!==t?t:this.destroyed)&&!(null===(r=this[ee])||void 0===r?void 0:r.complete)}get socket(){var e,t;return null!==(t=null===(e=this[M])||void 0===e?void 0:e.socket)&&void 0!==t?t:void 0}get downloadProgress(){let e;return e=this[U]?this[N]/this[U]:this[U]===this[N]?1:0,{percent:e,transferred:this[N],total:this[U]}}get uploadProgress(){let e;return e=this[$]?this[z]/this[$]:this[$]===this[z]?1:0,{percent:e,transferred:this[z],total:this[$]}}get timings(){var e;return null===(e=this[M])||void 0===e?void 0:e.timings}get isFromCache(){return this[V]}pipe(e,t){if(this[J])throw new Error("Failed to pipe. The response has been emitted already.");return e instanceof f.ServerResponse&&this[B].add(e),super.pipe(e,t)}unpipe(e){return e instanceof f.ServerResponse&&this[B].delete(e),super.unpipe(e),this}}e.default=me}(B)),B}function dr(){return cr||(cr=1,function(e){var t=z.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),r=z.__exportStar||function(e,r){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(r,s)||t(r,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.CancelError=e.ParseError=void 0;const s=hr();class o extends s.RequestError{constructor(e,t){const{options:r}=t.request;super(`${e.message} in "${r.url.toString()}"`,e,t.request),this.name="ParseError",this.code="ERR_GOT_REQUEST_ERROR"===this.code?"ERR_BODY_PARSE_FAILURE":this.code}}e.ParseError=o;class n extends s.RequestError{constructor(e){super("Promise was canceled",{},e),this.name="CancelError",this.code="ERR_CANCELED"}get isCanceled(){return!0}}e.CancelError=n,r(hr(),e)}(z)),z}var fr,pr,mr={};function yr(){if(fr)return mr;fr=1,Object.defineProperty(mr,"__esModule",{value:!0});const e=dr();return mr.default=(t,r,s,o)=>{const{rawBody:n}=t;try{if("text"===r)return n.toString(o);if("json"===r)return 0===n.length?"":s(n.toString());if("buffer"===r)return n;throw new e.ParseError({message:`Unknown body type '${r}'`,name:"Error"},t)}catch(r){throw new e.ParseError(r,t)}},mr}function gr(){return pr||(pr=1,function(e){var t=D.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),r=D.__exportStar||function(e,r){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(r,s)||t(r,e,s)};Object.defineProperty(e,"__esModule",{value:!0});const o=s,n=L(),i=function(){if(M)return U.exports;M=1;class e extends Error{constructor(e){super(e||"Promise was canceled"),this.name="CancelError"}get isCanceled(){return!0}}class t{static fn(e){return(...r)=>new t(((t,s,o)=>{r.push(o),e(...r).then(t,s)}))}constructor(e){this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._rejectOnCancel=!0,this._promise=new Promise(((t,r)=>{this._reject=r;const s=e=>{if(!this._isPending)throw new Error("The `onCancel` handler was attached after the promise settled.");this._cancelHandlers.push(e)};return Object.defineProperties(s,{shouldReject:{get:()=>this._rejectOnCancel,set:e=>{this._rejectOnCancel=e}}}),e((e=>{this._isCanceled&&s.shouldReject||(this._isPending=!1,t(e))}),(e=>{this._isPending=!1,r(e)}),s)}))}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}cancel(t){if(this._isPending&&!this._isCanceled){if(this._isCanceled=!0,this._cancelHandlers.length>0)try{for(const e of this._cancelHandlers)e()}catch(e){return void this._reject(e)}this._rejectOnCancel&&this._reject(new e(t))}}get isCanceled(){return this._isCanceled}}return Object.setPrototypeOf(t.prototype,Promise.prototype),U.exports=t,U.exports.CancelError=e,U.exports}(),a=dr(),c=yr(),u=hr(),l=Ct(),h=Gt(),d=Zt(),f=["request","response","redirect","uploadProgress","downloadProgress"];e.default=function e(t){let r,s;const p=new o.EventEmitter,m=new i(((o,i,y)=>{const g=v=>{const b=new u.default(void 0,t);b.retryCount=v,b._noPipe=!0,y((()=>b.destroy())),y.shouldReject=!1,y((()=>i(new a.CancelError(b)))),r=b,b.once("response",(async t=>{var r;if(t.retryCount=v,t.request.aborted)return;let n;try{n=await h.default(b),t.rawBody=n}catch(e){return}if(b._isAboutToError)return;const i=(null!==(r=t.headers["content-encoding"])&&void 0!==r?r:"").toLowerCase(),l=["gzip","deflate","br"].includes(i),{options:f}=b;if(l&&!f.decompress)t.body=n;else try{t.body=c.default(t,f.responseType,f.parseJson,f.encoding)}catch(e){if(t.body=n.toString(),d.isResponseOk(t))return void b._beforeError(e)}try{for(const[r,s]of f.hooks.afterResponse.entries())t=await s(t,(async t=>{const s=u.default.normalizeArguments(void 0,{...t,retry:{calculateDelay:()=>0},throwHttpErrors:!1,resolveBodyOnly:!1},f);s.hooks.afterResponse=s.hooks.afterResponse.slice(0,r);for(const e of s.hooks.beforeRetry)await e(s);const o=e(s);return y((()=>{o.catch((()=>{})),o.cancel()})),o}))}catch(e){return void b._beforeError(new a.RequestError(e.message,e,b))}s=t,d.isResponseOk(t)?(b.destroy(),o(b.options.resolveBodyOnly?t.body:t)):b._beforeError(new a.HTTPError(t))}));const _=e=>{if(m.isCanceled)return;const{options:t}=b;if(e instanceof a.HTTPError&&!t.throwHttpErrors){const{response:t}=e;o(b.options.resolveBodyOnly?t.body:t)}else i(e)};b.once("error",_);const w=b.options.body;b.once("retry",((e,t)=>{var r,s;w===(null===(r=t.request)||void 0===r?void 0:r.options.body)&&n.default.nodeStream(null===(s=t.request)||void 0===s?void 0:s.options.body)?_(t):g(e)})),l.default(b,p,f)};g(0)}));m.on=(e,t)=>(p.on(e,t),m);const y=e=>{const t=(async()=>{await m;const{options:t}=s.request;return c.default(s,e,t.parseJson,t.encoding)})();return Object.defineProperties(t,Object.getOwnPropertyDescriptors(m)),t};return m.json=()=>{const{headers:e}=r.options;return r.writableFinished||void 0!==e.accept||(e.accept="application/json"),y("json")},m.buffer=()=>y("buffer"),m.text=()=>y("text"),m},r(dr(),e)}(D)),D}var vr,br={};function _r(){if(vr)return br;vr=1,Object.defineProperty(br,"__esModule",{value:!0});const e=dr();return br.default=function(t,...r){const s=(async()=>{if(t instanceof e.RequestError)try{for(const e of r)if(e)for(const r of e)t=await r(t)}catch(e){t=e}throw t})(),o=()=>s;return s.json=o,s.text=o,s.buffer=o,s.on=o,s},br}var wr,Er={};function Sr(){if(wr)return Er;wr=1,Object.defineProperty(Er,"__esModule",{value:!0});const e=L();return Er.default=function t(r){for(const s of Object.values(r))(e.default.plainObject(s)||e.default.array(s))&&t(s);return Object.freeze(r)},Er}var xr,Or,Pr={};function kr(){return xr||(xr=1,Object.defineProperty(Pr,"__esModule",{value:!0})),Pr}function Tr(){return Or||(Or=1,function(e){var t=q.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),r=q.__exportStar||function(e,r){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(r,s)||t(r,e,s)};Object.defineProperty(e,"__esModule",{value:!0}),e.defaultHandler=void 0;const s=L(),o=gr(),n=_r(),i=hr(),a=Sr(),c={RequestError:o.RequestError,CacheError:o.CacheError,ReadError:o.ReadError,HTTPError:o.HTTPError,MaxRedirectsError:o.MaxRedirectsError,TimeoutError:o.TimeoutError,ParseError:o.ParseError,CancelError:o.CancelError,UnsupportedProtocolError:o.UnsupportedProtocolError,UploadError:o.UploadError},u=async e=>new Promise((t=>{setTimeout(t,e)})),{normalizeArguments:l}=i.default,h=(...e)=>{let t;for(const r of e)t=l(void 0,r,t);return t},d=e=>e.isStream?new i.default(void 0,e):o.default(e),f=e=>"defaults"in e&&"options"in e.defaults,p=["get","post","put","patch","head","delete"];e.defaultHandler=(e,t)=>t(e);const m=(e,t)=>{if(e)for(const r of e)r(t)},y=t=>{t._rawHandlers=t.handlers,t.handlers=t.handlers.map((e=>(t,r)=>{let s;const o=e(t,(e=>(s=r(e),s)));if(o!==s&&!t.isStream&&s){const e=o,{then:t,catch:r,finally:n}=e;Object.setPrototypeOf(e,Object.getPrototypeOf(s)),Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)),e.then=t,e.catch=r,e.finally=n}return o}));const r=(e,r={},a)=>{var c,u;let h=0;const f=e=>t.handlers[h++](e,h===t.handlers.length?d:f);if(s.default.plainObject(e)){const t={...e,...r};i.setNonEnumerableProperties([e,r],t),r=t,e=void 0}try{let s;try{m(t.options.hooks.init,r),m(null===(c=r.hooks)||void 0===c?void 0:c.init,r)}catch(e){s=e}const n=l(e,r,null!=a?a:t.options);if(n[i.kIsNormalizedAlready]=!0,s)throw new o.RequestError(s.message,s,n);return f(n)}catch(e){if(r.isStream)throw e;return n.default(e,t.options.hooks.beforeError,null===(u=r.hooks)||void 0===u?void 0:u.beforeError)}};r.extend=(...r)=>{const s=[t.options];let o,n=[...t._rawHandlers];for(const e of r)f(e)?(s.push(e.defaults.options),n.push(...e.defaults._rawHandlers),o=e.defaults.mutableDefaults):(s.push(e),"handlers"in e&&n.push(...e.handlers),o=e.mutableDefaults);return n=n.filter((t=>t!==e.defaultHandler)),0===n.length&&n.push(e.defaultHandler),y({options:h(...s),handlers:n,mutableDefaults:Boolean(o)})};const g=async function*(e,o){let n=l(e,o,t.options);n.resolveBodyOnly=!1;const i=n.pagination;if(!s.default.object(i))throw new TypeError("`options.pagination` must be implemented");const a=[];let{countLimit:c}=i,h=0;for(;h<i.requestLimit;){0!==h&&await u(i.backoff);const e=await r(void 0,void 0,n),t=await i.transform(e),s=[];for(const e of t)if(i.filter(e,a,s)){if(!i.shouldContinue(e,a,s))return;if(yield e,i.stackAllItems&&a.push(e),s.push(e),--c<=0)return}const o=i.paginate(e,a,s);if(!1===o)return;o===e.request.options?n=e.request.options:void 0!==o&&(n=l(void 0,o,n)),h++}};(r.paginate=g).all=async(e,t)=>{const r=[];for await(const s of g(e,t))r.push(s);return r},r.paginate.each=g,r.stream=(e,t)=>r(e,{...t,isStream:!0});for(const e of p)r[e]=(t,s)=>r(t,{...s,method:e}),r.stream[e]=(t,s)=>r(t,{...s,method:e,isStream:!0});return Object.assign(r,c),Object.defineProperty(r,"defaults",{value:t.mutableDefaults?t:a.default(t),writable:t.mutableDefaults,configurable:t.mutableDefaults,enumerable:!0}),r.mergeOptions=h,r};e.default=y,r(kr(),e)}(q)),q}var Cr,jr=H.exports;function Rr(){return Cr||(Cr=1,function(e,t){var s=jr&&jr.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),o=jr&&jr.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0});const n=r,i=Tr(),a={options:{method:"GET",retry:{limit:2,methods:["GET","PUT","HEAD","DELETE","OPTIONS","TRACE"],statusCodes:[408,413,429,500,502,503,504,521,522,524],errorCodes:["ETIMEDOUT","ECONNRESET","EADDRINUSE","ECONNREFUSED","EPIPE","ENOTFOUND","ENETUNREACH","EAI_AGAIN"],maxRetryAfter:void 0,calculateDelay:({computedValue:e})=>e},timeout:{},headers:{"user-agent":"got (https://github.com/sindresorhus/got)"},hooks:{init:[],beforeRequest:[],beforeRedirect:[],beforeRetry:[],beforeError:[],afterResponse:[]},cache:void 0,dnsCache:void 0,decompress:!0,throwHttpErrors:!0,followRedirect:!0,isStream:!1,responseType:"text",resolveBodyOnly:!1,maxRedirects:10,prefixUrl:"",methodRewriting:!0,ignoreInvalidCookies:!1,context:{},http2:!1,allowGetBody:!1,https:void 0,pagination:{transform:e=>"json"===e.request.options.responseType?e.body:JSON.parse(e.body),paginate:e=>{if(!Reflect.has(e.headers,"link"))return!1;const t=e.headers.link.split(",");let r;for(const e of t){const t=e.split(";");if(t[1].includes("next")){r=t[0].trimStart().trim(),r=r.slice(1,-1);break}}if(r){return{url:new n.URL(r)}}return!1},filter:()=>!0,shouldContinue:()=>!0,countLimit:1/0,backoff:0,requestLimit:1e4,stackAllItems:!0},parseJson:e=>JSON.parse(e),stringifyJson:e=>JSON.stringify(e),cacheOptions:{}},handlers:[i.defaultHandler],mutableDefaults:!1},c=i.default(a);t.default=c,e.exports=c,e.exports.default=c,e.exports.__esModule=!0,o(Tr(),t),o(gr(),t)}(H,H.exports)),H.exports}var Ar,Hr={};var qr,Ir,Lr={};var Mr=function(){if(Ir)return A;Ir=1;var e=A.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(o,n){function i(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((s=s.apply(e,t||[])).next())}))},t=A.__rest||function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(r[s[o]]=e[s[o]])}return r},r=A.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(A,"__esModule",{value:!0}),A.httpPlugin=A.HttpController=void 0;const o=r(Rr()),n=s,i=m,a=(Ar||(Ar=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.pathMap=Hr.ReportURL=void 0,Hr.ReportURL={cn:"https://mcs.zijieapi.com",sg:"https://sgali-mcs.byteoversea.com",va:"https://maliva-mcs.byteoversea.com"},Hr.pathMap={REPORT_PATH:"/v1/list",ABConfigPath:"/service/2/abtest_config/"}),Hr),c=(qr||(qr=1,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.divide=void 0,Lr.divide=function(e,t){return e.reduce(((e,r)=>{let s=e[e.length-1];return s.length>=t&&(s=[],e.push(s)),s.push(r),e}),[[]])}),Lr);function u(e){try{return JSON.parse(e||"{}")}catch(e){return{}}}class l extends n.EventEmitter{constructor(e,t){super(),this.options=e,this.channelDomain=t,this.pending=!1,this.queue=[],this.name="http"}get concurrent(){return this.options.concurrent||10}flush(){return e(this,void 0,void 0,(function*(){if(this.pending)return;this.pending=!0;const e=this.queue.splice(0,this.concurrent),t=[],{event_verify_url:r,retry:s,timeout:n}=this.options;let c=!1;try{if(e.length){if(r){this.pluginContext.logger.trace("verify %d events with event verify url: %s",e.length);const i=(0,o.default)(r,{method:"POST",retry:s,json:e.map((({event:e})=>Object.assign(Object.assign({},e),{verbose:1}))),timeout:n}).then((t=>{this.pluginContext.logger.trace("verify events %o result %s",e.map((e=>e.id)),t.body)})).catch((e=>{const t=null==e?void 0:e.stack,r=null==e?void 0:e.message;t&&r?this.pluginContext.logger.error("network error: %s $o",r,t):this.pluginContext.logger.error("network error: %o",e)}));t.push(i)}this.pluginContext.logger.trace("with channel domain %s",this.channelDomain);const u=(0,o.default)((0,i.join)(this.channelDomain,a.pathMap.REPORT_PATH),{method:"POST",retry:s,json:e.map((({event:e})=>Object.assign(Object.assign({},e),{verbose:1}))),timeout:n}).then((t=>{c=!0,this.pluginContext.logger.trace("sent events %o result %s",e.map((({id:e})=>e)),t.body)})).catch((e=>{const t=null==e?void 0:e.stack,r=null==e?void 0:e.message;t&&r?this.pluginContext.logger.trace("network error: %s %o",r,t):this.pluginContext.logger.trace("network error: %o",e)}));t.push(u)}yield Promise.all(t).finally((()=>{var t,r;for(const{event:s}of e)this.emit("end",{event:s,hasSucceed:c}),null===(r=(t=this.options).onEnd)||void 0===r||r.call(t,s,c)}))}finally{this.pending=!1}this.queue.length>0?this.flush():(this.pluginContext.logger.trace("queue drained, last sent %d",e.length),this.emit("drain",{lastEvents:e,hasSucceed:c}))}))}install(e){this.pluginContext=e}onSendEvent({event:e,id:r}){const{events:s}=e,o=t(e,["events"]),n=(0,c.divide)(s,50).map((e=>({id:r,event:Object.assign(Object.assign({},o),{events:e})})));this.queue.push(...n),this.flush()}getVar(t,r){var s,o,n,i;return e(this,void 0,void 0,(function*(){const{header:e,user:a}=this.pluginContext.metaInfo,c=Object.assign(Object.assign(Object.assign(Object.assign({aid:e.app_id},e),a),null==r?void 0:r.extraProperties),{custom:Object.assign(Object.assign({},u(e.custom)),null==r?void 0:r.extraProperties.custom)});this.pluginContext.logger.trace("abRequest config: %o",c);const l=yield this.abRequest(c,{timeout:null==r?void 0:r.timeout});if(null===(s=l[t])||void 0===s?void 0:s.vid){const{user_unique_id:e,uuid:s}=null!==(o=null==r?void 0:r.extraProperties)&&void 0!==o?o:{};this.pluginContext.logger.trace("abtest_exposure name: %s, vid: %s, val: %o",t,l[t].vid,l[t].val),this.pluginContext.collect([{extra:{ab_sdk_version:String(l[t].vid)},name:"abtest_exposure",params:{}}],{user:{user_unique_id:e||s},header:{ab_sdk_version:String(l[t].vid)}})}return null!==(i=null===(n=l[t])||void 0===n?void 0:n.val)&&void 0!==i?i:null==r?void 0:r.defaultValue}))}getAllVars(t){return e(this,void 0,void 0,(function*(){const{header:e,user:r}=this.pluginContext.metaInfo,s=Object.assign(Object.assign(Object.assign(Object.assign({aid:e.app_id},e),r),null==t?void 0:t.extraProperties),{custom:Object.assign(Object.assign({},u(e.custom)),null==t?void 0:t.extraProperties.custom)});return this.pluginContext.logger.trace("abRequest config: %o",s),this.abRequest(s,{timeout:null==t?void 0:t.timeout})}))}abRequest(t,r){return e(this,void 0,void 0,(function*(){let e;try{const t=new URL(this.options.abServiceOrigin);t.pathname=a.pathMap.ABConfigPath,e=t.toJSON(),this.pluginContext.logger.trace("request abtest config with url %s",e)}catch(e){this.pluginContext.logger.error("invalid service origin %O",e)}if(!e)return{};const s=(0,o.default)(e,{method:"POST",json:{header:t},responseType:"json",timeout:r.timeout}).then((e=>{var t;return this.pluginContext.logger.trace("abRequest response %O",e.body),null===(t=e.body)||void 0===t?void 0:t.data}));return(yield s.catch((e=>{this.pluginContext.logger.error("unexpected_error_when_request_ab_ata"),this.pluginContext.logger.error(e)})))||{}}))}}return A.HttpController=l,A.httpPlugin=function(e){const t=e.channel_domain||e.channel&&a.ReportURL[e.channel];if(!t)throw new Error("plugin 'http': channel or channel_domain can't be both undefined");return new l(e,t)},A}();function Dr(e){const t=new R.TeaSDK(e),r=Mr.httpPlugin(e);return t.use(r),new Nr(t,r)}function Ur(e){const{appId:t,channel:r,serviceOrigin:s,channelDomain:o}=y(e);return Dr({app_id:t,logLevel:"verbose",channel:r,retry:5,abServiceOrigin:s,enable_ab_test:!!s,ab_channel_domain:o,disable_auto_pv:!0,enable_ttwebid:!0,cross_subdomain:!0,...e})}class Nr{_appId;_tea;_httpPluginInstance;constructor(e,t){this._tea=e,this._httpPluginInstance=t,this._appId=e.meta.appId}collect(e,t){Array.isArray(e)&&this._tea.collect(e),"string"==typeof e&&this._tea.collect(e,t||{})}predefinePageView(e){this._tea.collect("predefinePageView",e)}config(e){this._tea.config(e)}getVar(e,t){return this._httpPluginInstance.getVar(e,t)}getAllVars(e){return this._httpPluginInstance.getAllVars(e)}getSDK(){return this._tea}getAppID(){return this._appId}}export{Nr as TeaClient,Ur as createDefaultTeaClient,Dr as createTeaClient};
