"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("crypto-js/md5")),a=e(require("crypto-js/enc-base64")),o=e(require("crypto-js/enc-hex")),n=e(require("crypto-js/enc-utf8")),i=require("stream"),r=e(require("lodash/get")),s=e(require("lodash/set")),c=e(require("qs")),p=e(require("crypto")),l=e(require("axios")),d=e(require("http")),u=e(require("https")),h=require("tos-crc64-js"),m=e(require("debug")),f=e(require("fs")),y=require("util"),g=e(require("path")),x=e(require("lodash/cloneDeep"));class b extends Error{constructor(e){super(e),Object.setPrototypeOf(this,b.prototype)}}class k extends Error{constructor(e){super(e),Object.setPrototypeOf(this,k.prototype)}}const v=e=>t=>{if(null==e||"object"!=typeof e)return;const a=r(e,t);Array.isArray(a)||s(e,t,null==a?[]:[a])},T=e=>{const t=a=>Array.isArray(a)?a.map(e=>t(e)):"string"==typeof a?e(a):"object"==typeof a&&null!=a?Object.keys(a).reduce((e,o)=>(e[t(o)]=a[o],e),{}):a;return t},w=T(e=>e.replace(/[A-Z]/g,"-$&").toLowerCase()),S=T(e=>e[0].toUpperCase()+e.slice(1)),C=e=>{const t=[];return Object.keys(e).sort().forEach(a=>{t.push(`${encodeURIComponent(a)}=${encodeURIComponent(e[a])}`)}),t.join("&")},E=e=>{const t=e||{},a={};Object.keys(t).forEach(e=>{null!=t[e]&&(a[e]=t[e])});const o={};return Object.keys(a).forEach(e=>{const t=e.toLowerCase();o[t]=a[e]}),o},R=e=>("string"==typeof e&&(e={url:e}),e);async function P(e){try{return[null,await e]}catch(e){return[e,null]}}function B(e){return"undefined"!=typeof Blob&&e instanceof Blob}function I(e){return"undefined"!=typeof Buffer&&e instanceof Buffer}function D(e){return e instanceof i.Readable}function j(e){return e?Object.keys(e).map(t=>{const a=""+e[t];return`${encodeURIComponent(t)}=${encodeURIComponent(a)}`}).join("&"):""}function O(e){return e instanceof k}const M=e=>"string"==typeof e?e:e.toUTCString(),_={projectName:"x-tos-project-name",encodingType:"encoding-type",cacheControl:"cache-control",contentDisposition:"content-disposition",contentLength:"content-length",contentMD5:"content-md5",contentSHA256:"x-tos-content-sha256",contentEncoding:"content-encoding",contentLanguage:"content-language",contentType:"content-type",expires:["expires",e=>e.toUTCString()],range:"range",ifMatch:"if-match",ifModifiedSince:["if-modified-since",M],ifNoneMatch:"if-none-match",ifUnmodifiedSince:["if-unmodified-since",M],acl:"x-tos-acl",grantFullControl:"x-tos-grant-full-control",grantRead:"x-tos-grant-read",grantReadAcp:"x-tos-grant-read-acp",grantWrite:"x-tos-grant-write",grantWriteAcp:"x-tos-grant-write-acp",serverSideEncryption:"x-tos-server-side-encryption",ssecAlgorithm:"x-tos-server-side-encryption-customer-algorithm",ssecKey:"x-tos-server-side-encryption-customer-key",ssecKeyMD5:"x-tos-server-side-encryption-customer-key-md5",copySourceRange:"x-tos-copy-source-range",copySourceIfMatch:"x-tos-copy-source-if-match",copySourceIfModifiedSince:["x-tos-copy-source-if-modified-since",M],copySourceIfNoneMatch:"x-tos-copy-source-if-none-match",copySourceIfUnmodifiedSince:"x-tos-copy-source-if-unmodified-since",copySourceSSECAlgorithm:"x-tos-copy-source-server-side-encryption-customer-algorithm",copySourceSSECKey:"x-tos-copy-source-server-side-encryption-customer-key",copySourceSSECKeyMD5:"x-tos-copy-source-server-side-encryption-customer-key-MD5",metadataDirective:"x-tos-metadata-directive",meta:e=>Object.keys(e).reduce((t,a)=>(t["x-tos-meta-"+a]=""+e[a],t),{}),websiteRedirectLocation:"x-tos-website-redirect-location",storageClass:"x-tos-storage-class",azRedundancy:"x-tos-az-redundancy",trafficLimit:"x-tos-traffic-limit",callback:"x-tos-callback",callbackVar:"x-tos-callback-var",allowSameActionOverlap:["x-tos-allow-same-action-overlap",e=>String(e)]},A={versionId:"versionId",process:"x-tos-process",saveBucket:"x-tos-save-bucket",saveObject:"x-tos-save-object",responseCacheControl:"response-cache-control",responseContentDisposition:"response-content-disposition",responseContentEncoding:"response-content-encoding",responseContentLanguage:"response-content-language",responseContentType:"response-content-type",responseExpires:["response-expires",e=>e.toUTCString()]};function U(e,t){if(!t.length)return;const a=e.headers||{};function o(e,t){null==a[e]&&(a[e]=t)}e.headers=a,t.forEach(t=>{const a=_[t];if(!a)throw new b(`\`${t}\` isn't in keys of \`requestHeadersMap\``);const n=e[t];if(null==n)return;if("string"==typeof a)return o(a,""+n);if(Array.isArray(a))return o(a[0],a[1](n));const i=a(n);Object.entries(i).forEach(([e,t])=>{o(e,t)})})}const L=e=>c.stringify(e);function N(e,t){return{data:e,statusCode:t.statusCode,headers:t.headers,requestId:t.requestId,id2:t.id2}}function z(e,t){const a=t["x-tos-hash-crc64ecma"];if(null==a)return;const o="string"==typeof e?e:e.getCrc64();if(o!==a)throw new b(`expect crc64 ${a}, actual crc64 ${o}`)}const F=function(e,i){if(I(e))throw new b("not support buffer in browser environment");return function(e,t){return t?e.toString(function(e){switch(e){case"utf-8":return n;case"base64":return a;case"hex":return o;default:throw new b("The coding is not supported")}}(t)):e}(t(e),i)};function K(e,t){return t?e.digest(t):e.digest()}let q=null;q={__proto__:null,hmacSha256:function(e,t,a){return K(p.createHmac("sha256",e).update(t),a)},hashSha256:function(e,t){return K(p.createHash("sha256").update(e),t)},hashMd5:function(e,t){return K(p.createHash("md5").update(e),t)},parse:function(e,t){return Buffer.from(e,t)},stringify:function(e,t){return e.toString(t)}};const{hmacSha256:H,hashSha256:$,hashMd5:G,parse:V,stringify:W}=q;function J(e){return!e||80===e||443===e}const X="request";class Q{constructor(e,t){this.options=void 0,this.credentials=void 0,this.signature=(e,t,a)=>{a||(a=this.credentials);const o=[],n=this.credentialString(e.datetime);return o.push(this.options.algorithm+" Credential="+a.GetAccessKey()+"/"+n),o.push("SignedHeaders="+this.signedHeaders(e)),o.push("Signature="+this.authorization(e,a,0)),o.join(", ")},this.signatureHeader=(e,t,a)=>{e.datetime=this.getDateTime();const o=new Map;e.headers||(e.headers={}),e.headers.host=""+e.host,J(e.port)||(e.headers.host+=":"+e.port),e.endpoints&&(e.headers.host=`${this.options.bucket}.${e.endpoints}`),o.set("host",e.headers.host),o.set("x-tos-date",e.datetime),o.set("x-tos-content-sha256",this.hexEncodedBodyHash()),this.options.securityToken&&o.set("x-tos-security-token",this.options.securityToken),o.forEach((t,a)=>{a.startsWith("x-tos")&&(e.headers[a]=t)}),e.path=this.getEncodePath(e.path);const n=this.signature(e,0,a);return o.set("authorization",n),o},this.gnrCopySig=(e,t)=>({key:"",value:""}),this.getSignature=(e,t)=>({key:"",value:""}),this.getSignatureQuery=(e,t)=>{e.datetime=this.getDateTime(),e.headers||(e.headers={}),e.headers.host=""+e.host,J(e.port)||(e.headers.host+=":"+e.port),e.path=this.getEncodePath(e.path),e.endpoints&&(e.headers.host=`${this.options.bucket}.${e.endpoints}`),e.headers["X-Tos-Date"]=e.datetime;const a=this.credentialString(e.datetime),o={...e.query||{},"X-Tos-Algorithm":this.options.algorithm,"X-Tos-Content-Sha256":this.hexEncodedBodyHash(),"X-Tos-Credential":this.credentials.GetAccessKey()+"/"+a,"X-Tos-Date":e.datetime,"X-Tos-Expires":""+t,"X-Tos-SignedHeaders":this.signedHeaders(e)};return this.options.securityToken&&(o["X-Tos-Security-Token"]=this.options.securityToken),e.query=C(o),o["X-Tos-Signature"]=this.authorization(e,this.credentials,t),o},this.getSignaturePolicyQuery=(e,t)=>{e.datetime=this.getDateTime();const a=this.credentialString(e.datetime),o={"X-Tos-Algorithm":this.options.algorithm,"X-Tos-Credential":this.credentials.GetAccessKey()+"/"+a,"X-Tos-Date":e.datetime,"X-Tos-Expires":""+t,"X-Tos-Policy":W(V(JSON.stringify(e.policy),"utf-8"),"base64")};return this.options.securityToken&&(o["X-Tos-Security-Token"]=this.options.securityToken),e.query=C(o),o["X-Tos-Signature"]=this.authorization(e,this.credentials,t),o},this.hexEncodedBodyHash=()=>"UNSIGNED-PAYLOAD",this.authorization=(e,t,a)=>{if(!e.datetime)return"";const o=this.getSigningKey(t,e.datetime.substr(0,8));return H(o,this.stringToSign(e.datetime,e),"hex")},this.getDateTime=()=>new Date((new Date).toUTCString()).toISOString().replace(/\..+/,"").replace(/-/g,"").replace(/:/g,"")+"Z",this.credentialString=e=>this.createScope(e.substr(0,8),this.options.region,this.options.serviceName),this.createScope=(e,t,a)=>[e.substr(0,8),t,a,X].join("/"),this.getSigningKey=(e,t)=>{const a=H(e.GetSecretKey(),t),o=H(a,this.options.region),n=H(o,this.options.serviceName);return H(n,X)},this.stringToSign=(e,t)=>{if(!this.options.algorithm)return"";const a=[];a.push(this.options.algorithm),a.push(e),a.push(this.credentialString(e));const o="policy"in t?this.canonicalStringPolicy(t):this.canonicalString(t);return a.push(this.hexEncodedHash(o)),a.join("\n")},this.hexEncodedHash=e=>$(e,"hex"),this.canonicalString=e=>{const t=[];return t.push(e.method),t.push(e.path),t.push(this.getEncodePath(e.query,!1)),t.push(this.canonicalHeaders(e)+"\n"),t.push(this.signedHeaders(e)),t.push(this.hexEncodedBodyHash()),t.join("\n")},this.canonicalStringPolicy=e=>{const t=[];return t.push(this.getEncodePath(e.query,!1)),t.push(this.hexEncodedBodyHash()),t.join("\n")},this.canonicalHeaders=e=>{const t=[],a=Z(e.headers);for(let o of a){const a=e.headers[o];o=o.toLowerCase(),t.push(o+":"+this.canonicalHeaderValues(a.toString()))}return t.join("\n")},this.canonicalHeaderValues=e=>e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,""),this.signedHeaders=e=>{const t=[],a=Z(e.headers);for(let e of a)e=e.toLowerCase(),t.push(e);return t.sort().join(";")},this.options=e,this.credentials=t}getEncodePath(e,t=!0){if(!e)return"";let a=e;return t&&(a=e.replace(/%2F/g,"/")),a=a.replace(/\(/g,"%28"),a=a.replace(/\)/g,"%29"),a=a.replace(/!/g,"%21"),a=a.replace(/\*/g,"%2A"),a=a.replace(/\'/g,"%27"),a}}class Y{constructor(e,t,a){this.securityToken=void 0,this.secretAccessKey=void 0,this.accessKeyId=void 0,this.accessKeyId=a,this.secretAccessKey=t,this.securityToken=e}GetAccessKey(){return this.accessKeyId}GetSecretKey(){return this.secretAccessKey}}function Z(e){const t=[];return Object.keys(e||{}).forEach(a=>{("host"===a||a.startsWith("x-tos-"))&&null!=e[a]&&t.push(a)}),t.sort()}class ee extends Error{constructor(e){const{data:t}=e;super(t.Message),this.code=void 0,this.data=void 0,this.statusCode=void 0,this.headers=void 0,this.requestId=void 0,this.id2=void 0,Object.setPrototypeOf(this,ee.prototype),this.data=t,this.code=t.Code,this.statusCode=e.status,this.headers=e.headers,this.requestId=e.headers["x-tos-request-id"],this.id2=e.headers["x-tos-id-2"]}}var te;function ae(e){const{tosOpts:t,...a}=e,o=new(t.isHttps?u.Agent:d.Agent)({...a,keepAlive:!0,rejectUnauthorized:t.enableVerifySSL,timeout:t.idleConnectionTime});o.maxFreeSockets=Infinity,o.maxTotalSockets=t.maxConnections;const n=o.createConnection;return o.createConnection=function(...e){const a=n.call(this,...e);let o=!1,i=!1,r=null;return process.nextTick(()=>{i||(r=setTimeout(()=>{o=!0},t.connectionTimeout))}),a.on("connect",()=>{i=!0,r&&clearTimeout(r),o&&a.destroy(new Error("Connect timeout"))}),a},o}(te=exports.TosServerCode||(exports.TosServerCode={})).NoSuchBucket="NoSuchBucket",te.NoSuchKey="NoSuchKey",te.AccessDenied="AccessDenied",te.MalformedAcl="MalformedAclError",te.UnexpectedContent="UnexpectedContent",te.InvalidRequest="InvalidRequest",te.MissingSecurityHeader="MissingSecurityHeader",te.InvalidArgument="InvalidArgument",te.EntityTooSmall="EntityTooSmall",te.InvalidBucketName="InvalidBucketName",te.BucketNotEmpty="BucketNotEmpty",te.TooManyBuckets="TooManyBuckets",te.BucketAlreadyExists="BucketAlreadyExists",te.MalformedBody="MalformedBody",te.NoSuchLifecycleConfiguration="NoSuchLifecycleConfiguration",te.ReplicationConfigurationNotFound="ReplicationConfigurationNotFoundError",te.InvalidLocationConstraint="InvalidLocationConstraint",te.AuthorizationQueryParametersError="AuthorizationQueryParametersError",te.RequestTimeTooSkewed="RequestTimeTooSkewed",te.SignatureDoesNotMatch="SignatureDoesNotMatch",te.RequestedRangeNotSatisfiable="Requested Range Not Satisfiable",te.PreconditionFailed="PreconditionFailed",te.BadDigest="BadDigest",te.InvalidDigest="InvalidDigest",te.EntityTooLarge="EntityTooLarge",te.UnImplemented="UnImplemented",te.MethodNotAllowed="MethodNotAllowed",te.InvalidAccessKeyId="InvalidAccessKeyId",te.InvalidSecurityToken="InvalidSecurityToken",te.ContentSHA256Mismatch="ContentSHA256Mismatch",te.ExceedQPSLimit="ExceedQPSLimit",te.ExceedRateLimit="ExceedRateLimit",te.NoSuchCORSConfiguration="NoSuchCORSConfiguration",te.NoSuchMirrorConfiguration="NoSuchMirrorConfiguration",te.NoSuchWebsiteConfiguration="NoSuchWebsiteConfiguration",te.MissingRequestBody="MissingRequestBodyError",te.BucketAlreadyOwnedByYou="BucketAlreadyOwnedByYou",te.NoSuchBucketPolicy="NoSuchBucketPolicy",te.PolicyTooLarge="PolicyTooLarge",te.MalformedPolicy="MalformedPolicy",te.InvalidKey="InvalidKey",te.MirrorFailed="MirrorFailed",te.Timeout="Timeout",te.OffsetNotMatched="OffsetNotMatched",te.NotAppendable="NotAppendable",te.ContextCanceled="ContextCanceled",te.InternalError="InternalError",te.TooManyRequests="TooManyRequests",te.TimeOut="TimeOut",te.ConcurrencyUpdateObjectLimit="ConcurrencyUpdateObjectLimit",te.DuplicateUpload="DuplicateUpload",te.DuplicateObject="DuplicateObject",te.InvalidVersionId="InvalidVersionId",te.StorageClassNotMatch="StorageClassNotMatch",te.UploadStatusNotUploading="UploadStatusNotUploading",te.PartSizeNotMatch="PartSizeNotMatch",te.NoUploadPart="NoUploadPart",te.PartsLenInvalid="PartsLenInvalid",te.PartsIdxSmall="PartsIdxSmall",te.PartSizeSmall="PartSizeSmall",te.PrefixNotNextKeyPrefix="PrefixNotNextKeyPrefix",te.InvalidPart="InvalidPart",te.InvalidPartOffset="InvalidPartOffset",te.MismatchObject="MismatchObject",te.UploadStatusMismatch="UploadStatusMismatch",te.CompletingStatusNoExpiration="CompletingStatusNoExpiration",te.Found="Found",te.InvalidRedirectLocation="InvalidRedirectLocation";const oe={"3gp":"video/3gpp","7z":"application/x-7z-compressed",abw:"application/x-abiword",ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",alc:"chemical/x-alchemy",amr:"audio/amr",anx:"application/annodex",apk:"application/vnd.android.package-archive",appcache:"text/cache-manifest",art:"image/x-jg",asc:"text/plain",asf:"video/x-ms-asf",aso:"chemical/x-ncbi-asn1-binary",asx:"video/x-ms-asf",atom:"application/atom+xml",atomcat:"application/atomcat+xml",atomsrv:"application/atomserv+xml",au:"audio/basic",avi:"video/x-msvideo",awb:"audio/amr-wb",axa:"audio/annodex",axv:"video/annodex",b:"chemical/x-molconn-Z",bak:"application/x-trash",bat:"application/x-msdos-program",bcpio:"application/x-bcpio",bib:"text/x-bibtex",bin:"application/octet-stream",bmp:"image/x-ms-bmp",boo:"text/x-boo",book:"application/x-maker",brf:"text/plain",bsd:"chemical/x-crossfire",c:"text/x-csrc","c++":"text/x-c++src",c3d:"chemical/x-chem3d",cab:"application/x-cab",cac:"chemical/x-cache",cache:"chemical/x-cache",cap:"application/vnd.tcpdump.pcap",cascii:"chemical/x-cactvs-binary",cat:"application/vnd.ms-pki.seccat",cbin:"chemical/x-cactvs-binary",cbr:"application/x-cbr",cbz:"application/x-cbz",cc:"text/x-c++src",cda:"application/x-cdf",cdf:"application/x-cdf",cdr:"image/x-coreldraw",cdt:"image/x-coreldrawtemplate",cdx:"chemical/x-cdx",cdy:"application/vnd.cinderella",cef:"chemical/x-cxf",cer:"chemical/x-cerius",chm:"chemical/x-chemdraw",chrt:"application/x-kchart",cif:"chemical/x-cif",class:"application/java-vm",cls:"text/x-tex",cmdf:"chemical/x-cmdf",cml:"chemical/x-cml",cod:"application/vnd.rim.cod",com:"application/x-msdos-program",cpa:"chemical/x-compass",cpio:"application/x-cpio",cpp:"text/x-c++src",cpt:"application/mac-compactpro",cr2:"image/x-canon-cr2",crl:"application/x-pkcs7-crl",crt:"application/x-x509-ca-cert",crw:"image/x-canon-crw",csd:"audio/csound",csf:"chemical/x-cache-csf",csh:"application/x-csh",csm:"chemical/x-csml",csml:"chemical/x-csml",css:"text/css",csv:"text/csv",ctab:"chemical/x-cactvs-binary",ctx:"chemical/x-ctx",cu:"application/cu-seeme",cub:"chemical/x-gaussian-cube",cxf:"chemical/x-cxf",cxx:"text/x-c++src",d:"text/x-dsrc",davmount:"application/davmount+xml",dcm:"application/dicom",dcr:"application/x-director",ddeb:"application/vnd.debian.binary-package",dif:"video/dv",diff:"text/x-diff",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dl:"video/dl",dll:"application/x-msdos-program",dmg:"application/x-apple-diskimage",dms:"application/x-dms",doc:"application/msword",docm:"application/vnd.ms-word.document.macroEnabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroEnabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dv:"video/dv",dvi:"application/x-dvi",dx:"chemical/x-jcamp-dx",dxr:"application/x-director",emb:"chemical/x-embl-dl-nucleotide",embl:"chemical/x-embl-dl-nucleotide",eml:"message/rfc822",eot:"application/vnd.ms-fontobject",eps:"application/postscript",eps2:"application/postscript",eps3:"application/postscript",epsf:"application/postscript",epsi:"application/postscript",erf:"image/x-epson-erf",es:"application/ecmascript",etx:"text/x-setext",exe:"application/x-msdos-program",ez:"application/andrew-inset",fb:"application/x-maker",fbdoc:"application/x-maker",fch:"chemical/x-gaussian-checkpoint",fchk:"chemical/x-gaussian-checkpoint",fig:"application/x-xfig",flac:"audio/flac",fli:"video/fli",flv:"video/x-flv",fm:"application/x-maker",frame:"application/x-maker",frm:"application/x-maker",gal:"chemical/x-gaussian-log",gam:"chemical/x-gamess-input",gamin:"chemical/x-gamess-input",gan:"application/x-ganttproject",gau:"chemical/x-gaussian-input",gcd:"text/x-pcs-gcd",gcf:"application/x-graphing-calculator",gcg:"chemical/x-gcg8-sequence",gen:"chemical/x-genbank",gf:"application/x-tex-gf",gif:"image/gif",gjc:"chemical/x-gaussian-input",gjf:"chemical/x-gaussian-input",gl:"video/gl",gnumeric:"application/x-gnumeric",gpt:"chemical/x-mopac-graph",gsf:"application/x-font",gsm:"audio/x-gsm",gtar:"application/x-gtar",gz:"application/gzip",h:"text/x-chdr","h++":"text/x-c++hdr",hdf:"application/x-hdf",hh:"text/x-c++hdr",hin:"chemical/x-hin",hpp:"text/x-c++hdr",hqx:"application/mac-binhex40",hs:"text/x-haskell",hta:"application/hta",htc:"text/x-component",htm:"text/html",html:"text/html",hwp:"application/x-hwp",hxx:"text/x-c++hdr",ica:"application/x-ica",ice:"x-conference/x-cooltalk",ico:"image/vnd.microsoft.icon",ics:"text/calendar",icz:"text/calendar",ief:"image/ief",iges:"model/iges",igs:"model/iges",iii:"application/x-iphone",info:"application/x-info",inp:"chemical/x-gamess-input",ins:"application/x-internet-signup",iso:"application/x-iso9660-image",isp:"application/x-internet-signup",ist:"chemical/x-isostar",istr:"chemical/x-isostar",jad:"text/vnd.sun.j2me.app-descriptor",jam:"application/x-jam",jar:"application/java-archive",java:"text/x-java",jdx:"chemical/x-jcamp-dx",jmz:"application/x-jmol",jng:"image/x-jng",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpf:"image/jpx",jpg:"image/jpeg",jpg2:"image/jp2",jpm:"image/jpm",jpx:"image/jpx",js:"application/javascript",json:"application/json",kar:"audio/midi",key:"application/pgp-keys",kil:"application/x-killustrator",kin:"chemical/x-kinemage",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz",kpr:"application/x-kpresenter",kpt:"application/x-kpresenter",ksp:"application/x-kspread",kwd:"application/x-kword",kwt:"application/x-kword",latex:"application/x-latex",lha:"application/x-lha",lhs:"text/x-literate-haskell",lin:"application/bbolin",lsf:"video/x-la-asf",lsx:"video/x-la-asf",ltx:"text/x-tex",ly:"text/x-lilypond",lyx:"application/x-lyx",lzh:"application/x-lzh",lzx:"application/x-lzx",m3g:"application/m3g",m3u:"audio/x-mpegurl",m3u8:"application/x-mpegURL",m4a:"audio/mpeg",maker:"application/x-maker",man:"application/x-troff-man",mbox:"application/mbox",mcif:"chemical/x-mmcif",mcm:"chemical/x-macmolecule",mdb:"application/msaccess",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/x-mif",mkv:"video/x-matroska",mm:"application/x-freemind",mmd:"chemical/x-macromodel-input",mmf:"application/vnd.smaf",mml:"text/mathml",mmod:"chemical/x-macromodel-input",mng:"video/x-mng",moc:"text/x-moc",mol:"chemical/x-mdl-molfile",mol2:"chemical/x-mol2",moo:"chemical/x-mopac-out",mop:"chemical/x-mopac-input",mopcrt:"chemical/x-mopac-input",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpc:"chemical/x-mopac-input",mpe:"video/mpeg",mpeg:"video/mpeg",mpega:"audio/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",mph:"application/x-comsol",mpv:"video/x-matroska",ms:"application/x-troff-ms",msh:"model/mesh",msi:"application/x-msi",mvb:"chemical/x-mopac-vib",mxf:"application/mxf",mxu:"video/vnd.mpegurl",nb:"application/mathematica",nbp:"application/mathematica",nc:"application/x-netcdf",nef:"image/x-nikon-nef",nwc:"application/x-nwc",o:"application/x-object",oda:"application/oda",odb:"application/vnd.oasis.opendocument.database",odc:"application/vnd.oasis.opendocument.chart",odf:"application/vnd.oasis.opendocument.formula",odg:"application/vnd.oasis.opendocument.graphics",odi:"application/vnd.oasis.opendocument.image",odm:"application/vnd.oasis.opendocument.text-master",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogg:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",old:"application/x-trash",one:"application/onenote",onepkg:"application/onenote",onetmp:"application/onenote",onetoc2:"application/onenote",opf:"application/oebps-package+xml",opus:"audio/ogg",orc:"audio/csound",orf:"image/x-olympus-orf",otf:"application/font-sfnt",otg:"application/vnd.oasis.opendocument.graphics-template",oth:"application/vnd.oasis.opendocument.text-web",otp:"application/vnd.oasis.opendocument.presentation-template",ots:"application/vnd.oasis.opendocument.spreadsheet-template",ott:"application/vnd.oasis.opendocument.text-template",oza:"application/x-oz-application",p:"text/x-pascal",p7r:"application/x-pkcs7-certreqresp",pac:"application/x-ns-proxy-autoconfig",pas:"text/x-pascal",pat:"image/x-coreldrawpattern",patch:"text/x-diff",pbm:"image/x-portable-bitmap",pcap:"application/vnd.tcpdump.pcap",pcf:"application/x-font-pcf","pcf.Z":"application/x-font-pcf",pcx:"image/pcx",pdb:"chemical/x-pdb",pdf:"application/pdf",pfa:"application/x-font",pfb:"application/x-font",pfr:"application/font-tdpfr",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pgp:"application/pgp-encrypted",php:"#application/x-httpd-php",php3:"#application/x-httpd-php3",php3p:"#application/x-httpd-php3-preprocessed",php4:"#application/x-httpd-php4",php5:"#application/x-httpd-php5",phps:"#application/x-httpd-php-source",pht:"#application/x-httpd-php",phtml:"#application/x-httpd-php",pk:"application/x-tex-pk",pl:"text/x-perl",pls:"audio/x-scpls",pm:"text/x-perl",png:"image/png",pnm:"image/x-portable-anymap",pot:"text/plain",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",ppm:"image/x-portable-pixmap",pps:"application/vnd.ms-powerpoint",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppt:"application/vnd.ms-powerpoint",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",prf:"application/pics-rules",prt:"chemical/x-ncbi-asn1-ascii",ps:"application/postscript",psd:"image/x-photoshop",py:"text/x-python",pyc:"application/x-python-code",pyo:"application/x-python-code",qgs:"application/x-qgis",qt:"video/quicktime",qtl:"application/x-quicktimeplayer",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",rar:"application/rar",ras:"image/x-cmu-raster",rb:"application/x-ruby",rd:"chemical/x-mdl-rdfile",rdf:"application/rdf+xml",rdp:"application/x-rdp",rgb:"image/x-rgb",rhtml:"#application/x-httpd-eruby",rm:"audio/x-pn-realaudio",roff:"application/x-troff",ros:"chemical/x-rosdal",rpm:"application/x-redhat-package-manager",rss:"application/x-rss+xml",rtf:"application/rtf",rtx:"text/richtext",rxn:"chemical/x-mdl-rxnfile",scala:"text/x-scala",sce:"application/x-scilab",sci:"application/x-scilab",sco:"audio/csound",scr:"application/x-silverlight",sct:"text/scriptlet",sd:"chemical/x-mdl-sdfile",sd2:"audio/x-sd2",sda:"application/vnd.stardivision.draw",sdc:"application/vnd.stardivision.calc",sdd:"application/vnd.stardivision.impress",sds:"application/vnd.stardivision.chart",sdw:"application/vnd.stardivision.writer",ser:"application/java-serialized-object",sfd:"application/vnd.font-fontforge-sfd",sfv:"text/x-sfv",sgf:"application/x-go-sgf",sgl:"application/vnd.stardivision.writer-global",sh:"application/x-sh",shar:"application/x-shar",shp:"application/x-qgis",shtml:"text/html",shx:"application/x-qgis",sid:"audio/prs.sid",sig:"application/pgp-signature",sik:"application/x-trash",silo:"model/mesh",sis:"application/vnd.symbian.install",sisx:"x-epoc/x-sisx-app",sit:"application/x-stuffit",sitx:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",smi:"application/smil+xml",smil:"application/smil+xml",snd:"audio/basic",spc:"chemical/x-galactic-spc",spl:"application/x-futuresplash",spx:"audio/ogg",sql:"application/x-sql",src:"application/x-wais-source",srt:"text/plain",stc:"application/vnd.sun.xml.calc.template",std:"application/vnd.sun.xml.draw.template",sti:"application/vnd.sun.xml.impress.template",stw:"application/vnd.sun.xml.writer.template",sty:"text/x-tex",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",svgz:"image/svg+xml",sw:"chemical/x-swissprot",swf:"application/x-shockwave-flash",swfl:"application/x-shockwave-flash",sxc:"application/vnd.sun.xml.calc",sxd:"application/vnd.sun.xml.draw",sxg:"application/vnd.sun.xml.writer.global",sxi:"application/vnd.sun.xml.impress",sxm:"application/vnd.sun.xml.math",sxw:"application/vnd.sun.xml.writer",t:"application/x-troff",tar:"application/x-tar",taz:"application/x-gtar-compressed",tcl:"application/x-tcl",tex:"text/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",text:"text/plain",tgf:"chemical/x-mdl-tgf",tgz:"application/x-gtar-compressed",thmx:"application/vnd.ms-officetheme",tif:"image/tiff",tiff:"image/tiff",tk:"text/x-tcl",tm:"text/texmacs",torrent:"application/x-bittorrent",tr:"application/x-troff",ts:"video/MP2T",tsp:"application/dsptype",tsv:"text/tab-separated-values",ttf:"application/font-sfnt",ttl:"text/turtle",txt:"text/plain",uls:"text/iuls",ustar:"application/x-ustar",val:"chemical/x-ncbi-asn1-binary",vcard:"text/vcard",vcd:"application/x-cdlink",vcf:"text/vcard",vcs:"text/x-vcalendar",vmd:"chemical/x-vmd",vms:"chemical/x-vamas-iso14976",vrm:"x-world/x-vrml",vrml:"model/vrml",vsd:"application/vnd.visio",vss:"application/vnd.visio",vst:"application/vnd.visio",vsw:"application/vnd.visio",wad:"application/x-doom",wasm:"application/wasm",wav:"audio/wav",wax:"audio/x-ms-wax",wbmp:"image/vnd.wap.wbmp",wbxml:"application/vnd.wap.wbxml",webm:"video/webm",wk:"application/x-123",wm:"video/x-ms-wm",wma:"audio/x-ms-wma",wmd:"application/x-ms-wmd",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wmz:"application/x-ms-wmz",woff:"application/font-woff",wp5:"application/vnd.wordperfect5.1",wpd:"application/vnd.wordperfect",wrl:"model/vrml",wsc:"text/scriptlet",wvx:"video/x-ms-wvx",wz:"application/x-wingz",x3d:"model/x3d+xml",x3db:"model/x3d+binary",x3dv:"model/x3d+vrml",xbm:"image/x-xbitmap",xcf:"application/x-xcf",xcos:"application/x-scilab-xcos",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlb:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xml:"application/xml",xpi:"application/x-xpinstall",xpm:"image/x-xpixmap",xsd:"application/xml",xsl:"application/xslt+xml",xslt:"application/xslt+xml",xspf:"application/xspf+xml",xtel:"chemical/x-xtel",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",xz:"application/x-xz",zip:"application/zip"};function ne(e){return new i.Transform({async transform(t,a,o){e(t.length),this.push(t),o()}})}function ie(e,t){const a=ne(t);return e.on("error",t=>{console.log("stream",e),a.destroy(t)}),e.pipe(a)}let re=null;re={__proto__:null,CRC:class{constructor(){this.value="0"}reset(){this.value="0"}async updateBlob(){throw new b("Not implemented in node.js environment.")}update(e){return this.value=h.crc64(e,this.value),this.value}getCrc64(){return this.value}},combineCrc64:h.combineCrc64};const{CRC:se,combineCrc64:ce}=re;function pe(e,t){const a=Math.max(10240,e),o={rate:Math.max(1024,t),capacity:a,currentAmount:a,lastConsumeTime:Date.now()};return{Acquire:async e=>{e>o.capacity&&(e=o.capacity);const t=Date.now(),a=Math.floor((t-o.lastConsumeTime)/1e3*o.rate);return a+o.currentAmount>o.capacity?o.currentAmount=o.capacity:o.currentAmount+=a,e>o.currentAmount?{ok:!1,timeToWait:Math.ceil((e-o.currentAmount)/o.rate*1e3)}:(o.lastConsumeTime=t,o.currentAmount=o.currentAmount-e,{ok:!0,timeToWait:0})}}}function le(e){return new i.Transform({async transform(t,a,o){try{const a=t.length;let n=!1;for(;!n;){const{ok:t,timeToWait:o}=await e.Acquire(a);t||await ue(o),n=t}this.push(t),o()}catch(e){o(e)}}})}function de(e,t){const a=le(t);return e.on("error",e=>{a.destroy(e)}),e.pipe(a)}function ue(e){return new Promise(t=>{setTimeout(()=>t(""),e)})}class he extends i.Readable{constructor(e){super(),this.buf=void 0,this.lastPos=0,this.buf=e}_read(e){const t=this.buf.length;let a=Math.min(e,t-this.lastPos);this.lastPos>=t?this.push(null):(this.push(this.buf.slice(this.lastPos,this.lastPos+a)),this.lastPos+=a)}}function me(e){return new i.Transform({async transform(t,a,o){e(t),this.push(t),o()}})}function fe(e,t){const a=me(e=>t.update(e));return e.on("error",e=>{a.destroy(e)}),e.pipe(a)}var ye;function ge(e){if(("string"==typeof e?e:e.key).length<1)throw new b("invalid object name, the length must be greater than 1")}function xe(e,t){if(I(e))return e.length;if(B(e))return e.size;if(t&&t["content-length"]){const e=+t["content-length"];if(e>=0)return e}return null}async function be(e){const t=function({body:e,dataTransferCallback:t,makeRetryStream:a,rateLimiter:o}){let n=e;if(I(n)){const e=n;a=()=>new he(e),n=new he(e)}if(D(n)&&(o&&ve(o)&&(n=de(n,o)),n=ie(n,t),a)){const e=a;return{body:n,makeRetryStream:()=>{let a=e();return a?(o&&ve(o)&&(a=de(a,o)),a=ie(a,t),a):a}}}return{body:n,makeRetryStream:void 0}}(e);return async function({body:e,beforeRetry:t,makeRetryStream:a,enableCRC:o}){if(!o)return{body:e,beforeRetry:t,makeRetryStream:a};let n=e;const i=new se;if(D(e)&&(n=fe(e,i),a)){const e=a;a=()=>{const t=e();return t?fe(t,i):t}}return{body:n,beforeRetry:()=>{i.reset(),null==t||t()},makeRetryStream:a,crc:i}}(e={...e,...t})}function ke(e,t){return`/${e}/${encodeURIComponent(t)}`}function ve(e){if(!(null!=e&&e.Acquire&&(null==e?void 0:e.Acquire)instanceof Function))throw new b("The rateLimiter is not valid function");return!0}function Te(e){"object"==typeof e&&console.warn("The `checkpoint` parameter should be passed as a string in node.js environment, representing a file or directory.Passing a checkpoint object to it will be removed in the future.")}!function(e){e.HeaderRestore="x-tos-restore",e.HeaderRestoreExpiryDays="x-tos-restore-expiry-days",e.HeaderRestoreRequestDate="x-tos-restore-request-date",e.HeaderRestoreTier="x-tos-restore-tier",e.HeaderProjectName="x-tos-project-name",e.HeaderReplicationStatus="x-tos-replication-status"}(ye||(ye={}));const we=e=>{if(!e)return;const t=null==e?void 0:e[ye.HeaderRestore];if(t){var a,o,n;const r=null!=(a=null==(o=(null!=t?t:"").split('",')[1])||null==o.split||null==(n=o.split("="))?void 0:n[1])?a:"",s='ongoing-request="true"'===(null==t?void 0:t.trim()),c={RestoreStatus:{OngoingRequest:s,ExpiryDate:r}};var i;return s&&(c.RestoreParam={ExpiryDays:e[ye.HeaderRestoreExpiryDays]?Number(e[ye.HeaderRestoreExpiryDays]):0,RequestDate:null!=(i=e[ye.HeaderRestoreRequestDate])?i:"",Tier:e[ye.HeaderRestoreTier]}),c}},Se=m("TOS");async function Ce(e={}){const t={};U({...e,headers:t},["projectName"]);const a=await this.fetch("GET","/",{},t);return v(a.data)("Buckets"),a}async function Ee(e){const t=e.bucket||this.opts.bucket;if(t){if(t.length<3||t.length>63)throw new b("invalid bucket name, the length must be [3, 63]");if(!/^([a-z]|-|\d)+$/.test(t))throw new b("invalid bucket name, the character set is illegal");if(/^-/.test(t)||/-$/.test(t))throw new b("invalid bucket name, the bucket name can be neither starting with '-' nor ending with '-'")}const a=e.headers=E(e.headers);return U(e,["acl","grantFullControl","grantRead","grantReadAcp","grantWrite","grantWriteAcp","storageClass","azRedundancy","projectName"]),await this.fetchBucket(e.bucket,"PUT",{},a)}async function Re(e){return this.fetchBucket(e,"DELETE",{},{})}async function Pe(e){return this.fetchBucket(e,"HEAD",{},{},void 0,{handleResponse:e=>({...e.headers,ProjectName:e.headers[ye.HeaderProjectName]})})}async function Be(e){const{bucket:t,storageClass:a}=e;return this.fetchBucket(t,"PUT",{storageClass:""},{"x-tos-storage-class":a})}async function Ie(e){const t={};return e.acl&&(t["x-tos-acl"]=e.acl),await this.fetchBucket(e.bucket,"PUT",{acl:""},t,e.aclBody,{needMd5:!0})}async function De(e){return this.fetchBucket(e,"GET",{acl:""},{})}const je=f.createWriteStream,Oe=f.createReadStream,Me=y.promisify(f.rename),_e=y.promisify(f.stat),Ae=y.promisify(f.mkdir),Ue=y.promisify(f.writeFile),Le=y.promisify(f.unlink),Ne=y.promisify(f.readFile);var ze;async function Fe(e){const t="string"==typeof e?{key:e}:e,a={};t.versionId&&(a.versionId=t.versionId);const o=E(null==t?void 0:t.headers),n=(null==t?void 0:t.response)||{};return Object.keys(n).forEach(e=>{const t=n[e];null!=t&&(a["response-"+e]=t)}),this._fetchObject(e,"GET",a,o,void 0,{axiosOpts:{responseType:"arraybuffer"}})}(ze=exports.DataTransferType||(exports.DataTransferType={}))[ze.Started=1]="Started",ze[ze.Rw=2]="Rw",ze[ze.Succeed=3]="Succeed",ze[ze.Failed=4]="Failed";const Ke=["stream","buffer"];async function qe(e){const t="string"==typeof e?{key:e}:e,a=E(t.headers);t.headers=a;const o=t.dataType||"stream";t.dataType=o,function(e){let t="node",a=[];if(t="node",a=Ke,!a.includes(e))throw new b(`The value of \`dataType\` only supports \`${a.join(" | ")}\` in node environment`)}(o);const n={},i=(null==t?void 0:t.response)||{};if(Object.keys(i).forEach(e=>{const t=i[e];null!=t&&(n["response-"+e]=t)}),function(e,t,a){function o(e,a){null==t[e]&&(t[e]=a)}a.length&&a.forEach(t=>{const a=A[t];if(!a)throw new b(`\`${t}\` isn't in keys of \`requestQueryMap\``);const n=e[t];if(null==n)return;if("string"==typeof a)return o(a,""+n);if(Array.isArray(a))return o(a[0],a[1](n));const i=a(n);Object.entries(i).forEach(([e,t])=>{o(e,t)})})}(t,n,["versionId","process","saveBucket","saveObject","responseCacheControl","responseContentDisposition","responseContentEncoding","responseContentLanguage","responseContentType","responseExpires"]),U(t,["ifMatch","ifModifiedSince","ifNoneMatch","ifUnmodifiedSince","ssecAlgorithm","ssecKey","ssecKeyMD5","range","trafficLimit"]),null==t.range&&(null!=t.rangeStart||null!=t.rangeEnd)){var r;const e=`bytes=${null!=t.rangeStart?""+t.rangeStart:""}-${null!=t.rangeEnd?""+t.rangeEnd:""}`;a.range=null!=(r=a.range)?r:e}let s=0,c=-1;const{dataTransferStatusChange:p,progress:l}=t,d=(e,t=0)=>{if(t<0)return;if(!p&&!l)return;s+=t,null==p||p({type:e,rwOnceBytes:t,consumedBytes:s,totalBytes:c});const a=c<0?0:0===c?e===exports.DataTransferType.Succeed?1:0:s/c;1===a?e===exports.DataTransferType.Succeed&&(null==l||l(a)):null==l||l(a)};d(exports.DataTransferType.Started);const[u,h]=await P(this._fetchObject(e,"GET",n,a,void 0,{axiosOpts:{responseType:"stream",onDownloadProgress:e=>{c=e.total,d(exports.DataTransferType.Rw,e.loaded-s)}}}));if(u||!h)throw d(exports.DataTransferType.Failed),u;let m=h.headers,f=h.data;c=+(m["content-length"]||0),D(f)&&(t.rateLimiter&&ve(t.rateLimiter)&&(f=de(f,t.rateLimiter)),f=ie(f,e=>d(exports.DataTransferType.Rw,e)),f.on("end",()=>d(exports.DataTransferType.Succeed)),"buffer"===o&&(f=await(async e=>{let t=Buffer.from([]);return new Promise((a,o)=>{e.on("data",e=>{t=Buffer.concat([t,e])}),e.on("end",()=>{a(t)}),e.on("error",e=>{o(e)})})})(f)));const y={...h,data:{content:f,etag:m.etag||"",lastModified:m["last-modified"]||"",hashCrc64ecma:m["x-tos-hash-crc64ecma"]||"",ReplicationStatus:m[ye.HeaderReplicationStatus]}},g=we(m);return g&&(y.data.RestoreInfo=g),y}async function He(e){return new Promise(async(t,a)=>{const o=await qe.call(this,e),n=o.data.content,i=je(e.filePath);n.pipe(i),i.on("error",e=>a(e)),i.on("finish",()=>{const e={...o.data};delete e.content,t({...o,data:{...e}})})})}async function $e(e){return Ge.call(this,e)}async function Ge(e){const t=(e=this.normalizeObjectInput(e)).headers=E(e.headers);U(e,["contentLength","contentMD5","contentSHA256","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWrite","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","meta","websiteRedirectLocation","storageClass","trafficLimit","callback","callbackVar"]),this.setObjectContentTypeHeader(e,t);const a=xe(e.body,t),o=null!=a;o||!e.dataTransferStatusChange&&!e.progress||console.warn("Don't get totalSize of putObject's body, the `dataTransferStatusChange` and `progress` callback will not trigger. You can use `putObjectFromFile` instead");let n=0;const{dataTransferStatusChange:i,progress:r}=e,s=(e,t=0)=>{if(!o||t<0)return;if(!i&&!r)return;n+=t,null==i||i({type:e,rwOnceBytes:t,consumedBytes:n,totalBytes:a});const s=0===a?e===exports.DataTransferType.Succeed?1:0:n/a;1===s?e===exports.DataTransferType.Succeed&&(null==r||r(s)):null==r||r(s)},c=await be({body:e.body,dataTransferCallback:e=>s(exports.DataTransferType.Rw,e),makeRetryStream:e.makeRetryStream,enableCRC:this.opts.enableCRC,rateLimiter:e.rateLimiter});s(exports.DataTransferType.Started);const[p,l]=await P((async()=>{const a=await this._fetchObject(e,"PUT",{},t,c.body||"",{handleResponse:t=>{var a;const o={...t.headers};return null!=(a=e)&&a.callback&&t.data&&(o.CallbackResult=""+JSON.stringify(t.data)),o},axiosOpts:{__retryConfig__:{beforeRetry:()=>{n=0,null==c.beforeRetry||c.beforeRetry()},makeRetryStream:c.makeRetryStream},onUploadProgress:e=>{s(exports.DataTransferType.Rw,e.loaded-n)}}});return this.opts.enableCRC&&c.crc&&z(c.crc,a.headers),a})());if(p||!l)throw s(exports.DataTransferType.Failed),p;return s(exports.DataTransferType.Succeed),l}async function Ve(e){const t=E(e.headers);if(!t["content-length"]){const a=await _e(e.filePath);t["content-length"]=""+a.size}const a=()=>Oe(e.filePath);return Ge.call(this,{...e,body:a(),headers:t,makeRetryStream:a})}async function We(e){const t=e.headers=E(e.headers);return U(e,["acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","meta","storageClass"]),await this._fetchObject(e,"POST",{fetch:""},t,{URL:e.url,IgnoreSameKey:e.ignoreSameKey,ContentMD5:e.contentMD5},{needMd5:!0})}async function Je(e){const t=e.headers=E(e.headers);return U(e,["acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","meta","storageClass"]),await this._fetchObject(e,"POST",{fetchTask:""},t,{URL:e.url,IgnoreSameKey:e.ignoreSameKey,ContentMD5:e.contentMD5,Object:e.key},{needMd5:!0})}async function Xe(e={}){const{...t}=e,a=await this.fetchBucket(e.bucket,"GET",w(t),{}),o=v(a.data);return o("CommonPrefixes"),o("Contents"),o("Versions"),o("DeleteMarkers"),a}async function Qe(e={}){return this.listObjects({versions:"",...e})}function Ye(e){ge(e);const t="string"==typeof e?{key:e}:e,a=t.alternativeEndpoint||this.opts.endpoint,o=!t.alternativeEndpoint&&!t.isCustomDomain,n=t.bucket||this.opts.bucket||"";if(o&&!n)throw new b("Must provide bucket param");const[i,r,s]=(()=>{const e=encodeURIComponent(t.key),i=t.key.split("/").map(e=>encodeURIComponent(e)).join("/");return o?[`${n}.${a}`,"/"+i,"/"+e]:[a,"/"+i,"/"+e]})(),c=t.query||{},p=(e,t)=>{null==c[e]&&null!=t&&(c[e]=t)},l=t.response||{};Object.keys(l).forEach(e=>{const t=e,a=w(t);p("response-"+a,l[t])}),t.versionId&&p("versionId",t.versionId);const d=this.getSignatureQuery({bucket:n,method:t.method||"GET",path:s,endpoint:a,subdomain:o,expires:t.expires||1800,query:c}),u=R(this.opts.proxy);let h=`http${this.opts.secure?"s":""}://${i}`;return null!=u&&u.url&&(h=u.url.replace(/\/+$/g,""),null!=u&&u.needProxyParams&&(d["x-proxy-tos-host"]=i)),`${h}${r}?${Object.keys(d).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(d[e])}`).join("&")}`}async function Ze(e){const t="string"==typeof e?{key:e}:e,a=E(t.headers);t.headers=a;const o={};return t.versionId&&(o.versionId=t.versionId),U(t,["ifMatch","ifModifiedSince","ifNoneMatch","ifUnmodifiedSince","ssecAlgorithm","ssecKey","ssecKeyMD5"]),this._fetchObject(e,"HEAD",o,(null==t?void 0:t.headers)||{},void 0,{handleResponse:e=>{const t={...e.headers,ReplicationStatus:e.headers[ye.HeaderReplicationStatus]},a=we(e.headers);return a&&(t.RestoreInfo=a),t}})}async function et(e){const t="string"==typeof e?{key:e}:e,a={};return t.versionId&&(a.versionId=t.versionId),await this._fetchObject(e,"DELETE",a,{},{},{handleResponse:e=>e.headers})}async function tt(e){return this._fetchObject(e,"PUT",{rename:"",name:e.newKey},{},"")}async function at(e){const t={Quiet:e.quiet,Objects:e.objects.map(e=>({Key:e.key,VersionId:e.versionId}))},a=await this.fetchBucket(e.bucket,"POST",{delete:""},{},t),o=v(a.data);return o("Deleted"),o("Error"),a}async function ot(e){const t=E(e.headers);if(e.headers=t,U(e,["cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","copySourceIfMatch","copySourceIfModifiedSince","copySourceIfNoneMatch","copySourceIfUnmodifiedSince","copySourceSSECAlgorithm","copySourceSSECKey","copySourceSSECKeyMD5","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","metadataDirective","meta","websiteRedirectLocation","storageClass","trafficLimit"]),e.srcBucket&&e.srcKey){var a;let o=ke(e.srcBucket,e.srcKey);e.srcVersionID&&(o+="?versionId="+e.srcVersionID),t["x-tos-copy-source"]=null!=(a=t["x-tos-copy-source"])?a:o}const[o,n]=await P(this._fetchObject(e,"PUT",{},t));if(o||!n||!n.data.ETag)throw o;return n}async function nt(e){const t="string"==typeof e?{key:e}:e,a={acl:""};return t.versionId&&(a.versionId=t.versionId),this._fetchObject(e,"GET",a,{})}async function it(e){const t=e.headers=E(e.headers),a={acl:""};return e.versionId&&(a.versionId=e.versionId),U(e,["acl"]),this._fetchObject(e,"PUT",a,t,e.aclBody)}async function rt(e){return this._fetchObject(e,"DELETE",{uploadId:e.uploadId},{})}async function st(e){var t;e.headers=null!=(t=e.headers)?t:{},U(e,["callback","callbackVar"]);const a=t=>{const a=t.headers,o={VersionID:a["x-tos-version-id"],ETag:a.etag,Bucket:e.bucket||this.opts.bucket||"",Location:a.location,HashCrc64ecma:a["x-tos-hash-crc64ecma"],Key:e.key,...t.data};return e.callback&&(o.CallbackResult=""+JSON.stringify(t.data)),o};if(e.completeAll){var o;if((null==(o=e.parts)?void 0:o.length)>0)throw new b("Should not specify both 'completeAll' and 'parts' params.");return this._fetchObject(e,"POST",{uploadId:e.uploadId},{...e.headers,"x-tos-complete-all":"yes"},void 0,{handleResponse:a})}return this._fetchObject(e,"POST",{uploadId:e.uploadId},{...e.headers},{Parts:e.parts.map(e=>({ETag:e.eTag,PartNumber:e.partNumber}))},{handleResponse:a})}async function ct(e){e=this.normalizeObjectInput(e);const t=E(e.headers);return e.headers=t,U(e,["encodingType","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","meta","websiteRedirectLocation","storageClass"]),this.setObjectContentTypeHeader(e,t),this._fetchObject(e,"POST",{uploads:""},t,"")}const pt=(e,t,a=!1)=>{let o=t;t<5242880&&(o=5242880,a&&console.warn(`partSize has been set to ${o}, because the partSize you provided is less than the minimal size of multipart`));const n=Math.ceil(e/1e4);return t<n&&(o=n,a&&console.warn(`partSize has been set to ${o}, because the partSize you provided causes the number of part excesses 10,000`)),o};async function lt(e){const{uploadId:t,...a}=e,o=await this._fetchObject(e,"GET",{uploadId:t,...w(a)},{});return v(o.data)("Parts"),o}async function dt(e){const{uploadId:t,partNumber:a,body:o,enableContentMD5:n=!1}=e,i=E(e.headers);e.headers=i,U(e,["trafficLimit","ssecAlgorithm","ssecKey","ssecKeyMD5"]);const r=xe(o);if(r&&null==i["content-length"]&&(i["content-length"]=r.toFixed(0)),n&&null==i["content-md5"])if(D(o)&&e.makeRetryStream){const t=e.makeRetryStream();if(t){let e=Buffer.from([]);for await(const a of t)e=Buffer.concat([e,"string"==typeof a?Buffer.from(a):a]);const a=G(e,"base64");i["content-md5"]=a}}else console.warn("current not support enableMD5Checksum");const s=xe(e.body,i),c=null!=s;c||!e.dataTransferStatusChange&&!e.progress||console.warn("Don't get totalSize of uploadPart's body, the `dataTransferStatusChange` callback will not trigger. You can use `uploadPartFromFile` instead");let p=0;const{dataTransferStatusChange:l,progress:d}=e,u=(e,t=0)=>{if(!c||t<0)return;if(!l&&!d)return;p+=t,null==l||l({type:e,rwOnceBytes:t,consumedBytes:p,totalBytes:s});const a=0===s?e===exports.DataTransferType.Succeed?1:0:p/s;1===a?e===exports.DataTransferType.Succeed&&(null==d||d(a)):null==d||d(a)},h=await be({body:e.body,dataTransferCallback:e=>u(exports.DataTransferType.Rw,e),beforeRetry:e.beforeRetry,makeRetryStream:e.makeRetryStream,enableCRC:this.opts.enableCRC,rateLimiter:e.rateLimiter});u(exports.DataTransferType.Started);const[m,f]=await P((async()=>{const o=await this._fetchObject(e,"PUT",{partNumber:a,uploadId:t},i,h.body,{handleResponse:e=>({partNumber:a,ETag:e.headers.etag,serverSideEncryption:e.headers["x-tos-server-side-encryption"],serverSideEncryptionKeyId:e.headers["x-tos-server-side-encryption-kms-key-id"],ssecAlgorithm:e.headers["x-tos-server-side-encryption-customer-algorithm"],ssecKeyMD5:e.headers["x-tos-server-side-encryption-customer-key-MD5"],hashCrc64ecma:e.headers["x-tos-hash-crc64ecma"]}),axiosOpts:{__retryConfig__:{beforeRetry:()=>{p=0,null==h.beforeRetry||h.beforeRetry()},makeRetryStream:h.makeRetryStream},onUploadProgress:e=>{u(exports.DataTransferType.Rw,e.loaded-p)}}});return this.opts.enableCRC&&h.crc&&z(h.crc,o.headers),o})());if(m||!f)throw u(exports.DataTransferType.Failed),m;return u(exports.DataTransferType.Succeed),f}async function ut(e){return dt.call(this,e)}async function ht(e){var t,a;const o=await _e(e.filePath),n=null!=(t=e.offset)?t:0,i=Math.min(o.size,n+(null!=(a=e.partSize)?a:o.size)),r=()=>Oe(e.filePath,{start:n,end:i-1});return dt.call(this,{...e,body:r(),headers:{...e.headers||{},"content-length":""+(i-n)},makeRetryStream:r})}async function mt(e={}){const{...t}=e,a=await this.fetchBucket(e.bucket,"GET",{uploads:"",...w(t)},{}),o=v(a.data);return o("Uploads"),o("CommonPrefixes"),a}async function ft(e){const t=e=this.normalizeObjectInput(e),a=e.headers=E(e.headers);U(e,["contentLength","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","meta","websiteRedirectLocation","storageClass","trafficLimit"]),this.setObjectContentTypeHeader(e,a);const o=xe(e.body,a),n=null!=o;if(!n)throw new b("appendObject needs to know the content length in advance");if(a["content-length"]=a["content-length"]||""+o,this.opts.enableCRC&&0!==e.offset&&!e.preHashCrc64ecma)throw new b("must provide preHashCrc64ecma if enableCRC is true and offset is non-zero");let i=0;const{dataTransferStatusChange:r,progress:s}=e,c=(e,t=0)=>{if(!n||t<0)return;if(!r&&!s)return;i+=t,null==r||r({type:e,rwOnceBytes:t,consumedBytes:i,totalBytes:o});const a=0===o?e===exports.DataTransferType.Succeed?1:0:i/o;1===a?e===exports.DataTransferType.Succeed&&(null==s||s(a)):null==s||s(a)},p=await be({body:e.body,dataTransferCallback:e=>c(exports.DataTransferType.Rw,e),makeRetryStream:void 0,enableCRC:this.opts.enableCRC,rateLimiter:e.rateLimiter});c(exports.DataTransferType.Started);const[l,d]=await P((async()=>{const n=await this._fetchObject(e,"POST",{append:"",offset:t.offset},a,p.body||"",{handleResponse:e=>({...e.headers,nextAppendOffset:+e.headers["x-tos-next-append-offset"],hashCrc64ecma:e.headers["x-tos-hash-crc64ecma"]}),axiosOpts:{__retryConfig__:{beforeRetry:()=>{i=0,null==p.beforeRetry||p.beforeRetry()},makeRetryStream:p.makeRetryStream},onUploadProgress:e=>{c(exports.DataTransferType.Rw,e.loaded-i)}}});return this.opts.enableCRC&&p.crc&&z(ce(t.preHashCrc64ecma||"0",p.crc.getCrc64(),o),n.headers),n})());if(l||!d)throw c(exports.DataTransferType.Failed),l;return c(exports.DataTransferType.Succeed),d}async function yt(e){const t="string"==typeof e?{key:e}:e,a=t.headers=E(t.headers);U(t,["cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","meta"]);const o={metadata:""};return t.versionId&&(o.versionId=t.versionId),this._fetchObject(e,"POST",o,a)}async function gt(e){const{uploadId:t,partNumber:a}=e,o=E(e.headers);if(e.headers=o,U(e,["copySourceRange","copySourceSSECAlgorithm","copySourceSSECKey","copySourceSSECKeyMD5","ssecAlgorithm","ssecKey","ssecKeyMD5","trafficLimit"]),e.srcBucket&&e.srcKey){var n;let t=ke(e.srcBucket,e.srcKey);e.srcVersionID&&(t+="?versionId="+e.srcVersionID),o["x-tos-copy-source"]=null!=(n=o["x-tos-copy-source"])?n:t}if(null==e.copySourceRange&&(null!=e.copySourceRangeStart||null!=e.copySourceRangeEnd)){var i;const t=`bytes=${null!=e.copySourceRangeStart?""+e.copySourceRangeStart:""}-${null!=e.copySourceRangeEnd?""+e.copySourceRangeEnd:""}`;o["x-tos-copy-source-range"]=null!=(i=o["x-tos-copy-source-range"])?i:t}const[r,s]=await P(this._fetchObject(e,"PUT",{partNumber:a,uploadId:t},o,void 0,{handleResponse:e=>({...e.data,SSECAlgorithm:e.headers[_.ssecAlgorithm],SSECKeyMD5:e.headers[_.ssecKeyMD5]})}));if(r||!s||!s.data.ETag)throw r;return s}class xt extends i.Readable{_read(){this.push(null)}}var bt;(bt=exports.UploadEventType||(exports.UploadEventType={}))[bt.CreateMultipartUploadSucceed=1]="CreateMultipartUploadSucceed",bt[bt.CreateMultipartUploadFailed=2]="CreateMultipartUploadFailed",bt[bt.UploadPartSucceed=3]="UploadPartSucceed",bt[bt.UploadPartFailed=4]="UploadPartFailed",bt[bt.UploadPartAborted=5]="UploadPartAborted",bt[bt.CompleteMultipartUploadSucceed=6]="CompleteMultipartUploadSucceed",bt[bt.CompleteMultipartUploadFailed=7]="CompleteMultipartUploadFailed";const kt=[403,404,405];async function vt(e){var t,a,o;const{cancelToken:n,enableContentMD5:i=!1}=e,r=E(e.headers);e.headers=r,U(e,["encodingType","cacheControl","contentDisposition","contentEncoding","contentLanguage","contentType","expires","acl","grantFullControl","grantRead","grantReadAcp","grantWriteAcp","ssecAlgorithm","ssecKey","ssecKeyMD5","serverSideEncryption","meta","websiteRedirectLocation","storageClass"]);const s=()=>n&&!!n.reason;Te(e.checkpoint);const c=await(async()=>"string"==typeof e.file?_e(e.file):null)(),p=await(async()=>{const{file:t}=e;if(c)return c.size;if(I(t))return t.length;if(B(t))return t.size;throw new b("`file` must be string, Buffer, File or Blob")})(),l=await(async()=>{if("string"==typeof e.checkpoint){const{checkpoint:t}=e;let a=null;try{a=await _e(t)}catch(e){const t=e;if("ENOENT"!==t.code)throw t}const o=a?a.isDirectory():t.endsWith("/"),n=o?g.resolve(t,"@@checkpoint-file-placeholder@@"):g.resolve(t),i=g.dirname(n);if(await Ae(i,{recursive:!0}),o)return{filePath:n,filePathIsPlaceholder:!0};try{return{filePath:n,filePathIsPlaceholder:!1,record:a?JSON.parse(await Ne(n,"utf-8")):void 0}}catch(e){throw console.warn("the checkpoint file is invalid JSON format. please check checkpoint file"),e}}return"object"==typeof e.checkpoint?{record:e.checkpoint}:{}})();await(async()=>{var e;if(c&&null!=(e=l.record)&&e.file_info){var t;const{last_modified:e,file_size:a}=null==(t=l.record)?void 0:t.file_info;c.mtimeMs===e&&c.size===a||(console.warn(`The file has been modified since ${new Date(e)}, so the checkpoint file is invalid, and specified file will be uploaded again.`),delete l.record)}})();const d=pt(p,e.partSize||(null==(t=l.record)?void 0:t.part_size)||20971520,!0);l.record&&l.record.part_size!==d&&(console.warn("The partSize param does not equal the partSize in checkpoint file, so the checkpoint file is invalid, and specified file will be uploaded again."),delete l.record);let u=e.bucket||this.opts.bucket||"";const h=e.key;let m="",f=[];const y=function(e,t){const a=[];for(let o=0;;++o){const n=o*t,i=Math.min(t,e-n);if(a.push({offset:n,partSize:i,partNumber:o+1}),(o+1)*t>=e)break}return a}(p,d),x=((null==(a=l.record)?void 0:a.parts_info)||[]).filter(e=>e.is_completed).reduce((e,t)=>e+t.part_size,0);let v=x;const T=(null==(o=l.record)?void 0:o.parts_info)||[],w=new Map;T.forEach(e=>w.set(e.part_number,e));const S=()=>{const e={bucket:u,key:h,part_size:d,upload_id:m,parts_info:T};return c&&(e.file_info={last_modified:c.mtimeMs,file_size:c.size}),e},C=t=>{if(!e.uploadEventChange)return;const a={bucket:u,uploadId:m,key:h,...t};l.filePath&&(a.checkpointFile=l.filePath),e.uploadEventChange(a)};let R;!function(e){e[e.start=1]="start",e[e.uploadPartSucceed=2]="uploadPartSucceed",e[e.completeMultipartUploadSucceed=3]="completeMultipartUploadSucceed"}(R||(R={}));const D=t=>{e.progress&&(v===p&&t===R.uploadPartSucceed||e.progress(t===R.start&&0===p?0:p?v/p:1,S()))};let j=x;const{dataTransferStatusChange:M}=e,_=(e,t=0)=>{M&&(j+=t,null==M||M({type:e,rwOnceBytes:t,consumedBytes:j,totalBytes:p}))},A=async(e,t)=>{let a=w.get(e.partNumber);a||(a={part_number:e.partNumber,offset:e.offset,part_size:e.partSize,is_completed:!1,etag:"",hash_crc64ecma:""},T.push(a),w.set(a.part_number,a)),t.err||(a.is_completed=!0,a.etag=t.res.ETag,a.hash_crc64ecma=t.res.hashCrc64ecma),await(async()=>{if(l.filePath){const e=JSON.stringify(S(),null,2),t=g.dirname(l.filePath);await Ae(t,{recursive:!0}),await Ue(l.filePath,e,"utf-8")}})();const o={partNumber:a.part_number,partSize:a.part_size,offset:a.offset};if(t.err){const e=t.err;let a=exports.UploadEventType.UploadPartFailed;return e instanceof ee&&kt.includes(e.statusCode)&&(a=exports.UploadEventType.UploadPartAborted),void C({type:a,err:e,uploadPartInfo:o})}o.etag=t.res.ETag,v+=o.partSize,C({type:exports.UploadEventType.UploadPartSucceed,uploadPartInfo:o}),D(R.uploadPartSucceed)};if(l.record){u=l.record.bucket,m=l.record.upload_id;const e=new Set((l.record.parts_info||[]).filter(e=>e.is_completed).map(e=>e.part_number));f=y.filter(t=>!e.has(t.partNumber))}else{try{const{data:t}=await ct.call(this,e);if(s())throw new k("cancel uploadFile");var L;u=t.Bucket,m=t.UploadId,l.filePathIsPlaceholder&&(l.filePath=null==(L=l.filePath)?void 0:L.replace("@@checkpoint-file-placeholder@@",function(e,t){return`${t}.${G(`${e}.${t}`,"hex")}.upload`.replace(/[\\/]/g,"")}(u,h))),C({type:exports.UploadEventType.CreateMultipartUploadSucceed})}catch(e){const t=e;throw C({type:exports.UploadEventType.CreateMultipartUploadFailed,err:t}),t}f=y}D(R.start),_(exports.DataTransferType.Started);const[N,z]=await P((async()=>{let t=null,a=0;if(await Promise.all(Array.from({length:e.taskNum||1}).map(async()=>{for(;;){const o=a++;if(o>=f.length)return;const n=f[o];let c=0;try{const{data:t}=await dt.call(this,{bucket:u,key:h,uploadId:m,body:Tt(e.file,n),enableContentMD5:i,makeRetryStream:wt(e.file,n),beforeRetry:()=>{j-=c,c=0},partNumber:n.partNumber,headers:{"content-length":""+n.partSize,"x-tos-server-side-encryption-customer-algorithm":r["x-tos-server-side-encryption-customer-algorithm"],"x-tos-server-side-encryption-customer-key":r["x-tos-server-side-encryption-customer-key"],"x-tos-server-side-encryption-customer-key-md5":r["x-tos-server-side-encryption-customer-key-md5"]},dataTransferStatusChange(e){e.type===exports.DataTransferType.Rw&&(s()||(c+=e.rwOnceBytes,_(e.type,e.rwOnceBytes)))},trafficLimit:e.trafficLimit,rateLimiter:e.rateLimiter});if(s())throw new k("cancel uploadFile");await A(n,{res:t})}catch(e){const a=e;if(j-=c,c=0,O(a))throw a;if(s())throw new k("cancel uploadFile");t||(t=a),await A(n,{err:a})}}})),t)throw t;const o=(S().parts_info||[]).map(e=>({eTag:e.etag,partNumber:e.part_number})),[n,c]=await P(st.call(this,{bucket:u,key:h,uploadId:m,parts:o}));if(n||!c)throw C({type:exports.UploadEventType.CompleteMultipartUploadFailed}),n;if(C({type:exports.UploadEventType.CompleteMultipartUploadSucceed}),D(R.completeMultipartUploadSucceed),await(async()=>{l.filePath&&await Le(l.filePath).catch(e=>{console.warn("remove checkpoint file failure, you can remove it by hand.\n",`checkpoint file path: ${l.filePath}\n`,e.message)})})(),this.opts.enableCRC&&c.data.HashCrc64ecma&&function(e){var t;const a=(null==(t=e.file_info)?void 0:t.file_size)||0;let o="0";for(const t of e.parts_info||[])o=ce(o,t.hash_crc64ecma,Math.min(t.part_size,a-t.offset));return o}(S())!==c.data.HashCrc64ecma)throw new b("crc of entire file mismatch.");return c})());if(N||!z)throw _(exports.DataTransferType.Failed),N;return _(exports.DataTransferType.Succeed),z}function Tt(e,t){const{offset:a,partSize:o}=t,n=a+o,i=wt(e,t);if(i)return i();if(B(e))return e.slice(a,n);if(I(e))return e.slice(a,n);throw new b("`file` must be string, Buffer, File or Blob")}function wt(e,t){const{offset:a,partSize:o}=t,n=a+o;if("string"==typeof e)return()=>o?Oe(e,{start:a,end:n-1}):new xt}async function St(e){ge(e),e=this.normalizeObjectInput(e);const{expiresIn:t=3600,key:a}=e,o=e.bucket||this.opts.bucket,n={...e.fields},i=[...e.conditions||[]];if(!o)throw new b("Must provide bucket param");const r=this.opts.accessKeySecret,s=new Date,c=Ct({date:new Date(s.valueOf()+1e3*t),type:"ISO"}),p=Ct(),l=p.substring(0,8),d="tos",u="request",h=H(r,l),m=H(h,this.opts.region),f=H(m,d),y=H(f,u),g={key:a,"x-tos-algorithm":"TOS4-HMAC-SHA256","x-tos-date":p,"x-tos-credential":[this.opts.accessKeyId,l,this.opts.region,d,u].join("/")};this.opts.stsToken&&(g["x-tos-security-token"]=this.opts.stsToken),i.push({bucket:o}),Object.entries(g).forEach(([e,t])=>{n[e]=t}),Object.entries(n).forEach(([e,t])=>{i.push({[e]:""+t})});const x=JSON.stringify({expiration:c,conditions:i}),k=W(V(x,"utf-8"),"base64"),v=H(y,k,"hex");return n.policy=k,n["x-tos-signature"]=v,n}function Ct(e){const{date:t=new Date,type:a="Z"}=e||{};return"ISO"===a?t.toISOString():t.toISOString().replace(/\..+/,"").replace(/-/g,"").replace(/:/g,"")+"Z"}var Et,Rt,Pt,Bt,It,Dt,jt,Ot,Mt,_t,At,Ut,Lt,Nt,zt,Ft;(Et=exports.ACLType||(exports.ACLType={})).ACLPrivate="private",Et.ACLPublicRead="public-read",Et.ACLPublicReadWrite="public-read-write",Et.ACLAuthenticatedRead="authenticated-read",Et.ACLBucketOwnerRead="bucket-owner-read",Et.ACLBucketOwnerFullControl="bucket-owner-full-control",Et.ACLBucketOwnerEntrusted="bucket-owner-entrusted",(Rt=exports.StorageClassType||(exports.StorageClassType={})).StorageClassStandard="STANDARD",Rt.StorageClassIa="IA",Rt.StorageClassArchiveFr="ARCHIVE_FR",Rt.StorageClassColdArchive="COLD_ARCHIVE",Rt.StorageClassIntelligentTiering="INTELLIGENT_TIERING",Rt.StorageClassArchive="ARCHIVE",(Pt=exports.MetadataDirectiveType||(exports.MetadataDirectiveType={})).MetadataDirectiveCopy="COPY",Pt.MetadataDirectiveReplace="REPLACE",(Bt=exports.AzRedundancyType||(exports.AzRedundancyType={})).AzRedundancySingleAz="single-az",Bt.AzRedundancyMultiAz="multi-az",(It=exports.PermissionType||(exports.PermissionType={})).PermissionRead="READ",It.PermissionWrite="WRITE",It.PermissionReadAcp="READ_ACP",It.PermissionWriteAcp="WRITE_ACP",It.PermissionFullControl="FULL_CONTROL",(Dt=exports.GranteeType||(exports.GranteeType={})).GranteeGroup="Group",Dt.GranteeUser="CanonicalUser",(jt=exports.CannedType||(exports.CannedType={})).CannedAllUsers="AllUsers",jt.CannedAuthenticatedUsers="AuthenticatedUsers",(Ot=exports.HttpMethodType||(exports.HttpMethodType={})).HttpMethodGet="GET",Ot.HttpMethodPut="PUT",Ot.HttpMethodPost="POST",Ot.HttpMethodDelete="DELETE",Ot.HttpMethodHead="HEAD",(Mt=exports.StorageClassInheritDirectiveType||(exports.StorageClassInheritDirectiveType={})).StorageClassInheritDirectiveDestinationBucket="DESTINATION_BUCKET",Mt.StorageClassInheritDirectiveSourceObject="SOURCE_OBJECT",(_t=exports.ReplicationStatusType||(exports.ReplicationStatusType={})).Complete="COMPLETE",_t.Pending="PENDING",_t.Failed="FAILED",_t.Replica="REPLICA",(At=exports.LifecycleStatusType||(exports.LifecycleStatusType={})).Enabled="Enabled",At.Disabled="Disabled",(Ut=exports.RedirectType||(exports.RedirectType={})).Mirror="Mirror",Ut.Async="Async",(Lt=exports.StatusType||(exports.StatusType={})).Enabled="Enabled",Lt.Disabled="Disabled",(Nt=exports.TierType||(exports.TierType={})).TierStandard="Standard",Nt.TierExpedited="Expedited",Nt.TierBulk="Bulk",(zt=exports.VersioningStatusType||(exports.VersioningStatusType={})).Enabled="Enabled",zt.Suspended="Suspended",zt.NotSet="",zt.Enable="Enabled",zt.Disable="",(Ft=exports.ResumableCopyEventType||(exports.ResumableCopyEventType={}))[Ft.CreateMultipartUploadSucceed=1]="CreateMultipartUploadSucceed",Ft[Ft.CreateMultipartUploadFailed=2]="CreateMultipartUploadFailed",Ft[Ft.UploadPartCopySucceed=3]="UploadPartCopySucceed",Ft[Ft.UploadPartCopyFailed=4]="UploadPartCopyFailed",Ft[Ft.UploadPartCopyAborted=5]="UploadPartCopyAborted",Ft[Ft.CompleteMultipartUploadSucceed=6]="CompleteMultipartUploadSucceed",Ft[Ft.CompleteMultipartUploadFailed=7]="CompleteMultipartUploadFailed";const Kt=[403,404,405];async function qt(e){var t,a,o;const{cancelToken:n}=e,i=()=>n&&!!n.reason;Te(e.checkpoint);const{data:r}=await Ze.call(this,{bucket:e.srcBucket,key:e.srcKey,versionId:e.srcVersionId}),s=r.etag,c=+r["content-length"],p=await(async()=>{if("string"==typeof e.checkpoint){const{checkpoint:t}=e;let a=null;try{a=await _e(t)}catch(e){const t=e;if("ENOENT"!==t.code)throw t}const o=a?a.isDirectory():t.endsWith("/"),n=o?g.resolve(t,"@@checkpoint-file-placeholder@@"):g.resolve(t),i=g.dirname(n);return await Ae(i,{recursive:!0}),o?{filePath:n,filePathIsPlaceholder:!0}:{filePath:n,filePathIsPlaceholder:!1,record:a?JSON.parse(await Ne(n,"utf-8")):void 0}}return"object"==typeof e.checkpoint?{record:e.checkpoint}:{}})();await(async()=>{var e;if(null!=(e=p.record)&&e.copy_source_object_info){var t;const{last_modified:e,object_size:a}=null==(t=p.record)?void 0:t.copy_source_object_info;r["last-modified"]===e&&+r["content-length"]===a||(console.warn(`The file has been modified since ${new Date(e)}, so the checkpoint file is invalid, and specified file will be uploaded again.`),delete p.record)}})();const l=pt(c,e.partSize||(null==(t=p.record)?void 0:t.part_size)||20971520,!0);p.record&&p.record.part_size!==l&&(console.warn("The partSize param does not equal the partSize in checkpoint file, so the checkpoint file is invalid, and specified file will be uploaded again."),delete p.record);let d=e.bucket||this.opts.bucket||"";const u=e.key;let h="",m=[];const f=function(e,t){const a=[];for(let o=0;;++o){const n=o*t,i=Math.min(t,e-n);if(a.push({offset:n,partSize:i,partNumber:o+1}),(o+1)*t>=e)break}return a}(c,l);let y=((null==(a=p.record)?void 0:a.parts_info)||[]).filter(e=>e.is_completed).reduce((e,t)=>e+t.copy_source_range_end-t.copy_source_range_start+1,0);const b=(null==(o=p.record)?void 0:o.parts_info)||[],v=new Map;b.forEach(e=>v.set(e.part_number,e));const T=()=>({bucket:d,key:u,part_size:l,upload_id:h,parts_info:b,copy_source_object_info:{last_modified:r["last-modified"],etag:r.etag,hash_crc64ecma:r["x-tos-hash-crc64ecma"]||"",object_size:+r["content-length"]}}),w=t=>{if(!e.copyEventListener)return;const a={bucket:d,uploadId:h,key:u,...t};p.filePath&&(a.checkpointFile=p.filePath),e.copyEventListener(a)};let S;!function(e){e[e.start=1]="start",e[e.uploadPartSucceed=2]="uploadPartSucceed",e[e.completeMultipartUploadSucceed=3]="completeMultipartUploadSucceed"}(S||(S={}));const C=t=>{e.progress&&(y===c&&t===S.uploadPartSucceed||e.progress(t===S.start&&0===c?0:c?y/c:1,T()))},E=async(e,t)=>{let a=v.get(e.partNumber);const o=e.offset,n=Math.min(e.offset+l-1,c-1);a||(a={part_number:e.partNumber,copy_source_range_start:o,copy_source_range_end:n,is_completed:!1,etag:""},b.push(a),v.set(a.part_number,a)),t.err||(a.is_completed=!0,a.etag=t.res.ETag),await(async()=>{if(p.filePath){const e=JSON.stringify(T(),null,2),t=g.dirname(p.filePath);await Ae(t,{recursive:!0}),await Ue(p.filePath,e,"utf-8")}})();const i={partNumber:a.part_number,copySourceRangeEnd:a.copy_source_range_end,copySourceRangeStart:a.copy_source_range_start};if(t.err){const e=t.err;let a=exports.ResumableCopyEventType.UploadPartCopyFailed;return e instanceof ee&&Kt.includes(e.statusCode)&&(a=exports.ResumableCopyEventType.UploadPartCopyAborted),void w({type:a,err:e,copyPartInfo:i})}i.etag=t.res.ETag,y+=i.copySourceRangeEnd-i.copySourceRangeStart+1,w({type:exports.ResumableCopyEventType.UploadPartCopySucceed,copyPartInfo:i}),C(S.uploadPartSucceed)};if(p.record){d=p.record.bucket,h=p.record.upload_id;const e=new Set((p.record.parts_info||[]).filter(e=>e.is_completed).map(e=>e.part_number));m=f.filter(t=>!e.has(t.partNumber))}else{try{const{data:t}=await ct.call(this,x(e));if(i())throw new k("cancel uploadFile");var R;d=t.Bucket,h=t.UploadId,p.filePathIsPlaceholder&&(p.filePath=null==(R=p.filePath)?void 0:R.replace("@@checkpoint-file-placeholder@@",[(B={...e,bucket:d}).srcBucket,B.srcKey,B.srcVersionId,B.bucket,B.key,"copy"].filter(Boolean).join(".").replace(/[\\/]/g,""))),w({type:exports.ResumableCopyEventType.CreateMultipartUploadSucceed})}catch(e){const t=e;throw w({type:exports.ResumableCopyEventType.CreateMultipartUploadFailed,err:t}),t}m=f}var B;return C(S.start),0===c?(async()=>{let t=ke(e.srcBucket,e.srcKey);e.srcVersionId&&(t+="?versionId="+e.srcVersionId);const a={...e.headers,"x-tos-copy-source":t,"x-tos-copy-source-if-match":s},[o,n]=await P(ot.call(this,{bucket:e.bucket,key:e.key,headers:a,trafficLimit:e.trafficLimit}));if(o||!n)throw w({type:exports.ResumableCopyEventType.UploadPartCopyFailed}),o;return C(S.completeMultipartUploadSucceed),w({type:exports.ResumableCopyEventType.UploadPartCopySucceed,copyPartInfo:{partNumber:0,copySourceRangeStart:0,copySourceRangeEnd:0}}),w({type:exports.ResumableCopyEventType.CompleteMultipartUploadSucceed}),{...n,data:{ETag:n.headers.etag||"",Bucket:d,Key:u,Location:`http${this.opts.secure?"s":""}://${d}.${this.opts.endpoint}/${u}`,VersionID:n.headers["x-tos-version-id"],HashCrc64ecma:n.headers["x-tos-hash-crc64ecma"]}}})():(async()=>{let t=null,a=0;if(await Promise.all(Array.from({length:e.taskNum||1}).map(async()=>{for(;;){const o=a++;if(o>=m.length)return;const n=m[o];try{let t=ke(e.srcBucket,e.srcKey);e.srcVersionId&&(t+="?versionId="+e.srcVersionId);const a=`bytes=${n.offset}-${n.offset+n.partSize-1}`,o={...e.headers,"x-tos-copy-source":t,"x-tos-copy-source-if-match":s,"x-tos-copy-source-range":a};n.partSize||delete o["x-tos-copy-source-range"];const{data:r}=await gt.call(this,{bucket:d,key:u,uploadId:h,partNumber:n.partNumber,headers:o,trafficLimit:e.trafficLimit});if(i())throw new k("cancel resumableCopyObject");await E(n,{res:r})}catch(e){const a=e;if(Ht(a))throw a;if(i())throw new k("cancel resumableCopyObject");t||(t=a),await E(n,{err:a})}}})),t)throw t;const o=(T().parts_info||[]).map(e=>({eTag:e.etag,partNumber:e.part_number})),[n,r]=await P(st.call(this,{bucket:d,key:u,uploadId:h,parts:o}));if(n||!r)throw w({type:exports.ResumableCopyEventType.CompleteMultipartUploadFailed}),n;return w({type:exports.ResumableCopyEventType.CompleteMultipartUploadSucceed}),C(S.completeMultipartUploadSucceed),await(async()=>{p.filePath&&await Le(p.filePath).catch(e=>{console.warn("remove checkpoint file failure, you can remove it by hand.\n",`checkpoint file path: ${p.filePath}\n`,e.message)})})(),r})()}function Ht(e){return e instanceof k}const $t={getBucketCustomDomain:!0,getBucketIntelligenttiering:!0,getBucketInventory:!0,listBucketInventory:!0,getBucketMirrorBack:!0,getBucketNotification:!0,getBucketPolicy:!0,getBucketRealTimeLog:!0,getBucketReplication:!0,getBucketTagging:!0,getBucketWebsite:!0};function Gt(e,t){const{enableCatchEmptyServerError:a,methodKey:o,defaultResponse:n}=t;if(e instanceof ee)if(a){if(404===e.statusCode)return N(n,e)}else if(void 0===a&&404===e.statusCode&&$t[o])return N(n,e);throw e}async function Vt(e){return!this.opts.enableOptimizeMethodBehavior&&void 0!==this.opts.enableOptimizeMethodBehavior||e.policy.Statement.length?await this.fetchBucket(e.bucket,"PUT",{policy:""},{},e.policy,{needMd5:!0}):Jt.call(this,e.bucket)}async function Wt(e){try{const t=await this.fetchBucket(e,"GET",{policy:""},{});return t.data.Statement.forEach(e=>{const t=v(e);Object.keys(e.Condition||{}).forEach(a=>{Object.keys(e.Condition[a]).forEach(e=>{t(`Condition["${a}"]["${e}"]`)})})}),t}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketPolicy",defaultResponse:{Statement:[],Version:"2012-10-17"}})}}async function Jt(e){return this.fetchBucket(e,"DELETE",{policy:""},{})}async function Xt(e){return this.fetchBucket(e,"GET",{versioning:""},{})}async function Qt(e){return this.fetchBucket(e.bucket,"PUT",{versioning:""},{},{Status:e.status})}function Yt(e){const t=Zt.call(this,e);ea(e.conditions);const a=`http${this.opts.secure?"s":""}://${e.alternativeEndpoint||(e.isCustomDomain?this.opts.endpoint:`${t.bucket}.${this.opts.endpoint}`)}`,o=j(this.getSignatureQuery({bucket:t.bucket,expires:t.expires,policy:{conditions:t.conditions}}));return{getSignedURLForList:e=>{const t=j(e),n=[o,t].filter(Boolean).join("&");return`${a}?${n}`},getSignedURLForGetOrHead:(e,t)=>{const n=j(t),i=[o,n].filter(Boolean).join("&"),r=e.split("/").map(e=>encodeURIComponent(e)).join("/");return`${a}/${r}?${i}`},signedQuery:o}}function Zt(e){const t=e.bucket||this.opts.bucket;if(!t)throw new b("Must provide bucket param");ea(e.conditions);const a=e.conditions.map(e=>[e.operator||"eq","$key",e.value]);return a.push(["eq","$bucket",t]),{bucket:t,expires:e.expires||3600,conditions:a}}function ea(e){if(e.length<1)throw new b("The `conditions` field of `PreSignedPolicyURLInput` must has one item at least");for(const t of e){if("key"!==t.key)throw new b("The `key` field of `PolicySignatureCondition` must be `'key'`");if(t.operator&&"eq"!==t.operator&&"starts-with"!==t.operator)throw new b("The `operator` field of `PolicySignatureCondition` must be `'eq'` or `'starts-with'`")}}var ta;(ta=exports.DownloadEventType||(exports.DownloadEventType={}))[ta.CreateTempFileSucceed=1]="CreateTempFileSucceed",ta[ta.CreateTempFileFailed=2]="CreateTempFileFailed",ta[ta.DownloadPartSucceed=3]="DownloadPartSucceed",ta[ta.DownloadPartFailed=4]="DownloadPartFailed",ta[ta.DownloadPartAborted=5]="DownloadPartAborted",ta[ta.RenameTempFileSucceed=6]="RenameTempFileSucceed",ta[ta.RenameTempFileFailed=7]="RenameTempFileFailed";const aa=[403,404,405];async function oa(e){var t,a,o;const{cancelToken:n,versionId:i}=e,r=()=>n&&!!n.reason;Te(e.checkpoint);const s=await Ze.call(this,{bucket:e.bucket,key:e.key,versionId:i}),{data:c}=s,p=c.etag,l=+c["content-length"],d=await(async()=>{if("string"==typeof e.checkpoint){const{checkpoint:t}=e;let a=null;try{a=await _e(t)}catch(e){const t=e;if("ENOENT"!==t.code)throw t}const o=a?a.isDirectory():t.endsWith("/"),n=o?g.resolve(t,"@@checkpoint-file-placeholder@@"):t,i=g.dirname(n);return await Ae(i,{recursive:!0}),o?{filePath:n,filePathIsPlaceholder:!0}:{filePath:n,filePathIsPlaceholder:!1,record:a?JSON.parse(await Ne(n,"utf-8")):void 0}}return"object"==typeof e.checkpoint?{record:e.checkpoint}:{}})();await(async()=>{var e;if(null!=(e=d.record)&&e.object_info){var t;const{last_modified:e,object_size:a}=null==(t=d.record)?void 0:t.object_info;c["last-modified"]===e&&l===a||(console.warn(`The file has been modified since ${new Date(e)}, so the checkpoint file is invalid, and specified object will be downloaded again.`),delete d.record)}})();const u=e.partSize||(null==(t=d.record)?void 0:t.part_size)||20971520;d.record&&d.record.part_size!==u&&(console.warn("The partSize param does not equal the partSize in checkpoint file, so the checkpoint file is invalid, and specified object will be downloaded again."),delete d.record);let h=e.bucket||this.opts.bucket||"";const m=e.key;let f=[];const y=function(e,t){const a=[];for(let o=0;;++o){const n=o*t,i=Math.min(t,e-n);if(a.push({offset:n,partSize:i,partNumber:o+1}),(o+1)*t>=e)break}return a}(l,u),x=((null==(a=d.record)?void 0:a.parts_info)||[]).filter(e=>e.is_completed).reduce((e,t)=>e+(t.range_end-t.range_start+1),0),v=(null==(o=d.record)?void 0:o.parts_info)||[],T=new Map;v.forEach(e=>T.set(e.part_number,e));const w=await(async()=>{let t=null;try{t=await _e(e.filePath)}catch(e){const t=e;if("ENOENT"!==t.code)throw t}const a=(t?t.isDirectory():e.filePath.endsWith("/"))?g.resolve(e.filePath,m):e.filePath,o=g.dirname(a);return await Ae(o,{recursive:!0}),a})(),[S,C]=await(async()=>{const t=w+".temp";let a=!0;try{await _e(e.filePath)}catch(e){const t=e;if("ENOENT"!==t.code)throw t;a=!1}return[t,a]})();d.record&&(C||(console.warn("The temp file doesn't not exist so the checkpoint file is invalid, and specified object will be downloaded again."),delete d.record));const E=async()=>{const t=()=>({bucket:h,key:m,version_id:i,part_size:u,parts_info:v,file_info:{file_path:w,temp_file_path:S},object_info:{last_modified:c["last-modified"],etag:p,hash_crc64ecma:c["x-tos-hash-crc64ecma"]||"",object_size:l}}),a=t=>{if(!e.downloadEventChange)return;const a={bucket:h,versionId:i,key:m,filePath:w,...t};d.filePath&&(a.checkpointFile=d.filePath),e.downloadEventChange(a)};let o,n=x;!function(e){e[e.start=0]="start",e[e.downloadPartSucceed=1]="downloadPartSucceed",e[e.renameTempFileSucceed=2]="renameTempFileSucceed"}(o||(o={}));const C=a=>{e.progress&&(n===l&&a===o.downloadPartSucceed||e.progress(a===o.start&&0===l?0:l?n/l:1,t()))};let E=x;const{dataTransferStatusChange:R}=e,P=(e,t=0)=>{R&&(E+=t,null==R||R({type:e,rwOnceBytes:t,consumedBytes:E,totalBytes:l}))},B=async(e,i)=>{let r=T.get(e.partNumber);const s=e.offset,c=Math.min(e.offset+u-1,l-1);r||(r={part_number:e.partNumber,range_start:s,range_end:c,hash_crc64ecma:"",is_completed:!1},v.push(r),T.set(r.part_number,r)),i.err||(r.is_completed=!0,r.hash_crc64ecma=i.res.rangeHashCrc64ecma),await(async()=>{if(d.filePath){const e=JSON.stringify(t(),null,2),a=g.dirname(d.filePath);await Ae(a,{recursive:!0}),await Ue(d.filePath,e,"utf-8")}})();const p={partNumber:r.part_number,rangeStart:s,rangeEnd:c};if(i.err){const e=i.err;let t=exports.DownloadEventType.DownloadPartFailed;return e instanceof ee&&aa.includes(e.statusCode)&&(t=exports.DownloadEventType.DownloadPartAborted),void a({type:t,err:e,downloadPartInfo:p})}n+=p.rangeEnd-p.rangeStart+1,a({type:exports.DownloadEventType.DownloadPartSucceed,downloadPartInfo:p}),C(o.downloadPartSucceed)};if(d.record){h=d.record.bucket;const e=new Set((d.record.parts_info||[]).filter(e=>e.is_completed).map(e=>e.part_number));f=y.filter(t=>!e.has(t.partNumber))}else{try{await Ue(S,"",{flag:"w+"})}catch(e){const t=e;throw a({type:exports.DownloadEventType.CreateTempFileFailed,err:t}),t}var I;d.filePathIsPlaceholder&&(d.filePath=null==(I=d.filePath)?void 0:I.replace("@@checkpoint-file-placeholder@@",function(e,t,a){return`${e}_${t}.${a}.json`.replace(/[\\/]/g,"")}(h,m,i))),a({type:exports.DownloadEventType.CreateTempFileSucceed}),P(exports.DataTransferType.Started),f=y}C(o.start),0===l?await(async()=>{})():await(async()=>{let a=null,o=0;if(await Promise.all(Array.from({length:e.taskNum||1}).map(async()=>{for(;;){const t=o++;if(t>=f.length)return;const n=f[t];let s=0;try{const t=await qe.call(this,{bucket:h,key:m,versionId:i,headers:{"if-match":p,range:`bytes=${n.offset}-${Math.min(n.offset+n.partSize-1,l-1)}`},trafficLimit:e.trafficLimit,rateLimiter:e.rateLimiter,dataTransferStatusChange(e){e.type===exports.DataTransferType.Rw&&(r()||(s+=e.rwOnceBytes,P(exports.DataTransferType.Rw,e.rwOnceBytes)))}});let a=t.data.content;const o=new se;if(this.opts.enableCRC&&(a=fe(a,o)),await new Promise((e,t)=>{const o=je(S,{start:n.offset,flags:"r+"});o.on("finish",()=>{e(void 0)}),a.on("error",e=>{t(e)}),a.pipe(o),a.on("data",(function e(){r()&&(t(new k("cancel downloadFile")),a.unpipe(o),a.off("data",e))}))}),r())throw new k("cancel downloadFile");await B(n,{res:{...t.data,rangeHashCrc64ecma:o.getCrc64()}})}catch(e){const t=e;if(E-=s,s=0,O(t))throw t;if(r())throw new k("cancel downloadFile");a||(a=t),await B(n,{err:t})}}})),a)throw a;const n=s.data["x-tos-hash-crc64ecma"];if(this.opts.enableCRC&&n){const e=function(e){let t="0";for(const a of e.parts_info||[])t=ce(t,a.hash_crc64ecma,a.range_end-a.range_start+1);return t}(t());if(e!==n)throw new b(`expect crc64 ${n}, actual crc64 ${e}`)}})();try{await Me(S,w)}catch(e){const t=e;throw a({type:exports.DownloadEventType.RenameTempFileFailed,err:t}),P(exports.DataTransferType.Failed),t}return a({type:exports.DownloadEventType.RenameTempFileSucceed}),C(o.renameTempFileSucceed),P(exports.DataTransferType.Succeed),await(async()=>{d.filePath&&await Le(d.filePath).catch(e=>{console.warn("remove checkpoint file failure, you can remove it by hand.\n",`checkpoint file path: ${d.filePath}\n`,e.message)})})(),s};try{return await E()}finally{}}async function na(e){const{bucket:t}=e;return this.fetchBucket(t,"GET",{location:""},{})}async function ia(e){try{const{bucket:t}=e;return await this.fetchBucket(t,"GET",{cors:""},{})}catch(e){return Gt(e,{defaultResponse:{CORSRules:[]},enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketCORS"})}}async function ra(e){const{bucket:t,CORSRules:a}=e;return this.opts.enableOptimizeMethodBehavior&&!a.length?sa.call(this,{bucket:t}):this.fetchBucket(t,"PUT",{cors:""},{},{CORSRules:a})}async function sa(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{cors:""},{})}async function ca(e={}){const{listOnlyOnce:t=!1}=e;let a;if(e.maxKeys||(e.maxKeys=1e3),t)a=await pa.call(this,e);else{const t=e.maxKeys;let o={...e,maxKeys:t};for(;;){const e=await pa.call(this,o);if(null==a?a=e:(a={...e,data:a.data},a.data.KeyCount+=e.data.KeyCount,a.data.IsTruncated=e.data.IsTruncated,a.data.NextContinuationToken=e.data.NextContinuationToken,a.data.Contents=a.data.Contents.concat(e.data.Contents),a.data.CommonPrefixes=a.data.CommonPrefixes.concat(e.data.CommonPrefixes)),!e.data.IsTruncated||a.data.KeyCount>=t)break;o.continuationToken=e.data.NextContinuationToken,o.maxKeys=o.maxKeys-e.data.KeyCount}}return a}async function pa(e){const{...t}=e,a=await this.fetchBucket(e.bucket,"GET",{"list-type":2,...w(t)},{}),o=v(a.data);return o("CommonPrefixes"),o("Contents"),a}async function la(e){const{bucket:t,rules:a}=e;if(this.opts.enableOptimizeMethodBehavior&&!a.length)return ua.call(this,{bucket:t});const o={};return U({...e,headers:o},["allowSameActionOverlap"]),this.fetchBucket(t,"PUT",{lifecycle:""},o,{Rules:a})}async function da(e){try{const{bucket:t}=e;return await this.fetchBucket(t,"GET",{lifecycle:""},{},{},{handleResponse:e=>({AllowSameActionOverlap:e.headers["x-tos-allow-same-action-overlap"],Rules:e.data.Rules})})}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketLifecycle",defaultResponse:{Rules:[]}})}}async function ua(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{lifecycle:""},{})}async function ha(e){const{bucket:t,rule:a}=e;return this.fetchBucket(t,"PUT",{encryption:""},{"Content-MD5":F(JSON.stringify({Rule:a}),"base64")},{Rule:a})}async function ma(e){const{bucket:t}=e;return this.fetchBucket(t,"GET",{encryption:""},{})}async function fa(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{encryption:""},{})}async function ya(e){const{bucket:t,rules:a}=e;return this.opts.enableOptimizeMethodBehavior&&!a.length?xa.call(this,{bucket:t}):this.fetchBucket(t,"PUT",{mirror:""},{},{Rules:a})}async function ga(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{mirror:""},{})}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketMirrorBack",defaultResponse:{Rules:[]}})}}async function xa(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{mirror:""},{})}async function ba(e){const{tagSet:t,versionId:a}=e,o=E({versionId:a});return this._fetchObject(e,"PUT",{tagging:"",...o},{},{TagSet:t})}async function ka(e){const{versionId:t}=e,a=E({versionId:t}),o=await this._fetchObject(e,"GET",{tagging:"",...a},{});return v(o.data.TagSet)("Tags"),o}async function va(e){const{versionId:t}=e,a=E({versionId:t});return this._fetchObject(e,"DELETE",{tagging:"",...a},{})}async function Ta(e){const{bucket:t,rules:a,role:o}=e;return this.opts.enableOptimizeMethodBehavior&&!a.length?Sa.call(this,{bucket:t}):this.fetchBucket(t,"PUT",{replication:""},{},{Role:o,Rules:a})}async function wa(e){const{bucket:t,progress:a,ruleId:o}=e,n={replication:"",progress:a||""};null!=o&&(n["rule-id"]=""+o);try{return await this.fetchBucket(t,"GET",n,{})}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketReplication",defaultResponse:{Rules:[],Role:""}})}}async function Sa(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{replication:""},{})}async function Ca(e){const{bucket:t,...a}=e,o=S(a);return this.fetchBucket(t,"PUT",{website:""},{},{...o})}async function Ea(e){const{bucket:t}=e;try{return this.fetchBucket(t,"GET",{website:""},{})}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketWebsite",defaultResponse:{RoutingRules:[]}})}}async function Ra(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{website:""},{})}async function Pa(e){const{bucket:t,...a}=e,o=S(a);return this.fetchBucket(t,"PUT",{notification:""},{},{...o})}async function Ba(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{notification:""},{})}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketNotification",defaultResponse:{CloudFunctionConfigurations:[],RocketMQConfigurations:[]}})}}async function Ia(e){const{bucket:t,...a}=e,o=S(a);return this.fetchBucket(t,"PUT",{customdomain:""},{},{...o})}async function Da(e){try{const{bucket:t}=e;return await this.fetchBucket(t,"GET",{customdomain:""},{})}catch(e){return Gt(e,{defaultResponse:{CustomDomainRules:[]},enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketCustomDomain"})}}async function ja(e){const{bucket:t,customDomain:a}=e;return this.fetchBucket(t,"DELETE",{customdomain:a},{})}async function Oa(e){const{bucket:t,...a}=e,o=S(a);return this.fetchBucket(t,"PUT",{realtimeLog:""},{},{...o})}async function Ma(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{realtimeLog:""},{})}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketRealTimeLog",defaultResponse:{}})}}async function _a(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{realtimeLog:""},{})}var Aa,Ua,La;async function Na(e){try{return await this.fetchBucket(e.bucket,"GET",{inventory:"",id:e.id},{})}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketInventory",defaultResponse:void 0})}}async function za(e){const t={inventory:"",...e.continuationToken?{"continuation-token":e.continuationToken}:null};try{return await this.fetchBucket(e.bucket,"GET",t,{})}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"listBucketInventory",defaultResponse:{InventoryConfigurations:[]}})}}async function Fa(e){return this.fetchBucket(e.bucket,"DELETE",{inventory:"",id:e.id},{})}function Ka(e){return this.fetchBucket(e.bucket,"PUT",{inventory:"",id:e.inventoryConfiguration.Id},{},e.inventoryConfiguration)}async function qa(e){const{accountId:t,...a}=e,o=S(a);return await this.fetch("POST","/jobs",{},{"x-tos-account-id":t},{...o})}async function Ha(e){const{accountId:t,maxResults:a=1e3,...o}=e;return await this.fetch("GET","/jobs",{maxResults:a,...o},{"x-tos-account-id":t},{},{axiosOpts:{paramsSerializer:L}})}async function $a(e){const{accountId:t,jobId:a,priority:o}=e;return await this.fetch("POST",`/jobs/${a}/priority`,{priority:o},{"x-tos-account-id":t},{},{needMd5:!0})}async function Ga(e){const{accountId:t,jobId:a,requestedJobStatus:o,statusUpdateReason:n}=e;return await this.fetch("POST",`/jobs/${a}/status`,{requestedJobStatus:o,statusUpdateReason:n},{"x-tos-account-id":t},{},{needMd5:!0})}async function Va(e){const{accountId:t,JobId:a}=e;return await this.fetch("DELETE","/jobs/"+a,{},{"x-tos-account-id":t},{})}async function Wa(e){const{accountId:t,JobId:a}=e;return await this.fetch("GET","/jobs/"+a,{},{"x-tos-account-id":t},{})}async function Ja(e){return await this.fetchBucket(e.bucket,"PUT",{tagging:""},{},e.tagging,{needMd5:!0})}async function Xa({bucket:e}){try{return await this.fetchBucket(e,"GET",{tagging:""},{})}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketTagging",defaultResponse:{TagSet:{Tags:[]}}})}}async function Qa({bucket:e}){return this.fetchBucket(e,"DELETE",{tagging:""},{})}async function Ya(e){return await this.fetchBucket(e.bucket,"PUT",{payByTraffic:""},{},e.payByTraffic)}async function Za({bucket:e}){return await this.fetchBucket(e,"GET",{payByTraffic:""},{})}async function eo(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{imageStyleBriefInfo:""},{})}catch(e){if(e instanceof ee&&404===e.statusCode)return this.getNormalDataFromError({BucketName:t,ImageStyleBriefInfo:[]},e);throw e}}async function to(e){try{return await this.fetchBucket(e,"GET",{imageStyle:""},{})}catch(e){if(e instanceof ee&&404===e.statusCode)return this.getNormalDataFromError({ImageStyles:[]},e);throw e}}async function ao(e){try{const{bucket:t,styleName:a}=e;return await this.fetchBucket(t,"GET",{imageStyleContent:"",styleName:a},{})}catch(e){if(e instanceof ee&&404===e.statusCode)return this.getNormalDataFromError({ImageStyles:[]},e);throw e}}async function oo(e,t){try{return await this.fetchBucket(e,"GET",{imageStyle:"",styleName:t},{})}catch(e){if(e instanceof ee&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function no(e){const{bucket:t,styleName:a,content:o,styleObjectPrefix:n}=e;try{return await this.fetchBucket(t,"PUT",{imageStyle:"",styleName:a,styleObjectPrefix:n},{},{Content:o})}catch(e){if(e instanceof ee&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function io(e){const{styleName:t,styleObjectPrefix:a,bucket:o}=e;try{return await this.fetchBucket(o,"DELETE",{imageStyle:"",styleName:t,styleObjectPrefix:a},{})}catch(e){if(e instanceof ee&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function ro(e,t){try{return await this.fetchBucket(e,"PUT",{originalImageProtect:""},{},t)}catch(e){if(e instanceof ee&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function so(e){try{return await this.fetchBucket(e,"GET",{originalImageProtect:""},{})}catch(e){if(e instanceof ee&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function co(e){const{bucket:t,Separator:a,SeparatorSuffix:o}=e;try{return await this.fetchBucket(t,"PUT",{imageStyleSeparator:""},{},{Separator:a,SeparatorSuffix:o})}catch(e){if(e instanceof ee&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function po(e){try{return await this.fetchBucket(e,"GET",{imageStyleSeparator:""},{})}catch(e){if(e instanceof ee&&404===e.statusCode)return this.getNormalDataFromError(null,e);throw e}}async function lo(e){try{return await this.fetchBucket(e,"GET",{intelligenttiering:""},{})}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketIntelligenttiering",defaultResponse:{}})}}async function uo(e){const{bucket:t,...a}=e,o=S(a);return this.fetchBucket(t,"PUT",{rename:""},{},{...o})}async function ho(e){const{bucket:t}=e;return await this.fetchBucket(t,"GET",{rename:""},{})}async function mo(e){const{bucket:t}=e;return this.fetchBucket(t,"DELETE",{rename:""},{})}async function fo(e){const{versionId:t,...a}=e,o={restore:""};t&&(o.versionId=t);const n=S(a);return this._fetchObject(e,"POST",o,{},n)}async function yo(e){const{accountId:t}=e;return await this.fetch("GET","/storagelens",{},{"x-tos-account-id":t},{},{axiosOpts:{paramsSerializer:L}})}async function go(e){const{accountId:t,Id:a}=e;return await this.fetch("DELETE","/storagelens",{id:a},{"x-tos-account-id":t},{},{needMd5:!0})}async function xo(e){const{accountId:t,Id:a}=e;return await this.fetch("GET","/storagelens",{id:a},{"x-tos-account-id":t},{},{needMd5:!0})}async function bo(e){const{accountId:t,Id:a,...o}=e;return await this.fetch("PUT","/storagelens",{id:a},{"x-tos-account-id":t},{...o,Id:a},{needMd5:!0})}async function ko(e){const{bucket:t,...a}=e,o=S(a);return this.fetchBucket(t,"PUT",{notification_v2:""},{},{...o})}async function vo(e){const{bucket:t}=e;try{return await this.fetchBucket(t,"GET",{notification_v2:""},{})}catch(e){return Gt(e,{enableCatchEmptyServerError:this.opts.enableOptimizeMethodBehavior,methodKey:"getBucketNotificationType2",defaultResponse:{Rules:[]}})}}!function(e){e.Daily="Daily",e.Weekly="Weekly"}(Aa||(Aa={})),function(e){e.All="All",e.Current="Current"}(Ua||(Ua={})),function(e){e.Size="Size",e.LastModifiedDat="LastModifiedDate",e.ETag="ETag",e.StorageClass="StorageClass",e.IsMultipartUploaded="IsMultipartUploaded",e.EncryptionStatus="EncryptionStatus",e.CRC64="CRC64",e.ReplicationStatus="ReplicationStatus"}(La||(La={}));const To=l.CancelToken;class wo extends class{constructor(e){this.opts=void 0,this.axiosInst=void 0,this.userAgent=void 0,this.httpAgent=void 0,this.httpsAgent=void 0,this.getObjectPath=e=>{const t="string"!=typeof e&&e.bucket||this.opts.bucket,a="string"==typeof e?e:e.key;if(!t)throw new b("Must provide bucket param");return`/${t}/${encodeURIComponent(a)}`},this.setObjectContentTypeHeader=(e,t)=>{if(null!=t["content-type"])return;let a="application/octet-stream";const o=(e=>"string"==typeof e?e:e.key)(e);this.opts.autoRecognizeContentType&&(a=function(e){const t=e.lastIndexOf(".");if(t<=0)return;const a=e.slice(t+1).toLowerCase();return oe[a]}(o)||a),a&&(t["content-type"]=a)},this.getNormalDataFromError=N,this.opts=this.normalizeOpts(e),this.httpAgent=ae({tosOpts:{...this.opts,isHttps:!1}}),this.httpsAgent=ae({tosOpts:{...this.opts,isHttps:!this.opts.proxyHost}}),this.userAgent=this.getUserAgent(),this.axiosInst=(e=>{const t=l.create();t.defaults.auth=void 0,t.defaults.responseType="json",t.defaults.params=void 0,t.defaults.headers={},t.defaults.withCredentials=!1,t.defaults.maxContentLength=-1,t.defaults.maxBodyLength=-1,t.defaults.maxRedirects=0,t.defaults.validateStatus=function(e){return e>=200&&e<300},t.defaults.decompress=!1,t.defaults.transitional={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};const a=e=>{var t;return e.headers=e.headers||e.header||(null==e||null==(t=e.response)?void 0:t.headers)||{},e};function o(e){Object.entries(e).forEach(([t,a])=>{const[o,n]=function(e){try{return[null,decodeURI(a)]}catch(e){return[e,null]}}();if(o||null==n||n===a)return;let i=[];const r=(""+a).match(/./gu),s=n.match(/./gu);for(let e=0,t=0;e<s.length;){const a=s[e];if(a===r[t]){i.push(a),++e,++t;continue}const o=encodeURIComponent(a);a.length>1||a.charCodeAt(0)>=128?i.push(a):i.push(o),++e,t+=o.length}e[t]=i.join("")})}return t.interceptors.response.use(a,e=>(a(e),Promise.reject(e))),t.interceptors.response.use(e=>e.headers?(o(e.headers),e):e,async e=>{var t;if(!l.isAxiosError(e))return Promise.reject(e);const a=null==(t=e.response)?void 0:t.headers;return a?(o(a),Promise.reject(e)):Promise.reject(e)}),t.interceptors.response.use(void 0,async a=>{var o;const{config:n}=a;if(!n)return Promise.reject(a);n.__retryConfig__||(n.__retryConfig__={});const r=n.__retryConfig__,s=null!=(o=r.retryCount)?o:0;let c=n.data;const p=(()=>{if(n.data&&n.data instanceof i.Readable){const e=null==r.makeRetryStream?void 0:r.makeRetryStream();if(!e)return!1;c=e}return!0})();if(!((function(e){var t;return!e.response&&Boolean(e.code)||e.response&&!(null!=(t=e.response.headers)&&t["x-tos-request-id"])}(a)||function(e){if(!e.response)return!1;const{status:t}=e.response;return 429===t||t>=500}(a))&&s<e&&p))return Promise.reject(a);const l={...n,data:c,__retryConfig__:{...r,retryCount:s+1}};return null==r.beforeRetry||r.beforeRetry(),t(l)}),t})(this.opts.maxRetryCount)}normalizeOpts(e){var t;["accessKeyId","accessKeySecret","stsToken","region","endpoint"].forEach(t=>{const a=e[t];"string"==typeof a&&(e[t]=a.trim())});const a=["accessKeyId","accessKeySecret","region"].filter(t=>!e[t]).join(", ");if(a)throw new b(`lack params: ${a}.`);const o=e.endpoint||`tos-${e.region}.volces.com`;if(!o)throw new b("the value of param region is invalid, correct values are cn-beijing, cn-nantong etc.");if(o.includes("s3"))throw new b("do not support s3 endpoint, please use tos endpoint.");const n=null==e.secure||!!e.secure,i=(e,t)=>null==e?t:e;return{...e,endpoint:o,secure:n,enableVerifySSL:i(e.enableVerifySSL,!0),autoRecognizeContentType:i(e.autoRecognizeContentType,!0),requestTimeout:i(e.requestTimeout,12e4),connectionTimeout:i(e.connectionTimeout,1e4),maxConnections:i(e.maxConnections,1024),idleConnectionTime:i(e.idleConnectionTime,3e4),maxRetryCount:i(e.maxRetryCount,3),enableCRC:null!=(t=e.enableCRC)&&t,requestAdapter:void 0}}getUserAgent(){return"tos-nodejs-sdk/2.7.3"}async fetch(e,t,a,o,n,i){const r=(null==i?void 0:i.handleResponse)||(e=>e.data);if(n&&(null==i?void 0:i.needMd5)){const e=G(JSON.stringify(n),"base64");o["content-md5"]=e}const[s,c]=(()=>null!=i&&i.subdomainBucket&&this.opts.forcePathStyle?[this.opts.endpoint,`/${i.subdomainBucket}${t}`]:null!=i&&i.subdomainBucket&&!this.opts.isCustomDomain?/^(\d|:)/.test(this.opts.endpoint)?[this.opts.endpoint,`/${i.subdomainBucket}${t}`]:[`${null==i?void 0:i.subdomainBucket}.${this.opts.endpoint}`,t]:[this.opts.endpoint,t])();t=c,o=(e=>{const t={};return Object.entries(e).forEach(([e,a])=>{t[e]=(""+a).match(/./gu).map(e=>e.length>1||e.charCodeAt(0)>=128?encodeURIComponent(e):e).join("")}),t})(o);const p={endpoints:void 0,bucket:"",method:e,headers:{...o},path:t,query:C(a),host:s},d=new Y(this.opts.stsToken,this.opts.accessKeySecret,this.opts.accessKeyId),u=new Q({algorithm:"TOS4-HMAC-SHA256",region:this.opts.region,serviceName:"tos",bucket:"",securityToken:this.opts.stsToken},d).signatureHeader(p),h={...o},m={method:e,baseURL:`http${this.opts.secure?"s":""}://${s}`,url:t,params:a,headers:h,data:n};u.forEach((e,t)=>{m.headers[t]=e});const f=R(this.opts.proxy);if(null!=f&&f.url&&!this.opts.proxyHost)m.baseURL=f.url,null!=f&&f.needProxyParams&&(m.params["x-proxy-tos-host"]=s,delete h.host);else if(this.opts.proxyHost){if(!this.opts.proxyPort)throw new b("The `proxyPort` is required if `proxyHost` is truly.");m.proxy={host:this.opts.proxyHost,port:this.opts.proxyPort,protocol:"http"}}h["user-agent"]=this.userAgent,this.opts.requestTimeout>0&&Infinity!==this.opts.requestTimeout&&(m.timeout=this.opts.requestTimeout),m.httpAgent=this.httpAgent,m.httpsAgent=this.httpsAgent;try{const e={...m};delete e.httpAgent,delete e.httpsAgent,Se("reqOpts: ",e);const t=await this.axiosInst({maxBodyLength:Infinity,maxContentLength:Infinity,adapter:this.opts.requestAdapter,...m,...(null==i?void 0:i.axiosOpts)||{}});return{data:r(t),statusCode:t.status,headers:t.headers,requestId:t.headers["x-tos-request-id"],id2:t.headers["x-tos-id-2"]}}catch(e){var y,g;if(l.isAxiosError(e)&&null!=(y=e.response)&&null!=(g=y.headers)&&g["x-tos-request-id"]){const t=e.response;throw Se("TosServerError response: ",t),new ee(t)}throw Se("err: ",e),e}}async fetchBucket(e,t,a,o,n,i){const r=e||this.opts.bucket;if(!r)throw new b("Must provide bucket param");return this.fetch(t,"/",a,o,n,{...i,subdomainBucket:r})}async _fetchObject(e,t,a,o,n,i){const r="string"!=typeof e&&e.bucket||this.opts.bucket,s="string"==typeof e?e:e.key;if(!r)throw new b("Must provide bucket param");return ge(s),this.fetch(t,"/"+encodeURIComponent(s),a,o,n,{...i,subdomainBucket:r})}getSignatureQuery(e){const t=new Y(this.opts.stsToken,this.opts.accessKeySecret,this.opts.accessKeyId),a=new Q({algorithm:"TOS4-HMAC-SHA256",region:this.opts.endpoint,serviceName:"tos",bucket:e.bucket,securityToken:this.opts.stsToken},t);return"policy"in e?a.getSignaturePolicyQuery({policy:e.policy},e.expires):a.getSignatureQuery({method:e.method,path:e.path,endpoints:e.subdomain?e.endpoint:void 0,host:e.endpoint,query:e.query},e.expires)}normalizeBucketInput(e){return"string"==typeof e?{bucket:e}:e}normalizeObjectInput(e){return"string"==typeof e?{key:e}:e}}{constructor(...e){super(...e),this.createBucket=Ee,this.headBucket=Pe,this.deleteBucket=Re,this.listBuckets=Ce,this.getBucketLocation=na,this.putBucketStorageClass=Be,this.getBucketAcl=De,this.putBucketAcl=Ie,this.getBucketPolicy=Wt,this.putBucketPolicy=Vt,this.deleteBucketPolicy=Jt,this.getBucketVersioning=Xt,this.putBucketVersioning=Qt,this.getBucketCORS=ia,this.putBucketCORS=ra,this.deleteBucketCORS=sa,this.putBucketLifecycle=la,this.getBucketLifecycle=da,this.deleteBucketLifecycle=ua,this.putBucketEncryption=ha,this.getBucketEncryption=ma,this.deleteBucketEncryption=fa,this.putBucketMirrorBack=ya,this.getBucketMirrorBack=ga,this.deleteBucketMirrorBack=xa,this.putBucketReplication=Ta,this.getBucketReplication=wa,this.deleteBucketReplication=Sa,this.putBucketWebsite=Ca,this.getBucketWebsite=Ea,this.deleteBucketWebsite=Ra,this.putBucketNotification=Pa,this.getBucketNotification=Ba,this.putBucketCustomDomain=Ia,this.getBucketCustomDomain=Da,this.deleteBucketCustomDomain=ja,this.putBucketRealTimeLog=Oa,this.getBucketRealTimeLog=Ma,this.deleteBucketRealTimeLog=_a,this.getBucketInventory=Na,this.listBucketInventory=za,this.putBucketInventory=Ka,this.deleteBucketInventory=Fa,this.putBucketTagging=Ja,this.getBucketTagging=Xa,this.deleteBucketTagging=Qa,this.putBucketPayByTraffic=Ya,this.getBucketPayByTraffic=Za,this.getBucketImageStyle=oo,this.getBucketImageStyleList=to,this.getBucketImageStyleListByName=ao,this.getImageStyleBriefInfo=eo,this.deleteBucketImageStyle=io,this.putBucketImageStyle=no,this.putBucketImageStyleSeparator=co,this.putBucketImageProtect=ro,this.getBucketImageProtect=so,this.getBucketImageStyleSeparator=po,this.putBucketRename=uo,this.getBucketRename=ho,this.deleteBucketRename=mo,this.copyObject=ot,this.resumableCopyObject=qt,this.deleteObject=et,this.deleteMultiObjects=at,this.getObject=Fe,this.getObjectV2=qe,this.getObjectToFile=He,this.getObjectAcl=nt,this.headObject=Ze,this.appendObject=ft,this.listObjects=Xe,this.renameObject=tt,this.fetchObject=We,this.putFetchTask=Je,this.listObjectsType2=ca,this.listObjectVersions=Qe,this.putObject=$e,this.putObjectFromFile=Ve,this.putObjectAcl=it,this.setObjectMeta=yt,this.createMultipartUpload=ct,this.uploadPart=ut,this.uploadPartFromFile=ht,this.completeMultipartUpload=st,this.abortMultipartUpload=rt,this.uploadPartCopy=gt,this.listMultipartUploads=mt,this.listParts=lt,this.downloadFile=oa,this.putObjectTagging=ba,this.getObjectTagging=ka,this.deleteObjectTagging=va,this.listJobs=Ha,this.createJob=qa,this.deleteJob=Va,this.describeJob=Wa,this.updateJobStatus=Ga,this.updateJobPriority=$a,this.restoreObject=fo,this.uploadFile=vt,this.getPreSignedUrl=Ye,this.calculatePostSignature=St,this.preSignedPostSignature=St,this.preSignedPolicyURL=Yt,this.getBucketIntelligenttiering=lo,this.listStorageLens=yo,this.deleteStorageLens=go,this.getStorageLens=xo,this.putStorageLens=bo,this.putBucketNotificationType2=ko,this.getBucketNotificationType2=vo}}wo.TosServerError=ee,wo.isCancel=O,wo.CancelError=k,wo.TosServerCode=exports.TosServerCode,wo.TosClientError=b,wo.CancelToken=To,wo.ACLType=exports.ACLType,wo.StorageClassType=exports.StorageClassType,wo.MetadataDirectiveType=exports.MetadataDirectiveType,wo.AzRedundancyType=exports.AzRedundancyType,wo.PermissionType=exports.PermissionType,wo.GranteeType=exports.GranteeType,wo.CannedType=exports.CannedType,wo.HttpMethodType=exports.HttpMethodType,wo.LifecycleStatusType=exports.LifecycleStatusType,wo.StatusType=exports.StatusType,wo.RedirectType=exports.RedirectType,wo.StorageClassInheritDirectiveType=exports.StorageClassInheritDirectiveType,wo.TierType=exports.TierType,wo.VersioningStatusType=exports.VersioningStatusType,wo.createDefaultRateLimiter=pe,wo.DataTransferType=exports.DataTransferType,wo.UploadEventType=exports.UploadEventType,wo.DownloadEventType=exports.DownloadEventType,wo.ResumableCopyEventType=exports.ResumableCopyEventType,wo.ReplicationStatusType=exports.ReplicationStatusType,exports.CancelError=k,exports.CancelToken=To,exports.TOS=wo,exports.TosClient=wo,exports.TosClientError=b,exports.TosServerError=ee,exports.createDefaultRateLimiter=pe,exports.default=wo,exports.isCancel=O;//# sourceMappingURL=https://trae.private/sourcemaps/424b4bd987c6c6a4cadf1a08da420593cc6bf75a/node_modules/@volcengine/tos-sdk/dist/tos.cjs.production.min.js.map
