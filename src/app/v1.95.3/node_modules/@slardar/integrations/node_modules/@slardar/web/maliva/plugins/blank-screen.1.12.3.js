!function(){"use strict";var x=function(){return(x=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}).apply(this,arguments)};function P(n,e){var t="function"==typeof Symbol&&n[Symbol.iterator];if(!t)return n;var r,o,i=t.call(n),u=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)u.push(r.value)}catch(n){o={error:n}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return u}function U(){return{}}function t(n){return"object"==typeof n&&null!==n}function I(n){return"function"==typeof n}var a=function(n,e,t,r){return n.destroyAgent.set(e,t,r)};function f(n,e){return n.initSubject(e)}function M(){return Date.now()}function B(){if("object"==typeof window&&t(window))return window}function H(){if("object"==typeof document&&t(document))return document}function r(){if(B()&&I(window.PerformanceObserver))return window.PerformanceObserver}function o(n,e,t){return n=P(c(n,e),3),e=n[0],n=n[2],e(t),n}var s=function(n,e){return t(n)?x(x({},e),n):!!n&&e},i=["resource"],u=["longtask"],c=function(e,o,t){var r=e&&new e(function(n,r){n.getEntries?n.getEntries().forEach(function(n,e,t){return o(n,e,t,r)}):t&&t()});return[function(n){if(!e||!r)return t&&t();try{r.observe({entryTypes:n})}catch(n){return t&&t()}},function(n){if(!e||!r)return t&&t();try{r.observe({type:n,buffered:!0})}catch(n){return t&&t()}r.observe({type:n,buffered:!1})},function(){return r&&r.disconnect()}]},l=["longtask_0",function(n,e){var t=r();t&&e(o(t,n,u))}],d=["resource_0",function(n,e){var t=r();t&&e(o(t,n,i))}],Y="js_error",G="http",N="resource_error",F="blank_screen";function z(n,e){return~m.indexOf(n.tagName)||h<e}function W(n){return{width:(n=n.getBoundingClientRect()).width,height:n.height,top:n.top}}function J(n){return n?document.querySelector(n):document.body}function K(t,r,n,o){if(void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=1.5),!t||z(t,r)||o<=n)return n;var e=function(){if(!r)return 0;var n=W(t),e=n.top,n=n.height;return e>innerHeight||n<=0?0:1/(1<<r-1)}();return[].reduceRight.call(t.children,function(n,e){return K(e,r+1,n,o)},n+e)}var v=["unload_0",function(n,e){var t,r,o,i,u,c=B();c&&(t=P((r=n,o=!1,[function(n){o||(o=!0,r&&r(n))}]),1)[0],u=function(){t()},(i=["unload","beforeunload","pagehide"]).forEach(function(n){c.addEventListener(n,u)}),e(function(){i.forEach(function(n){c.removeEventListener(n,u)})}))}],p=["domLoad_1",function(n,e){var t,r,o=B(),i=H();o&&i&&(t=!1,r=function(){setTimeout(function(){n(),t=!0},0)},"loading"!==i.readyState?r():o.addEventListener("DOMContentLoaded",r,!1),e(function(){o.removeEventListener("DOMContentLoaded",r,!1)},function(n){t&&n()}))}],m=["SCRIPT","STYLE","META","HEAD"],Q=[Y,G,N],h=4,V=["performance","performance_longtask","performance_timing","custom"];function X(n){var t=n.cb,e=n.screenshotUrl,r=n.window,o=n.document,i=n.mask,u=n.partialShot,c=n.quality,a=n.rootSelector;if(B()&&"Promise"in window&&Promise&&r&&o){if(r.html2canvas)return f(),0;n=o.createElement("script");n.src=e,null!==(e=o.head)&&void 0!==e&&e.appendChild(n),n.onload=f}function f(){var e;((e=r).requestIdleCallback||function(n){return e.setTimeout(n,1)})(function(){r.html2canvas&&r.html2canvas(u&&a&&o.querySelector(a)||o.body,{scale:360/r.innerWidth,mask:i}).then(function(n){t("data:image"===(n=n.toDataURL("image/jpeg",c)).slice(0,10)?n:y())}).catch(function(){t(y())})})}}function y(n,e){void 0===n&&(n=192),void 0===e&&(e=108);var t=document.createElement("canvas");t.width=n,t.height=e;var r=t.getContext("2d");return r&&(r.fillStyle="#ffffff",r.fillRect(0,0,n,e)),t.toDataURL("image/jpeg")}var g=function(t,o,n,e){function r(n,e){o.forEach(function(n){return n()}),o.length=0,a&&t({ev_type:F,payload:{timestamp:a[0],score:a[1],screenshot:e,error:f,serialized_dom:function t(n,r,e){if(void 0===r&&(r=0),void 0===e&&(e=!0),!n||z(n,r))return"";var o=x(x({},W(n)),{id:n.getAttribute("id"),class:n.getAttribute("class")}),i=Object.keys(o).reduce(function(n,e){return n+("number"==typeof o[e]||o[e]?" "+e+'="'+o[e]+'"':"")},""),u=n.tagName.toLowerCase(),n=[].reduce.call(n.children,function(n,e){return n+t(e,r+1,!1)},"");return"<"+u+i+(e?' innerHeight="'+innerHeight+'"':"")+">"+n+"</"+u+">"}(J(_))},overrides:{timestamp:n||a[0]}})}function i(){s&&clearTimeout(s),s=T.setTimeout(function(){l=O(function(){var n=J(_);n&&((n=K(n,0,0,b))<b?(a=[M(),n],C()):a=void 0)})},1e3)}var u,c,a,f,s,l,d,v,p,m=P(n,4),h=m[0],y=m[1],g=m[2],n=m[3],b=e.threshold,w=e.screenshot,_=e.rootSelector,m=e.autoDetect,S=e.ssUrl,E=e.quality,R=e.mask,k=e.partialShot,T=B(),L=H(),O=T.requestAnimationFrame||U,D=T.cancelAnimationFrame||U,A=P((u=performance,[c=u&&u.timing||void 0,function(){return u&&u.now?u.now():(Date.now?Date.now():+new Date)-(c&&c.navigationStart||0)},function(n){var e=(u||{}).getEntriesByType;return I(e)&&e.call(u,n)||[]},function(){var n=(u||{}).clearResourceTimings;I(n)&&n.call(u)},function(n){var e=(u||{}).getEntriesByName;return I(e)&&e.call(u,n)||[]}]),2)[1],j=0,q=!1,C=(v=function(){a&&!q&&(q=!0,w?X({cb:r.bind(null,M()),screenshotUrl:S,window:T,document:L,mask:R,partialShot:k,quality:E,rootSelector:_}):r())},function(){d||(p=M(),d=T.setTimeout(function(){d=0,(p<j?i:v)()},1e4<A()?2e3:8e3))});return o.push(n[0](function(){!q&&f&&r()})),m&&o.push(h[0](function(){var n,t,n=P((n=function(){if(B()&&I(window.MutationObserver))return window.MutationObserver}(),e=i,t=n&&new n(e),[function(n,e){t&&n&&t.observe(n,e)},function(){return t&&t.disconnect()}]),2),e=n[0],r=n[1];o.push(function(){clearTimeout(s),clearTimeout(d),D(l),r&&r()}),e(null===(e=H())||void 0===e?void 0:e.body,{subtree:!0,childList:!0}),o.push(y()[0](function(){s&&i()})),o.push(g()[0](function(){s&&i()})),i()})),[function(n){q||~V.indexOf(n.ev_type)||(j=M(),f=function(n,e){if(-1===Q.indexOf(e.ev_type))return n;if(e.ev_type===G&&e.payload.response.status<400)return n;if(n&&Q.indexOf(n.type)<Q.indexOf(e.ev_type))return n;var t="";switch(e.ev_type){case Y:t=e.payload.error.message;break;case G:t=e.payload.request.url;break;case N:t=e.payload.url}return{type:e.ev_type,message:t,timestamp:M()}}(f=f&&1e4<j-f.timestamp?void 0:f,n))},i]},b="blankScreen";function w(i,u,c){i.on("init",function(){var e,n,t,r=H(),o=B();r&&o&&(n=b,r=u,n=null===(o=(o=i).config())||void 0===o?void 0:o.plugins[n],(n=s(n,r)||s(c,u))&&(r=[],n=P(g(i.report.bind(i),r,[f(i,p),function(){return f(i,l)},function(){return f(i,d)},f(i,v)],n),2),e=n[0],n=n[1],i.on("report",t=function(n){return e(n),n}),r.push(function(){i.off("report",t)}),a(i,b,F,r),i.provide("detectBlankScreen",n)))})}var _={autoDetect:!0,threshold:1.5,screenshot:!0,ssUrl:"https://sf16-short-va.bytedapm.com/slardar/fe/sdk-web/screenshot.min.js",mask:!1,partialShot:!0,quality:.1};var n,e,S,E,R="1.12.3";n=b,e=function(n,e){w(n,_,e)},(S=void 0===S?function(n){if(n)return n.__SLARDAR_REGISTRY__||(n.__SLARDAR_REGISTRY__={Slardar:{plugins:[],errors:[],subject:{}}}),n.__SLARDAR_REGISTRY__.Slardar}(B()):S)&&S.plugins&&(E=n,S.plugins.filter(function(n){return n.name===E&&n.version===R})[0]||S.plugins.push({name:n,version:R,apply:e}))}();
