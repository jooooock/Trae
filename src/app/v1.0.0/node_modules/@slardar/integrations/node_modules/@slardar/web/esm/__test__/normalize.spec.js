import { __assign } from "tslib";
import test from 'ava';
import { now } from '@slardar/sdk-web';
import { normalizeInitConfig, normalizeUserConfig, validateInitConfig, parseServerConfig } from '../normalize';
test('validateInitConfig', function (t) {
    t.true(validateInitConfig({ bid: '123' }));
    t.true(validateInitConfig({ bid: '123', pid: 'index' }));
    t.false(validateInitConfig(undefined));
    t.false(validateInitConfig(null));
    t.false(validateInitConfig({}));
    t.false(validateInitConfig({ pid: 'index' }));
});
test('normalizeUserConfig', function (t) {
    var cfg = {
        pid: 'index',
    };
    t.not(normalizeUserConfig(cfg), cfg);
    t.deepEqual(normalizeUserConfig(cfg), cfg);
});
test('normalizeInitConfig', function (t) {
    var cfg = {
        bid: 'bid',
        pid: 'index',
    };
    t.deepEqual(normalizeInitConfig(cfg), __assign(__assign({}, cfg), { plugins: {} }));
    t.deepEqual(normalizeInitConfig(__assign(__assign({}, cfg), { plugins: {
            ajax: true,
            jsError: {
                onerror: true,
                onunhandledrejection: false,
            },
        } })), __assign(__assign({}, cfg), { plugins: {
            ajax: {},
            jsError: {
                onerror: true,
                onunhandledrejection: false,
            },
        } }));
});
test('parseServerConfig', function (t) {
    var fakeServerTimestamp = now();
    t.deepEqual(parseServerConfig(), {});
    t.deepEqual(parseServerConfig({}), {});
    t.deepEqual(parseServerConfig({
        user_id: 'cookie-id',
    }), {});
    t.deepEqual(parseServerConfig({
        user_id: 'user-id',
        sample: {
            sample_rate: 1,
            sample_granularity: 'session',
            include_users: ['loz'],
            rules: [
                {
                    name: 'pageview',
                    enable: true,
                    sample_rate: 0.3,
                    conditional_sample_rules: [],
                },
            ],
        },
        timestamp: fakeServerTimestamp,
    }), {
        sample: {
            sample_rate: 1,
            sample_granularity: 'session',
            include_users: ['loz'],
            rules: {
                pageview: {
                    enable: true,
                    sample_rate: 0.3,
                    conditional_sample_rules: [],
                },
            },
        },
        plugins: {
            heatmap: false,
        },
        serverTimestamp: fakeServerTimestamp,
        apdex: undefined,
    });
    t.deepEqual(parseServerConfig({
        user_id: 'user-id',
        quota_rate: 0,
        sample: {
            sample_rate: 0.7,
            sample_granularity: 'session',
            include_users: ['loz'],
            rules: [
                {
                    name: 'pageview',
                    enable: true,
                    sample_rate: 0.3,
                    conditional_sample_rules: [],
                },
            ],
        },
        timestamp: fakeServerTimestamp,
        apdex: {
            satisfying_threshold: 0,
            frustrating_threshold: 0,
            error_weight: [0, 0, 0],
            duration_apdex: [[{ weight: 3, threshold: 3000 }]],
            perf_apdex: {
                fcp: [{ weight: 3, threshold: 3000 }],
            },
            last_n: 180000,
        },
    }), {
        sample: {
            sample_rate: 0,
            sample_granularity: 'session',
            include_users: ['loz'],
            rules: {
                pageview: {
                    enable: true,
                    sample_rate: 0.3,
                    conditional_sample_rules: [],
                },
            },
        },
        plugins: {
            heatmap: false,
        },
        serverTimestamp: fakeServerTimestamp,
        apdex: {
            satisfying_threshold: 0,
            frustrating_threshold: 0,
            error_weight: [0, 0, 0],
            duration_apdex: [[{ weight: 3, threshold: 3000 }]],
            perf_apdex: {
                fcp: [{ weight: 3, threshold: 3000 }],
            },
            last_n: 180000,
        },
    });
});//# sourceMappingURL=https://trae.private/sourcemaps/424b4bd987c6c6a4cadf1a08da420593cc6bf75a/node_modules/@slardar/integrations/node_modules/@slardar/web/esm/__test__/normalize.spec.js.map